# DD基本ルール

DD（Design Document）設計書の運用ルールです。

## 1. DDとは

**意思決定の記録ドキュメント**です。

- 1つのDDは1つのテーマ/タスクに対応
- タスクの計画、調査結果、判断の経緯を記録
- 完了後はアーカイブしてプロジェクトの履歴として残す

## 2. ファイル命名規則

### メインファイル

```
DD-{番号}_{タイトル}.md
```

**例:**
- `DD-001_ログイン機能の実装.md`
- `DD-002_アーキテクチャ設計.md`
- `DD-015_パフォーマンス改善.md`

**ルール:**
- 番号は3桁ゼロパディング（1 → 001）
- タイトルは日本語OK
- スペースは使わない（アンダースコアで区切る）

### チーム開発時（識別子プレフィックス方式）

複数人で運用する場合、識別子を付けて番号衝突を防ぐ：

```
DD{識別子}-{番号}_{タイトル}.md
```

**例:**
- `DDI-001_ログイン機能.md`（石森）
- `DDSA-001_検索機能.md`（斉藤）

識別子は1〜3文字で、チーム内で重複しないよう管理する。

### 添付ファイルがある場合

大きなDDで添付ファイル（参考資料、詳細設計書など）がある場合：

```
doc/DD/
├── DD-001_タイトル.md        # メインファイル（常に直下）
└── DD-001/                   # 添付ファイル用フォルダ（番号のみ）
    ├── 詳細設計.md
    └── 参考資料.md
```

## 3. フォルダ構成

```
doc/
├── DD/                       # 進行中のDD
│   ├── DD-001_タイトル.md
│   └── DD-001/               # 添付ファイル（あれば）
│
└── archived/
    └── DD/                   # 完了したDD
        ├── DD-002_タイトル.md
        └── DD-002/
```

**重要:**
- メインファイルは常に `doc/DD/` 直下に配置
- サブフォルダに入れない

## 4. タスクステータス

| 記号 | 意味 | 用途 |
|------|------|------|
| `[ ]` | 未着手 | これから実行するタスク |
| `[x]` | 完了 | 完了したタスク |
| `[-]` | スキップ/中止 | 不要になった、別途対応するタスク |

**例:**
```markdown
## タスク一覧

- [x] 認証サービスの実装
- [x] ログイン画面の作成
- [ ] テストの作成
- [-] ドキュメント作成（別DDで対応）
```

## 5. DDのステータス

| ステータス | 意味 |
|-----------|------|
| **進行中** | 作業中のDD |
| **完了** | 全タスク完了、アーカイブ待ち |

## 6. ログセクションの書き方

判断の経緯を時系列で記録します。

**書くべきこと:**
- 日付（YYYY-MM-DD形式）
- 実施した内容
- 判断した理由
- 発生した問題と対処

**例:**
```markdown
## ログ

### 2024-01-15
- DD作成
- 認証方式を検討（セッション vs JWT）
- セッションベースを採用（シンプルさ優先）

### 2024-01-16
- 認証サービス実装完了
- ログイン画面実装完了
- テスト実行時にセッション切れの問題発見
  → タイムアウトを30分に延長して解決

### 2024-01-17
- 全タスク完了
- DDをアーカイブ
```

## 7. Devil's Advocate調査（Phase 0）

Phase 0では批判的視点で調査を行います：

| 問い | 目的 |
|-----|------|
| 「本当にこれが最善か？」 | 代替案の洗い出し |
| 「このアプローチの欠点は？」 | 隠れたリスク発見 |
| 「どう失敗し得るか？」 | 失敗シナリオ特定 |
| 「将来の変更で壊れないか？」 | 保守性の確認 |

**調査結果はDDの「検討内容」セクションに記録します。**

## 8. DD作成のタイミング

以下の場合にDDを作成します：

**DDを作成する:**
- 新機能の実装
- 設計判断が必要なリファクタリング
- 複数の選択肢から1つを選ぶ必要がある場合
- 後から「なぜこうしたか」を振り返りたい場合

**DDを省略できる:**
- 単純なバグ修正（原因が明確）
- ドキュメントの誤字修正
- 既存DDのタスク消化

## 9. DD完了とアーカイブ

### 完了条件

- 全タスクが `[x]` または `[-]` になっている
- ステータスを「完了」に変更済み

### アーカイブ手順

1. ファイルを `doc/DD/` から `doc/archived/DD/` に移動
2. 添付フォルダがある場合はフォルダごと移動

```
移動前:
doc/DD/DD-001_タイトル.md
doc/DD/DD-001/（あれば）

移動後:
doc/archived/DD/DD-001_タイトル.md
doc/archived/DD/DD-001/（あれば）
```

## 10. 番号管理

新規DD作成時は、**アーカイブ済みも含めて**最大番号を確認します。

```
doc/DD/DD-003_xxx.md      # 進行中
doc/archived/DD/DD-005_xxx.md  # アーカイブ済み

→ 次のDDは DD-006
```

番号の重複を防ぐため、必ず両方のフォルダを確認してください。

### チーム開発時の番号管理

識別子プレフィックスを使う場合、各メンバーは自分の識別子付きDDのみをカウント：

```
DDI-001, DDI-002, DDI-003  # 石森の番号系列
DDSA-001, DDSA-002         # 斉藤の番号系列
```

異なる識別子間では番号が重複しても問題ない。

## 11. DDの参照方法

過去の意思決定を調べたいときは、アーカイブを検索します。

```
doc/archived/DD/
├── DD-001_システム概要整理.md
├── DD-002_認証機能の実装.md
├── DD-003_アーキテクチャ設計.md
...
```

DDの「目的」「決定事項」「ログ」を見れば、当時の判断理由がわかります。
