# サンプルプロンプト: Gate 0 — Claude 初期設定

対応 Gate: [gates/00_initial_claude.md](../gates/00_initial_claude.md)

---

## DD 起票プロンプト

> `<プロジェクト名>` を実際の値に置き換えて、以下をそのまま貼り付けてください。

````
以下の作業を DD に分割して起票・実行してください。
作業の粒度を判断し、適切な数の DD に分けてください（目安: 3〜4 DD）。

<プロジェクト名> プロジェクトの Claude 作業環境を整備します。

---

## 作業 1: CLAUDE.md の確認・整備

### チェック項目
- [ ] プロジェクトの技術スタック・コーディング規約が記載されている
- [ ] DD フォルダ（doc/DD/）が設定されている
- [ ] 調査成果物の整理ルール（doc/context/ 管理）が記載されている
  - 調査系DDの完了条件として対応するコンテキストファイルを更新する旨を明記する
  - DDの調査内容と更新対象ファイルの対応表を記載する
  - ファイル別の「書くべき内容 / 書いてはいけないこと」の区別表を記載する
  - 犯しやすいミスの具体例を記載する
  - 正しい記述パターン（事実＋参照先リンク）の例を示す

### テンプレート貼り付け

以下のブロックを CLAUDE.md の「コンテキストファイルの記述原則」セクションに追加してください。
このテンプレートをそのまま貼り付けてください。

---（CLAUDE.md に貼り付けるテンプレートここから）---

### ファイル別・書くべき内容の厳密な区別

> **これを守らないと情報が散乱し、AIも人間も参照先を間違える。**

| ファイル | 書くこと | 書いてはいけないこと |
|---------|---------|------------------|
| `domain-model.md` | **今この瞬間に正しい事実**（値の定義・テーブル構造・業務的意味・システムへの影響） | 設計問題・移植注意点・「新システムではこうせよ」 |
| `migration-notes.md` | **新システムで変えること**（旧システムの問題点と移植方針・「やってはいけないこと」） | 旧システムの事実記録 |
| `constraints.md` | **技術的負債リスト**（既知の問題・未解決事項・リスク評価） | 移植方針・「どう変えるか」 |
| `decisions.md` | **重要な設計判断記録**（ADR形式・なぜその設計にしたか） | 調査結果・未確定事項 |

**犯しやすいミス（実際に起きた例）:**
- `domain-model.md` に「この定数名は問題→新システムで改名すること」を書いてしまう → `migration-notes.md` に書く
- `domain-model.md` にバグ・設計問題・技術的負債を書いてしまう → `constraints.md` か `migration-notes.md` に書く
- `domain-model.md` に記述が増えたら「これは事実か？方針か？」を自問すること

**正しい記述パターン（domain-model.md の例）:**
```
### xxx.some_flag（フラグ名）INT
| 値 | 定数 | 意味 |
| 0  | Foo::BAR | ... |
技術的負債・移植注意点 → migration-notes.md・DD-XXX   ← リンクだけ置く
```

---（CLAUDE.md に貼り付けるテンプレートここまで）---

---

## 作業 2: doc/context/ の整備・仕様書マップ登録

- [ ] doc/context/ ディレクトリを作成した
- [ ] 完了済みの調査 DD がある場合、以下のコンテキストファイルに蒸留した
  - system-overview.md（コードベース全体調査）
  - domain-model.md（DB・データモデル調査）
  - constraints.md（技術的制約・既知の負債）
  - decisions.md（重要な設計判断・ADR）
- [ ] 各コンテキストファイルの冒頭に「最終更新: YYYY-MM-DD (DD-XXX)」を記載した
- [ ] CLAUDE.md の仕様書マップに DD 一覧を記載した
- [ ] CLAUDE.md の仕様書マップにコンテキストファイル一覧（doc/context/ 配下）を記載した

---

## 作業 3: 調査支援スクリプトの準備

LLM はコードから値を推測するが、実データと乖離することがある。
Gate2 以降で「実データを機械的に確認できるスクリプト」を今のうちに用意しておくと
後追い調査を大幅に減らせる。

まずプロジェクトの環境を確認し、DB やデータソースへのアクセス手段を調査してください。
その上で、以下の分析目的を達成するために最適な方法を提案してください。

### 分析目的

| 目的 | 活用タイミング |
|------|-------------|
| テーブル一覧・件数の把握（コード推測値との乖離検出） | Gate2 |
| フラグ列の値分布確認（想定外の値の検出） | Gate2〜4 |
| DB オブジェクト一覧の取得（コードに記述のない残存オブジェクトの検出） | Gate2 |

### アクセス手段の例

| 環境 | アプローチ |
|------|----------|
| DB に直接接続できる | Python スクリプトで SQL 実行（`scripts/analyze/` に配置） |
| DB ダンプ・CSV エクスポートが入手できる | ファイル解析スクリプト |
| ORM / マイグレーションファイルのみ | コード解析で構造を抽出 |
| API 経由でのみデータ取得可能 | API 呼び出しスクリプト |

### 完了条件
- [ ] プロジェクトで利用可能なアクセス手段を調査し、結果をこの DD に記録した
- [ ] 上記の分析目的を達成するスクリプトを `scripts/analyze/` に作成した（言語は Python 推奨）
- [ ] 各スクリプトの使い方を README またはこの DD に記録した

> **なぜ Gate0 で作るか**: Gate2 以降で「確認してみよう」となっても、スクリプトがなければ
> 毎回手作業で確認することになる。今作っておけば Gate2〜4 で即座に確認できる。
````

---

## DD 完了後の Gate 確認

DD のタスクがすべて完了したら、Gate 通過を確認してください。

**人間が確認する場合:**
[gates/00_initial_claude.md](../gates/00_initial_claude.md) を開いてチェックリストを埋める。

**Claude に確認させる場合:**
```
このDDの内容は gates/00_initial_claude.md の基準を満たしていますか？
不足している項目があれば指摘してください。
```

---

## Gate 宣言 DD 起票プロンプト

Gate 通過を明示的に記録するための DD を別途起票します。
チェックリストの確認が終わったら、以下をコピーして Claude に貼り付けてください。

> `<確認結果の要約>` と `<未解決事項>` を実際の内容に置き換えてください。

```
以下の内容のDDを作ってください。

Gate 0（Claude 初期設定）の通過を宣言します。

## 確認結果
- [ ] gates/00_initial_claude.md のチェックリストを確認した
- [ ] チェックリストの各項目の確認結果を記録した

## 判断
- 通過判定: 通過 / 条件付き通過 / 保留（いずれかを選択）
- 確認結果の要約: <確認結果の要約>
- 未解決事項（ある場合）: <未解決事項と解消計画>

## 次のステップ
- [ ] Gate 1（初回調査）に進む
```
