# サンプルプロンプト: Gate 0 — Claude 初期設定

対応 Gate: [gates/00_initial_claude.md](../gates/00_initial_claude.md)

---

## DD 起票プロンプト

> `<プロジェクト名>` を実際の値に置き換えて、以下をそのまま貼り付けてください。

````
以下の作業を DD に分割して起票・実行してください。
作業の粒度を判断し、適切な数の DD に分けてください（目安: 3〜4 DD）。

<プロジェクト名> プロジェクトの Claude 作業環境を整備します。

---

## 作業 1: CLAUDE.md の確認・整備

- [ ] プロジェクトの技術スタック・コーディング規約が記載されている
- [ ] DD フォルダ（doc/DD/）が設定されている
- [ ] doc/context/ ディレクトリを作成した
- [ ] 調査成果物の整理ルール（doc/context/ 管理）が記載されている
  - 調査系DDの完了条件として対応するコンテキストファイルを更新する旨を明記する
- [ ] 仕様書作成マニュアルへのリンクを CLAUDE.md に記載した
  - リンク先: manuals/01_仕様書作成マニュアル.md（spec-know-how リポジトリ）
  - 仕様書の書き方・信頼度ラベルの付け方に迷ったときに参照できるようにする

> **注意**: doc/context/ のファイル構成（ファイル名・役割分担）は Gate 1（初回調査）で
> コードベースの全体像を把握した後に設計する。この時点ではディレクトリだけ用意すればよい。

---

## 作業 2: 仕様書マップの準備

- [ ] CLAUDE.md に仕様書マップのセクションを作成した（DD 一覧・コンテキストファイル一覧を登録する場所）
- [ ] 今後の Gate で作成するドキュメントをここに追記するルールを決めた
- [ ] 以下のルールを CLAUDE.md に明記した:
  - 新しいファイル（仕様書・コンテキストファイル・スクリプト等）を作成したら、必ず仕様書マップにリンクを追加すること
  - CLAUDE.md はナビゲーション用。ファイルの内容を CLAUDE.md に転記しないこと（コンテキストを圧迫するため）
  - リンク＋一行説明だけを記載し、詳細は各ファイルを参照する形にすること

---

## 作業 3: 機械分析スクリプトの準備

LLM のコード読み取りは推測であり、実データや実際のコード構造と乖離することがある。
Gate2 以降で「機械的に確認できるスクリプト」を今のうちに用意しておくと
後追い調査を大幅に減らせる。

まずプロジェクトの環境（DB アクセス手段・コードベースの言語）を確認し、
以下の分析目的を達成するために最適な方法を提案してください。

### 分析目的

#### DB・データソース

| 目的 | 活用タイミング |
|------|-------------|
| テーブル一覧・件数の把握（コード推測値との乖離検出） | Gate2 |
| フラグ列の値分布確認（想定外の値の検出） | Gate2〜4 |
| DB オブジェクト一覧の取得（コードに記述のない残存オブジェクトの検出） | Gate2 |

| 環境 | アプローチ |
|------|----------|
| DB に直接接続できる | Python スクリプトで SQL 実行 |
| DB ダンプ・CSV エクスポートが入手できる | ファイル解析スクリプト |
| ORM / マイグレーションファイルのみ | コード解析で構造を抽出 |
| API 経由でのみデータ取得可能 | API 呼び出しスクリプト |

#### アプリケーションコード

| 目的 | 活用タイミング |
|------|-------------|
| クラス・関数の一覧抽出（構造の網羅的把握） | Gate1〜4 |
| 呼び出し関係の抽出（依存グラフ・エントリポイント特定） | Gate3〜4 |
| ルーティング定義の一覧抽出（画面・API エンドポイント網羅） | Gate3 |
| 定数・Enum 定義の一覧抽出（フラグ値の網羅的把握） | Gate2〜4 |
| SQL 文・クエリビルダ呼び出しの抽出（DB アクセスパターン把握） | Gate2・4 |

コードベースの言語に応じた AST 解析ツールを使用してください（例: Python なら `ast` モジュール、
PHP なら `nikic/php-parser`、JavaScript/TypeScript なら `typescript` コンパイラ API）。

### 完了条件
- [ ] プロジェクトで利用可能な DB アクセス手段を調査し、結果をこの DD に記録した
- [ ] コードベースの言語に適した AST 解析手段を特定した
- [ ] 上記の分析目的を達成するスクリプトを `scripts/analyze/` に作成した（言語は Python 推奨）
- [ ] 各スクリプトの使い方を README またはこの DD に記録した

> **なぜ Gate0 で作るか**: Gate2 以降で「確認してみよう」となっても、スクリプトがなければ
> 毎回手作業で確認することになる。今作っておけば Gate2〜4 で即座に確認できる。
````

---

## 完了前の確認プロンプト

DD の作業がすべて完了したら、以下をコピーして Claude に貼り付けてください。

```
以下のことを確認してください。

- [ ] 作成した DD にしか記録されていない情報がないこと
  DD は埋もれる可能性が高いため、DD だけが持っている情報は絶対に NG です。
  重要な情報は仕様書・コンテキストファイル等に必ず転記してください。
- [ ] 新たに作成したファイルが CLAUDE.md から辿れる構造になっていること
```

---

## Gate 宣言 DD 起票プロンプト

DD のタスクがすべて完了したら、以下をコピーして Claude に貼り付けてください。

> `<確認結果の要約>` と `<未解決事項>` を実際の内容に置き換えてください。

```
以下の内容のDDを作ってください。

Gate 0（Claude 初期設定）の通過を宣言します。

## 確認結果
- [ ] gates/00_initial_claude.md のチェックリストを確認した
- [ ] チェックリストの各項目の確認結果を記録した

## 判断
- 通過判定: 通過 / 条件付き通過 / 保留（いずれかを選択）
- 確認結果の要約: <確認結果の要約>
- 未解決事項（ある場合）: <未解決事項と解消計画>

## 次のステップ
- [ ] Gate 1（初回調査）に進む
```
