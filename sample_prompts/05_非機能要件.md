# サンプルプロンプト: Gate 5 — 非機能要件

---

## DD 起票プロンプト

> コピーして Claude に貼り付けてください。`<コードベースのパス>` を実際のパスに置き換えてください。

```
以下の作業を DD に分割して起票・実行してください。
作業の粒度を判断し、適切な数の DD に分けてください（目安: 2〜3 DD）。
各 DD 完了時に DA 批判レビューを実施してください。

<コードベースのパス> のコードベースを分析し、非機能要件について以下を行ってください。

> **事前スコープ確認**: 非機能要件の対象範囲（認証方式・外部サービス数等）を確認し、
> 複数の認証方式が混在する、または外部サービス連携が多い（目安: 5 以上）場合は、
> テーマ別に DD を分割することを提案してから作業を継続すること。
> 例: DD-A: 認証・認可 / DD-B: セキュリティ / DD-C: 運用・監査

---

## 作業 1: 認証・認可・セキュリティ

- [ ] 認証の仕組みを確認した（セッション / JWT / OAuth 等）
- [ ] 認可の仕組みを確認した（ロールベース / リソースベース 等）
- [ ] 未認証時の挙動を確認した（リダイレクト先・エラー応答）
- [ ] SQLインジェクション対策を確認した
- [ ] XSS 対策を確認した
- [ ] CSRF 対策を確認した
- [ ] 機密情報の扱い（パスワード・個人情報等）を確認した

---

## 作業 2: ログ・監査・パフォーマンス

- [ ] アプリケーションログの出力方針を確認した（何をログに残しているか）
- [ ] 監査ログの有無を確認した（誰がいつ何をしたか）
- [ ] ログの保存場所・保存期間を確認した（ある場合）
- [ ] SLA・応答時間の要件を確認した（ある場合）
- [ ] 大量データを扱う処理・バッチ処理を特定した
- [ ] 既知のパフォーマンス問題（N+1 クエリ等）を確認した

---

## 作業 3: 運用・保守

- [ ] バックアップ・リカバリ方針を確認した（ある場合）
- [ ] デプロイ方法を確認した
- [ ] 環境変数・設定ファイルの管理方法を確認した
- [ ] 作成した NFR 仕様書ファイルを CLAUDE.md または document_map.md に追記した
```

---

## 完了前の確認プロンプト

> DD の作業がすべて完了したら、コピーして Claude に貼り付けてください。

```
以下のことを確認してください。

- [ ] 作成した DD にしか記録されていない情報がないこと
  DD は埋もれる可能性が高いため、DD だけが持っている情報は絶対に NG です。
  重要な情報は仕様書・コンテキストファイル等に必ず転記してください。
- [ ] 新たに作成したファイルが CLAUDE.md から辿れる構造になっていること
```

---

## 横断分析（Gate 宣言前に実施）

このフェーズで作成した全 DD を横断的に分析してください。

- [ ] 各 DD を横断し、個別調査では見えなかったパターン・矛盾・見落としを発見した
- [ ] 新たな課題が見つかった場合、新規 DD 起票または既存 DD 更新を行った

> 例：「複数の DD を組み合わせて初めて見えてくるパターン（例：テーブル構造 DD と区分値 DD を合わせると DB 制約なしの重大リスクが浮かぶ）を見逃さないこと。」

---

## Gate チェックリスト（人間が確認）

> コピー不要。各項目を目視確認してください。Gate 宣言 DD を起票する前に確認してください。

**確認タイミング**: Step 5（非機能要件を確認する）完了後

次のステップに進む前に、以下の項目を確認してください。

### 認証・認可

- [ ] 認証の仕組みを確認した（セッション / JWT / OAuth 等）
- [ ] 認可の仕組みを確認した（ロールベース / リソースベース 等）
- [ ] 未認証時の挙動を確認した（リダイレクト先・エラー応答）

### ログ・監査

- [ ] アプリケーションログの出力方針を確認した（何をログに残しているか）
- [ ] 監査ログの有無を確認した（誰がいつ何をしたか）
- [ ] ログの保存場所・保存期間を確認した（ある場合）

### パフォーマンス

- [ ] SLA・応答時間の要件を確認した（ある場合）
- [ ] 大量データを扱う処理・バッチ処理を特定した
- [ ] 既知のパフォーマンス問題（N+1 クエリ等）を確認した

### セキュリティ

- [ ] SQLインジェクション対策を確認した（ORM 使用、プレースホルダー等）
- [ ] XSS 対策を確認した（出力エスケープ等）
- [ ] CSRF 対策を確認した（トークン等）
- [ ] 機密情報の扱い（パスワード・個人情報等）を確認した

### 運用・保守

- [ ] バックアップ・リカバリ方針を確認した（ある場合）
- [ ] デプロイ方法を確認した
- [ ] 環境変数・設定ファイルの管理方法を確認した

### DA 批判レビュー（必須）

- [ ] このステップの成果物に対して DA 批判レビューを実施した（少なくとも1件の問題を発見・対応）

> DA 批判レビューの詳細は [manuals/01_仕様書作成マニュアル.md](../manuals/01_仕様書作成マニュアル.md) を参照。

---

### メモ欄

```
（例）
- 認証: JWT（有効期限 24h）。リフレッシュトークンなし
- ロール: 3種（一般社員 / 店舗責任者 / 総務部）
- 監査ログ: なし。移行先で追加が必要かどうかは要確認
- パフォーマンス要件: 特に定めなし（現状 3秒以内が慣行）
- セキュリティ: ORM（SQLAlchemy）使用。CSRF は Streamlit が内部で処理
- バックアップ: RDS の自動スナップショット（7日）
```

---

## Gate 宣言 DD 起票プロンプト

> Gate チェックリストの確認が終わったら、コピーして Claude に貼り付けてください。`<確認結果の要約>` と `<未解決事項>` を実際の内容に置き換えてください。

```
以下の内容のDDを作ってください。

Gate 5（非機能要件）の通過を宣言します。

## 確認結果
- [ ] 上記の Gate チェックリストを確認した
- [ ] チェックリストの各項目の確認結果を記録した
- [ ] 作成した NFR 仕様書ファイルを CLAUDE.md または document_map.md に追記した

## 判断
- 通過判定: 通過 / 条件付き通過 / 保留（いずれかを選択）
- 確認結果の要約: <確認結果の要約>
- 未解決事項（ある場合）: <未解決事項と解消計画>

## 次のステップ
- [ ] Step 6（QA スキル作成）に進む
```
