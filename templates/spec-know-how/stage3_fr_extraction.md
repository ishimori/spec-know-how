# DD-{番号}: FR 仕様抽出

| 作成日 | 更新日 | ステータス | ステージ |
|--------|--------|------------|----------|
| {日付} | {日付} | 進行中 | Stage 3 |

## 前提 DD

- Stage 2: 分析スコープ（完了必須）

## スキップ判定

### 判定条件
Stage 2 で FR 仕様抽出が「スキップ」と判定された場合。

### 判定方法
Stage 2 の「Stage 3 DD のスキップ判定」テーブルを確認。

### スキップ時の記録
このDDをスキップする場合:
1. ステータスを「スキップ」に変更
2. スキップ理由を「決定事項」セクションに記録
3. ポートフォリオインデックス DD の該当行を更新

## 目的

対象コードベースから業務ロジック・ビジネスルールを抽出し、
FR（機能要件）仕様書として構造化する。

## 背景・課題

レガシーコードに埋もれた業務ルールは、コードを読まないと把握できない。
体系的に抽出し、信頼度付きで文書化することで再利用可能な知識基盤を作る。

## 検討内容

### 抽出対象モジュール

（Stage 2 のマトリクスから「深い」判定のモジュールを転記）

| モジュール | 抽出戦略 | 推定ルール数 | 優先度 |
|-----------|---------|-------------|--------|

## 決定事項

（抽出完了後に記入）

## 成果物

| 成果物 | 配置先 | 状態 |
|--------|--------|------|
| FR 仕様書 | `doc/spec/business-logic/` | 未作成 |

## 信頼度サマリー

| 信頼度 | 件数 |
|--------|------|
| High | 0 |
| Medium | 0 |
| Low | 0 |
| Conflicting | 0 |

> **注意**: Conflicting が 1 件でもある場合、Stage 5 に進む前に解消が必要。

## タスク一覧

### Phase 0: 事前精査
- [ ] 📋 各 Phase のタスク精査・詳細化
- [ ] 📋 Stage 2 で指定された抽出対象モジュールの確認
- [ ] 📋 抽出戦略の確認
- [ ] 😈 **Devil's Advocate調査**

### Phase 1: コード読解と構造理解
- [ ] 対象モジュールのエントリーポイントから処理フローを追跡
- [ ] 主要な関数/メソッドの役割を整理
- [ ] ビジネスロジックが集中している箇所を特定
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 2: ビジネスルール抽出
- [ ] 条件分岐に埋め込まれた業務ルールを BR-xxx 形式で抽出
- [ ] 定数・閾値・マジックナンバーの意味を解読
- [ ] 計算ロジック（金額、日数、割合等）を数式として記述
- [ ] 状態遷移に関わるルールを整理
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 3: 仕様書の構造化
- [ ] 抽出したルールをカテゴリ別に整理
- [ ] 各ルールに根拠（ソースコード行）を付記
- [ ] 信頼度（High/Medium/Low/Conflicting）を付与
- [ ] 信頼度サマリーを更新
- [ ] 仕様書を `doc/spec/business-logic/` に配置
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 4: クロスリファレンス
- [ ] 他の Stage 3 DD（データフロー、状態管理、エラー処理）との整合性確認
- [ ] 矛盾するルールがあれば Conflicting として記録
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

## ログ

### {日付}
- DD作成（spec-know-how 起動時に自動生成）

---

## DA批判レビュー記録

### Phase N DA批判レビュー

**DA観点:** （このPhaseで最も壊れやすいポイントは何か？）

| # | 発見した問題/改善点 | 重要度 | 再現手順（高/中は必須） | DA観点 | 対応 |
|---|-------------------|--------|----------------------|--------|------|
| 1 | (具体的に記述) | 高/中/低 | (高/中: 操作→結果) | (どのDA観点で発見したか) | ✅修正済/⏭️別DD/❌不要 |
