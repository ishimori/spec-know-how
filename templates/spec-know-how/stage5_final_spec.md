# DD-{番号}: 最終仕様

| 作成日 | 更新日 | ステータス | ステージ |
|--------|--------|------------|----------|
| {日付} | {日付} | 進行中 | Stage 5 |

## 前提 DD

- Stage 3: 全仕様抽出 DD（実行されたもの全て完了必須）
- Stage 4: 機械ツール設計（完了必須）

## スキップ判定

### 判定条件
Stage 4 がスキップされた場合。
→ Stage 3 の成果物が最終仕様となる（信頼度は Medium が上限）。

### 判定方法
Stage 4 DD のステータスを確認。

### スキップ時の記録
このDDをスキップする場合:
1. ステータスを「スキップ」に変更
2. 「Stage 4 未実施のため、Stage 3 成果物を最終仕様とする。信頼度上限: Medium」と記録
3. ポートフォリオインデックス DD の該当行を更新

## 目的

Stage 3（人的仕様抽出）と Stage 4（機械抽出結果）を突合し、
最終的な信頼度付き仕様書を生成する。

## 背景・課題

LLM の解釈と機械的事実を突合することで、仕様の正確性を検証する。
矛盾（Conflicting）は全て解消してから仕様を確定する。

## 検討内容

### 突合マトリクス

| 仕様項目ID | Stage 3 の記述 | Stage 4 の機械証拠 | 一致/不一致 | 最終信頼度 |
|-----------|-------------|------------------|-----------|----------|

## 決定事項

（突合完了後に記入）

## 成果物

| 成果物 | 配置先 | 状態 |
|--------|--------|------|
| 最終仕様書（FR） | `doc/spec/business-logic/` | 未作成 |
| 突合レポート | 本 DD 内 | 未作成 |
| Conflicting 解消記録 | 本 DD 内 | 未作成 |

## 信頼度サマリー（最終）

| 信頼度 | 件数 | 備考 |
|--------|------|------|
| High | 0 | 機械裏付けあり |
| Medium | 0 | 一部推論 |
| Low | 0 | 要調査 |
| Conflicting | 0 | **0 であること（受入条件）** |

## タスク一覧

### Phase 0: 事前精査
- [ ] 📋 各 Phase のタスク精査・詳細化
- [ ] 📋 Stage 3 全 DD の成果物を収集
- [ ] 📋 Stage 4 の機械抽出結果を確認
- [ ] 😈 **Devil's Advocate調査**

### Phase 1: 突合実行
- [ ] Stage 3 の各仕様項目と Stage 4 の機械証拠を突合
- [ ] 一致する項目を High に昇格
- [ ] 機械証拠がない項目は Medium を維持
- [ ] 矛盾する項目を Conflicting としてマーク
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 2: Conflicting 解消
- [ ] Conflicting 項目を個別に調査
- [ ] コードの再読解で矛盾を解消
- [ ] 解消できない場合は調査課題として記録
- [ ] **Conflicting が 0 になるまで繰り返す**
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 3: 最終仕様書の生成
- [ ] 突合結果を反映した最終仕様書を作成
- [ ] 各項目に最終信頼度を付与
- [ ] 根拠（ソースコード行 + コミット SHA）を付記
- [ ] `doc/spec/business-logic/` に配置
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 4: QA インデックス構築
- [ ] 仕様項目を QA 応答可能な形式に変換
- [ ] 各回答に: 回答 + 信頼度 + 根拠行 + コミット SHA + 生成日時
- [ ] 信頼度サマリーの最終更新
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

## ログ

### {日付}
- DD作成（spec-know-how 起動時に自動生成）

---

## DA批判レビュー記録

### Phase N DA批判レビュー

**DA観点:** （このPhaseで最も壊れやすいポイントは何か？）

| # | 発見した問題/改善点 | 重要度 | 再現手順（高/中は必須） | DA観点 | 対応 |
|---|-------------------|--------|----------------------|--------|------|
| 1 | (具体的に記述) | 高/中/低 | (高/中: 操作→結果) | (どのDA観点で発見したか) | ✅修正済/⏭️別DD/❌不要 |
