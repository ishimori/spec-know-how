# DD-{番号}: 状態管理抽出

| 作成日 | 更新日 | ステータス | ステージ |
|--------|--------|------------|----------|
| {日付} | {日付} | 進行中 | Stage 3 |

## 前提 DD

- Stage 2: 分析スコープ（完了必須）

## スキップ判定

### 判定条件
Stage 2 で 状態管理抽出が「スキップ」と判定された場合。
例: ステートレスな API のみのシステム。

### 判定方法
Stage 2 の「Stage 3 DD のスキップ判定」テーブルを確認。

### スキップ時の記録
このDDをスキップする場合:
1. ステータスを「スキップ」に変更
2. スキップ理由を「決定事項」セクションに記録
3. ポートフォリオインデックス DD の該当行を更新

## 目的

画面状態、セッション管理、ユーザー権限、ワークフロー状態遷移を抽出する。
「いつ、誰が、どの状態で、何ができるか」を明確化する。

## 背景・課題

状態管理は業務アプリの複雑さの主要因。
画面遷移、セッション、権限の組み合わせは暗黙知になりやすく、
移行時のバグの温床となる。

## 検討内容

（調査中に判明した特記事項をここに記録）

## 決定事項

（抽出完了後に記入）

## 成果物

| 成果物 | 配置先 | 状態 |
|--------|--------|------|
| 状態遷移図（Mermaid） | 本 DD 内 | 未作成 |
| 権限マトリクス | `doc/spec/business-logic/` | 未作成 |
| セッション管理仕様 | 本 DD 内 | 未作成 |

## 信頼度サマリー

| 信頼度 | 件数 |
|--------|------|
| High | 0 |
| Medium | 0 |
| Low | 0 |
| Conflicting | 0 |

## タスク一覧

### Phase 0: 事前精査
- [ ] 📋 各 Phase のタスク精査・詳細化
- [ ] 📋 認証・認可関連コードの特定
- [ ] 😈 **Devil's Advocate調査**

### Phase 1: 画面状態の抽出
- [ ] 画面一覧（ルーティング/URL パターンから抽出）
- [ ] 画面間遷移の条件
- [ ] 画面内の状態変化（表示/非表示、活性/非活性）
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 2: セッション・認証の抽出
- [ ] ログイン/ログアウトフロー
- [ ] セッション管理方式（Cookie、JWT、サーバーセッション等）
- [ ] セッションタイムアウト処理
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 3: 権限・ロールの抽出
- [ ] ユーザーロール一覧
- [ ] ロール別アクセス制御（画面単位、機能単位）
- [ ] 権限チェックの実装箇所
- [ ] 権限マトリクスの作成
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 4: ワークフロー状態遷移
- [ ] 業務データのステータス遷移（承認フロー等）
- [ ] 状態遷移図の作成（Mermaid）
- [ ] 遷移条件と遷移先の網羅
- [ ] 信頼度サマリーの更新
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

## ログ

### {日付}
- DD作成（spec-know-how 起動時に自動生成）

---

## DA批判レビュー記録

### Phase N DA批判レビュー

**DA観点:** （このPhaseで最も壊れやすいポイントは何か？）

| # | 発見した問題/改善点 | 重要度 | 再現手順（高/中は必須） | DA観点 | 対応 |
|---|-------------------|--------|----------------------|--------|------|
| 1 | (具体的に記述) | 高/中/低 | (高/中: 操作→結果) | (どのDA観点で発見したか) | ✅修正済/⏭️別DD/❌不要 |
