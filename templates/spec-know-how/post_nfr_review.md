# DD-{番号}: NFR 総合レビュー

| 作成日 | 更新日 | ステータス | ステージ |
|--------|--------|------------|----------|
| {日付} | {日付} | 進行中 | Post |

## 前提 DD

- Stage 5: 最終仕様（完了必須。スキップ時は Stage 3 完了でも可）

## スキップ判定

スキップ不可。NFR は見落としが最も危険な領域であり、常にレビューする。

## 目的

抽出した仕様全体を非機能要件（NFR）の観点で横断的にレビューする。
セキュリティ、パフォーマンス、運用性、ログ/監査等の抜けがないか確認する。

## 背景・課題

FR（機能要件）の抽出に注力すると NFR が後回しになりがち。
移行後に「ログが足りない」「セキュリティ穴がある」と判明するのを防ぐ。

## 検討内容

### NFR チェックリスト

| カテゴリ | チェック項目 | 既存実装 | 充足度 | 対応要否 |
|---------|-----------|---------|--------|---------|
| セキュリティ | 認証方式 | | | |
| セキュリティ | 認可制御 | | | |
| セキュリティ | 入力サニタイズ | | | |
| セキュリティ | CSRF/XSS 対策 | | | |
| パフォーマンス | レスポンスタイム要件 | | | |
| パフォーマンス | 同時接続数 | | | |
| パフォーマンス | DB クエリ最適化 | | | |
| 可用性 | エラーリカバリ | | | |
| 可用性 | バックアップ/リストア | | | |
| 運用性 | ログ出力（操作ログ、エラーログ） | | | |
| 運用性 | 監査証跡 | | | |
| 運用性 | モニタリング | | | |
| 運用性 | デプロイ手順 | | | |
| データ | データ保持期間 | | | |
| データ | 個人情報の取り扱い | | | |

## 決定事項

（レビュー完了後に記入）

## 成果物

| 成果物 | 配置先 | 状態 |
|--------|--------|------|
| NFR 仕様書 | `doc/spec/nfr/` | 未作成 |
| NFR チェックリスト（記入済み） | 本 DD 内 | 未作成 |

## タスク一覧

### Phase 0: 事前精査
- [ ] 📋 各 Phase のタスク精査・詳細化
- [ ] 📋 Stage 3/5 の全成果物から NFR 関連情報を収集
- [ ] 😈 **Devil's Advocate調査**

### Phase 1: セキュリティレビュー
- [ ] 認証・認可の実装状況確認
- [ ] 入力バリデーション/サニタイズの網羅性
- [ ] CSRF/XSS/SQLi 等の対策状況
- [ ] 機密情報の管理（パスワード、API キー等）
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 2: パフォーマンス・可用性レビュー
- [ ] レスポンスタイム要件の有無と現状
- [ ] DB クエリの N+1 問題等のパターン
- [ ] キャッシュ戦略
- [ ] エラーリカバリ・フェイルオーバー
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 3: 運用・監査レビュー
- [ ] ログ出力の種類と充足度
- [ ] 監査証跡（誰が何をいつ変更したか）
- [ ] バックアップ/リストア手順
- [ ] デプロイ/ロールバック手順
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 4: NFR 仕様書の作成
- [ ] チェックリストの結果を NFR 仕様書として整理
- [ ] 移行時に対応が必要な NFR を優先度付きでリスト化
- [ ] `doc/spec/nfr/` に配置
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

## ログ

### {日付}
- DD作成（spec-know-how 起動時に自動生成）

---

## DA批判レビュー記録

### Phase N DA批判レビュー

**DA観点:** （このPhaseで最も壊れやすいポイントは何か？）

| # | 発見した問題/改善点 | 重要度 | 再現手順（高/中は必須） | DA観点 | 対応 |
|---|-------------------|--------|----------------------|--------|------|
| 1 | (具体的に記述) | 高/中/低 | (高/中: 操作→結果) | (どのDA観点で発見したか) | ✅修正済/⏭️別DD/❌不要 |
