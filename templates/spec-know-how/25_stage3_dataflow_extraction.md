# DD-{番号}: データフロー抽出

| 作成日 | 更新日 | ステータス | ステージ |
|--------|--------|------------|----------|
| {日付} | {日付} | 進行中 | Stage 3 |

## 前提 DD

- Stage 2: 分析スコープ（完了必須）

## スキップ判定

### 判定条件
Stage 2 で データフロー抽出が「スキップ」と判定された場合。

### 判定方法
Stage 2 の「Stage 3 DD のスキップ判定」テーブルを確認。

### スキップ時の記録
このDDをスキップする場合:
1. ステータスを「スキップ」に変更
2. スキップ理由を「決定事項」セクションに記録
3. ポートフォリオインデックス DD の該当行を更新

## 目的

対象コードベースのデータの流れを抽出する。
入力→処理→出力の経路、DB アクセスパターン、外部 API 連携を明確化する。

## 背景・課題

データがどこから来てどこへ行くかは、仕様理解の根幹。
特に DB スキーマとコードの対応関係は暗黙知になりやすい。

## 検討内容

### 抽出対象

（Stage 2 の結果から記入）

| データ経路 | 関連モジュール | 抽出戦略 |
|-----------|-------------|---------|

## 決定事項

（抽出完了後に記入）

## 成果物

| 成果物 | 配置先 | 状態 |
|--------|--------|------|
| データフロー図（Mermaid） | 本 DD 内 | 未作成 |
| DB テーブル定義・リレーション | `doc/spec/business-logic/` | 未作成 |
| 外部 API 連携一覧 | 本 DD 内 | 未作成 |

## 信頼度サマリー

| 信頼度 | 件数 |
|--------|------|
| High | 0 |
| Medium | 0 |
| Low | 0 |
| Conflicting | 0 |

## タスク一覧

### Phase 0: 事前精査
- [ ] 📋 各 Phase のタスク精査・詳細化
- [ ] 📋 DB 関連ファイルの特定（Stage 1 の依存関係分析を参照）
- [ ] 😈 **Devil's Advocate調査**

### Phase 1: DB スキーマ抽出
- [ ] マイグレーションファイル/DDL からテーブル定義を抽出
- [ ] モデル定義（ORM）からリレーションを抽出
- [ ] テーブル間の外部キー関係を図示
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 2: データ入出力経路の追跡
- [ ] ユーザー入力 → バリデーション → 永続化の経路
- [ ] DB 読取 → 加工 → 画面表示の経路
- [ ] バッチ処理/定期実行のデータフロー
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 3: 外部連携の抽出
- [ ] 外部 API 呼び出しの一覧（URL、メソッド、パラメータ）
- [ ] ファイル入出力（CSV、Excel、PDF 等）
- [ ] メール/通知連携
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 4: データフロー図の作成
- [ ] 全体データフロー図（Mermaid）の作成
- [ ] 各経路に信頼度を付与
- [ ] 信頼度サマリーの更新
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

## ログ

### {日付}
- DD作成（spec-know-how 起動時に自動生成）

---

## DA批判レビュー記録

### Phase N DA批判レビュー

**DA観点:** （このPhaseで最も壊れやすいポイントは何か？）

| # | 発見した問題/改善点 | 重要度 | 再現手順（高/中は必須） | DA観点 | 対応 |
|---|-------------------|--------|----------------------|--------|------|
| 1 | (具体的に記述) | 高/中/低 | (高/中: 操作→結果) | (どのDA観点で発見したか) | ✅修正済/⏭️別DD/❌不要 |
