# DD-{番号}: 分析スコープ

| 作成日 | 更新日 | ステータス | ステージ |
|--------|--------|------------|----------|
| {日付} | {日付} | 進行中 | Stage 2 |

## 前提 DD

- Stage 1: 定量棚卸し（完了必須）

## スキップ判定

スキップ不可。全 Stage 3 以降の方針を決定する DD。

## 目的

Stage 1 の定量データに基づき、仕様抽出の広さと深さを決定する。
どのモジュールを深く分析し、どれをスキップするかの方針を立てる。

## 背景・課題

全てのコードを同じ深さで分析するのは非効率。
ビジネス上の重要度と技術的複雑さを軸に優先度をつける必要がある。

## 検討内容

### モジュール分析マトリクス

| モジュール | LOC | 複雑度 | ビジネス重要度 | 分析深度 | 抽出戦略 |
|-----------|-----|--------|--------------|----------|----------|
| （Stage 1 の結果から記入） | | | 高/中/低 | 深い/浅い/スキップ | AST/SQL/手動/- |

### 抽出戦略の選択肢

| 戦略 | 適用条件 | 出力 |
|------|---------|------|
| AST 解析 | Python/JS/TS 等で構造化抽出が有効 | 関数一覧、型情報、呼出関係 |
| SQL 解析 | DB マイグレーション/クエリファイルが存在 | テーブル定義、リレーション |
| 正規表現 | 定型パターンの抽出（定数、設定値） | パターン一致リスト |
| 手動読解 | 上記が適用困難、または小規模 | 人的解釈による仕様記述 |

## 決定事項

### Stage 3 DD のスキップ判定

| Stage 3 DD | 判定 | 理由 |
|------------|------|------|
| FR 仕様抽出 | 実行/スキップ | （理由を記入） |
| データフロー抽出 | 実行/スキップ | （理由を記入） |
| 状態管理抽出 | 実行/スキップ | （理由を記入） |
| エラー処理抽出 | 実行/スキップ | （理由を記入） |

### Stage 4 DD のスキップ判定

| 判定 | 理由 |
|------|------|
| 実行/スキップ | （理由を記入。小規模 or ツール不適合ならスキップ） |

### Post DD のスキップ判定

| Post DD | 判定 | 理由 |
|---------|------|------|
| 移行先設計 | 実行/スキップ | （移行予定の有無） |
| NFR 総合レビュー | 実行 | （常に実行） |
| UI 要件 | 実行/スキップ | （UI の有無） |

## 成果物

| 成果物 | 配置先 | 状態 |
|--------|--------|------|
| モジュール分析マトリクス | 本 DD 内 | 未作成 |
| スキップ判定結果 | 本 DD 内 + ポートフォリオ DD | 未作成 |
| 抽出戦略マップ | 本 DD 内 | 未作成 |

## タスク一覧

### Phase 0: 事前精査
- [ ] 📋 各 Phase のタスク精査・詳細化
- [ ] 📋 Stage 1 成果物の確認
- [ ] 😈 **Devil's Advocate調査**

### Phase 1: モジュールランキング
- [ ] Stage 1 のモジュール一覧に複雑度スコアを付与
- [ ] ビジネス重要度の推定（エントリーポイントからの距離、名前、コメント等）
- [ ] 複雑度 x 重要度マトリクスの作成
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 2: 分析深度の決定
- [ ] 各モジュールを「深い/浅い/スキップ」に分類
- [ ] 分類理由の記録
- [ ] Stage 3 DD 群のスキップ判定
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 3: 抽出戦略の選定
- [ ] 各モジュールに適した抽出戦略を選定
- [ ] Stage 4（機械ツール設計）のスキップ判定
- [ ] 利用可能なツール/ライブラリの確認
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 4: Post DD のスキップ判定
- [ ] 移行予定の有無を確認 → 移行先設計 DD の判定
- [ ] UI 有無を確認 → UI 要件 DD の判定
- [ ] ポートフォリオインデックス DD のスキップ列を更新
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

## ログ

### {日付}
- DD作成（spec-know-how 起動時に自動生成）

---

## DA批判レビュー記録

### Phase N DA批判レビュー

**DA観点:** （このPhaseで最も壊れやすいポイントは何か？）

| # | 発見した問題/改善点 | 重要度 | 再現手順（高/中は必須） | DA観点 | 対応 |
|---|-------------------|--------|----------------------|--------|------|
| 1 | (具体的に記述) | 高/中/低 | (高/中: 操作→結果) | (どのDA観点で発見したか) | ✅修正済/⏭️別DD/❌不要 |
