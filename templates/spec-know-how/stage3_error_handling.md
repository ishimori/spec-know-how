# DD-{番号}: エラー処理抽出

| 作成日 | 更新日 | ステータス | ステージ |
|--------|--------|------------|----------|
| {日付} | {日付} | 進行中 | Stage 3 |

## 前提 DD

- Stage 2: 分析スコープ（完了必須）

## スキップ判定

### 判定条件
Stage 2 で エラー処理抽出が「スキップ」と判定された場合。
例: プロトタイプ段階でエラー処理が未実装。

### 判定方法
Stage 2 の「Stage 3 DD のスキップ判定」テーブルを確認。

### スキップ時の記録
このDDをスキップする場合:
1. ステータスを「スキップ」に変更
2. スキップ理由を「決定事項」セクションに記録
3. ポートフォリオインデックス DD の該当行を更新

## 目的

例外処理、バリデーション、エラーハンドリングのパターンを抽出する。
「何が失敗し得るか、失敗時にどうなるか」を明確化する。

## 背景・課題

エラー処理は仕様書に記載されにくいが、移行時に最も再現漏れしやすい領域。
既存システムの「暗黙のエラー処理」を明文化する。

## 検討内容

（調査中に判明した特記事項をここに記録）

## 決定事項

（抽出完了後に記入）

## 成果物

| 成果物 | 配置先 | 状態 |
|--------|--------|------|
| バリデーションルール一覧 | `doc/spec/business-logic/` | 未作成 |
| エラーハンドリングパターン | 本 DD 内 | 未作成 |
| エラーメッセージ一覧 | 本 DD 内 | 未作成 |

## 信頼度サマリー

| 信頼度 | 件数 |
|--------|------|
| High | 0 |
| Medium | 0 |
| Low | 0 |
| Conflicting | 0 |

## タスク一覧

### Phase 0: 事前精査
- [ ] 📋 各 Phase のタスク精査・詳細化
- [ ] 📋 例外処理パターンの概観（try-catch, error handler 等）
- [ ] 😈 **Devil's Advocate調査**

### Phase 1: 入力バリデーション抽出
- [ ] フォームバリデーション（フロントエンド）
- [ ] API パラメータバリデーション（バックエンド）
- [ ] DB 制約（NOT NULL, UNIQUE, CHECK 等）
- [ ] バリデーションルールをテーブル形式で整理
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 2: 例外処理パターン
- [ ] try-catch / error handler の網羅的な列挙
- [ ] グローバルエラーハンドラの有無と挙動
- [ ] エラー時のリカバリ処理（リトライ、ロールバック等）
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 3: エラーメッセージとユーザー通知
- [ ] ユーザー向けエラーメッセージの一覧
- [ ] エラーコード体系（存在する場合）
- [ ] ログ出力パターン（何をどのレベルで記録するか）
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 4: 整理と信頼度付与
- [ ] 抽出結果をカテゴリ別に整理
- [ ] 各項目に信頼度を付与
- [ ] 信頼度サマリーの更新
- [ ] 😈 **DA批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

## ログ

### {日付}
- DD作成（spec-know-how 起動時に自動生成）

---

## DA批判レビュー記録

### Phase N DA批判レビュー

**DA観点:** （このPhaseで最も壊れやすいポイントは何か？）

| # | 発見した問題/改善点 | 重要度 | 再現手順（高/中は必須） | DA観点 | 対応 |
|---|-------------------|--------|----------------------|--------|------|
| 1 | (具体的に記述) | 高/中/低 | (高/中: 操作→結果) | (どのDA観点で発見したか) | ✅修正済/⏭️別DD/❌不要 |
