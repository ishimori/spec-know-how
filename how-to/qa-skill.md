# QA スキルの作り方

「この機能の仕様は？」という質問に根拠付きで即答できる Claude Code スキルを作る手順を説明します。

---

## QA スキルとは

QA スキルは `/qa <質問>` のように呼び出すと、仕様書を参照して根拠付きの回答を返すスキルです。

```
/qa 残業60時間境界の計算はどうなっている？
→ doc/spec/business-logic/01_overtime.md の BR-012 を参照...
   計算式: (...) 、根拠コード: src/services/payroll.py:142
   信頼度: High（コード突合済み）
```

コードを読まなくても仕様を確認できるため、以下のシーンで役立ちます：
- 新メンバーのオンボーディング
- 仕様問い合わせへの即答
- 移行・改修時の影響範囲確認

> **教訓**: QA スキル自体に「賢さ」は不要。仕様書の構造が良ければ、シンプルな検索・引用で高精度な回答ができる。性能を決めるのはスキルではなく仕様書の質。（[参考: lessons_learned #5](../references/lessons_learned.md)）

---

## 前提: 仕様書が必要

QA スキルは仕様書を読んで回答するので、まず仕様書を作る必要があります。
[GUIDE.md](../GUIDE.md) の Step 1〜5 を完了してから取り掛かってください。

---

## 作り方（4ステップ）

### Step 1: 仕様書の置き場所を決める

プロジェクト内で仕様書をどこに置くかを決めます。

```
your-project/
└── doc/
    └── spec/
        ├── business-logic/     # 業務ロジック仕様
        │   ├── 00_constants.md # 定数・定義値
        │   ├── 01_overtime.md  # 残業計算
        │   └── 02_payroll.md   # 給与計算
        ├── nfr/                # 非機能要件
        └── database/           # DB仕様
```

**ポイント**: 仕様書の定数・共通値は `00_constants.md` に一元管理する。同じ値を複数ファイルに書くと不整合の温床になる。

### Step 2: ドキュメントマップを作る

どのキーワードがどの仕様書に対応するかのマッピングを作ります。これが QA スキルの索引になります。

```markdown
# ドキュメントマップ

| キーワード | 参照先 |
|-----------|--------|
| 残業、時間外、深夜 | doc/spec/business-logic/01_overtime.md |
| 給与、支給額、控除 | doc/spec/business-logic/02_payroll.md |
| 有休、有給、休暇 | doc/spec/business-logic/03_leave.md |
| テーブル、カラム、DB | doc/spec/database/ |
```

このマップは `CLAUDE.md`（プロジェクトの AI 向け設定ファイル）か、スキル定義内に書きます。

### Step 3: スキル定義ファイルを書く

プロジェクトの `.claude/skills/qa/SKILL.md` を作成します。

**テンプレート**:

```markdown
---
name: qa
description: 仕様書からの回答検索
---

# QA スキル

## 使い方
/qa <質問>

## 処理フロー

### Step 1: キーワード抽出
質問からキーワードを抽出し、ドキュメントマップで参照先仕様書を特定する。

**ドキュメントマップ**:
| キーワード | 参照先 |
|-----------|--------|
| （ここにプロジェクト固有のマッピングを書く） |

### Step 2: 仕様書から回答を抽出
特定した仕様書を Read ツールで読み込み、該当ルールを特定する。

注意:
- [VERIFIED] の仕様書は信頼度が高い（コード突合済み）
- [DRAFT] の仕様書は参考程度（使う前に検証が必要）

### Step 3: 回答を出力
以下のフォーマットで出力する:

## QA 回答
**質問**: {質問}
**参照先**: {仕様書ファイルパス}
**回答**: {仕様書に基づく回答}
**信頼度**: {High / Medium / Low / Conflicting}
```

### Step 4: 動作確認

いくつか質問してみて、期待通りの回答が返るか確認します。

**確認ポイント**:
- 回答に参照先（ファイルパス・ルール番号）が含まれているか
- 仕様書に記載がない質問に「記載なし」と明示されるか
- 信頼度が正しく表示されるか

---

## カスタマイズ: コード突合の追加

仕様書の記述をコードで裏付ける「突合機能」を追加することで、信頼度を上げられます。

AST 解析や Grep による機械的な突合が有効です。言語に応じたツール（Python なら `ast` モジュール等）を活用してください。

```markdown
### Step 3（オプション）: コードで検証
仕様書の記述を Grep/Read ツールでコードと照合し、一致・差異を報告する。

- 一致: 信頼度 High
- 差異あり: 差異の内容を報告
- コードで未確認: 信頼度 Medium 以下
```

---

## よくある失敗

**仕様書の構造が検索しにくい**

問題: 仕様書が長い散文になっていて、キーワード検索で特定できない。

対策: ルールに採番する（BR-001, BR-002...）。計算式は曖昧さなく数式で書く。

**定数が複数ファイルに散在している**

問題: 同じ値が複数ファイルに書かれていて、片方だけ更新されて不整合が起きる。

対策: `00_constants.md` に一元管理し、他ファイルはそこを参照するだけにする。

**仕様書の信頼度が不明**

問題: どのドキュメントが最新・正確かわからない。古い設計書を参照してしまう。

対策: 全仕様書に `[VERIFIED]` または `[DRAFT]` ラベルをつける。VERIFIED はコード突合済みのもの限定。
