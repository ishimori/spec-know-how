# DD-008: SP 横断品質チェック

| 作成日 | 更新日 | ステータス |
|--------|--------|------------|
| 2026-02-27 | 2026-02-27 | 人間が確認中 |

## 目的

SP-000〜SP-003（19ファイル）を5つの観点で横断的にチェックし、
個別設計では見えない問題（引き継ぎ漏れ・重複・スキップ条件の非対称性・構造の不統一）を発見・修正する。
発見した知見は DD-005〜007（SP-004〜006 設計）への申し送りとして記録する。

## 背景・課題

SP-001〜SP-003 は DD-002〜004 の申し送りパターンに従って個別設計された。
各 DD のレビューは「この SP 単体として正しいか」の観点で行われており、
「SP 間の情報フローが繋がっているか」「SP-000 の全グループが後続 SP に対応しているか」
という横断的な確認が行われていない。

## 検討内容

5つの横断チェック観点：

| 観点 | 確認内容 |
|------|---------|
| 1 縦の情報フロー | SP-000 グループ A〜F の引き継ぎ先が全 SP に存在するか |
| 2 横の責務分担 | 同じ情報を複数 SP が記録していないか / 誰も記録しない情報がないか |
| 3 スキップ条件の対称性 | SP-000 グループと SP スキップ条件のマッピングに漏れがないか |
| 4 構造統一性 | 親80行・末尾3セクション・Gate 6Phase・命名規則が全 SP で統一されているか |
| 5 境界の明確性 | 隣接 SP 間の責務境界が両側から明示されているか |

## 決定事項

### 修正対象ファイル

| ファイル | 修正内容 | 対応観点 |
|---------|---------|---------|
| `doc/SP/SP-003.md` | #1 に SP-002 成果物確認ステップを追加 | 観点1 縦フロー |
| `doc/SP/SP-000.md` | 引き継ぎメモの SP-005 行に GroupE 条件を追記 | 観点3 スキップ条件 |
| `doc/SP/SP-001-gate.md` | Phase 3 の形式を SP-002/003-gate に合わせる（チェックボックス＋検証記録テーブル） | 観点4 構造統一 |

### DD-005〜007 への申し送り

（Phase 3 で記録）

## 成果物

| Phase | 内容 |
|-------|------|
| Phase 1 | 横断チェック記録（SP-000 グループ A〜F マッピング表・発見問題一覧） |
| Phase 2 | 修正した SP ファイル群 |
| Phase 3 | 本 DD 末尾の申し送りセクション |

## タスク一覧

### Phase 0: 事前精査
- [x] 📋 **各 Phase のタスク精査・詳細化**
- [x] 5つのチェック観点を定義した
- [x] SP-000〜SP-003 の全ファイルを読んで問題仮説を立てた
- [x] 😈 **Devil's Advocate 調査**
  - 横断チェックが網羅的でなく、重要な問題を見落とす可能性は？→ 観点を5つに絞り、各観点に具体的な確認項目を設けることで網羅性を担保。完全網羅は困難だが、「発見した問題は必ず対応」を原則にする
  - 修正が多すぎてキリがなくなるリスクは？→ 修正対象は「実際にユーザーが SP を使う際に問題になる」レベルに絞る。スタイルの統一のみを目的とした修正は Low として扱い、申し送りに記録する

### Phase 1: 横断チェック実施
- [x] 観点1〜5 の横断チェックを実施した
- [x] 発見した問題を記録した
- [x] SP-000 グループ A〜F のマッピング表を作成した
- [x] 😈 **DA 批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 2: 発見問題の修正
- [x] SP-003.md を修正した（#1 に SP-002 成果物確認を追加）
- [x] SP-000.md を修正した（引き継ぎメモ SP-005 行に GroupE 条件を追記）
- [x] SP-001-gate.md を修正した（Phase 3 形式を統一）
- [x] 😈 **DA 批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 3: DD-005〜007 向け申し送り
- [x] 横断チェックで確立したルール・注意点を末尾申し送りに記録した

## ログ

### 2026-02-27
- DD 作成・Phase 0 完了: 5観点定義、SP-000〜003 全読み、問題仮説立案、DA批判レビュー
- Phase 1 完了: 横断チェック実施（3件の問題発見）、グループ A〜F マッピング表作成
- Phase 2 完了: SP-003.md・SP-000.md・SP-001-gate.md を修正
- Phase 3 完了: DD-005〜007 向け申し送りを記録

---

## DA 批判レビュー記録

### Phase 0 DA 批判レビュー

**DA 観点:** 横断チェックの見落とし・過剰修正のリスクは？

| # | 発見した問題/改善点 | 重要度 | DA 観点 | 対応 |
|---|-------------------|--------|--------|------|
| 1 | 横断チェックの「観点5: 境界の明確性」は SP-004 以降がまだ存在しないため、SP-003/SP-004 の境界（一方向しかない）のみしか確認できない | Low | 片方しか存在しない境界は「SP-004 側に境界明示を追加すること」を申し送りに記録すれば十分 | Phase 3 申し送りに記録 |

### Phase 1 DA 批判レビュー

**DA 観点:** 発見した問題に見落とし・誤検出はないか？

| # | 発見した問題/改善点 | 重要度 | DA 観点 | 対応 |
|---|-------------------|--------|--------|------|
| 1 | SP-001-gate の Phase 3 形式差異を「問題」と判断したが、SP-001-gate は DD-002 時代の設計であり、SP-002/003-gate が改善版である。形式変更が SP-001-gate の実用上の問題を引き起こすか検証する必要がある | Low | 実際にユーザーが SP-001-gate を使う際に「チェックボックスがないと使いにくい」かどうかが基準 | 使い勝手向上のため修正対象として維持。Low 優先度で対応 |

### Phase 2 DA 批判レビュー

**DA 観点:** 修正によって既存の設計意図が壊れる可能性はないか？

| # | 発見した問題/改善点 | 重要度 | DA 観点 | 対応 |
|---|-------------------|--------|--------|------|
| 1 | SP-003.md に「SP-002 成果物確認」を追加すると、SP-002 がスキップ（DB なし）のケースで確認ステップが不整合になる可能性 | Medium | SP-002 スキップ時は確認する成果物がない → 確認ステップは「SP-002 が実施された場合のみ」と条件付きにする必要がある | SP-003.md #1 の追加ステップに「SP-002 を実施した場合は…」という条件を明記して対応 |

---

## Phase 1: 横断チェック記録

### SP-000 グループ A〜F マッピング表

| グループ | 内容 | 引き継ぎ先 SP | 引き継ぎ形式 | 状態 |
|---------|------|-------------|------------|------|
| A 基本情報・作業目的 | プロジェクト名・パス・バックエンド言語 | SP-001（管理記録 #2 で転記） | 管理記録テーブル | ✓ 対応済み |
| B 既存ドキュメント | ドキュメント有無・種類 | SP-001（管理記録 #2 + SP-001-03 実行条件） | 管理記録 + 実行条件分岐 | ✓ 対応済み |
| C データベース | DB 有無・スキーマ形式・DB 種類 | SP-002（スキップ条件 + SP-002-01 の形式選択） | 親 #1 スキップ判断 | ✓ 対応済み |
| D フロントエンド | FE 有無・フレームワーク | SP-003（スキップ条件） | 親 #1 スキップ判断 | ✓ 対応済み |
| E 外部連携・認証 | 外部連携有無・システム数・認証方式 | SP-004・SP-005（未作成）、SP-000 引き継ぎメモは「常に実施」のみ | 引き継ぎメモの記述が不十分 | ⚠️ 要改善 |
| F 機械処理言語 | Python / Node.js | SP-001-02（ツール選定） | SP-001 管理記録 | ✓ 対応済み |

---

### 観点1: 縦の情報フロー チェック結果

| 確認項目 | 結果 | 詳細 |
|---------|------|------|
| SP-000 → SP-001 の情報転記（管理記録） | ✓ OK | SP-001 #2 で GroupA/B/F の情報を転記する設計 |
| SP-001 完了が SP-002/003 の前提になっているか | ✓ OK | SP-002/003 各 #1 に「SP-001 完了確認」が明記 |
| SP-002 成果物が SP-003 から参照できるか | ⚠️ 不足 | SP-003 #1 に SP-002 DB仕様書の確認ステップがない |
| SP-003-03 の引き継ぎリストが SP-004 から参照できるか | ⚠️ 未確認 | SP-004 が未作成のため SP-004 側の受け取り口が存在しない（DD-005 で対処） |

---

### 観点2: 横の責務分担 チェック結果

| 確認項目 | 結果 | 詳細 |
|---------|------|------|
| DBスキーマ情報の記録先（SP-001-01 vs SP-002） | ✓ OK | SP-001-01 Phase 2 は「DB の定量把握」、SP-002-01 は「スキーマ取得・詳細」で分担明確 |
| 既存ドキュメント棚卸し（SP-001-03 vs 他） | ✓ OK | SP-001-03 のみが担当 |
| 依存ライブラリ（SP-001-02 vs 他） | ✓ OK | SP-001-02 のみが担当 |
| UI層ビジネスロジック（SP-003-03 vs SP-004） | ✓ OK | SP-003-03「確認のみ」、SP-004「仕様化」の分担が明記済み |
| 誰も記録しない情報がないか | ✓ OK（現行 SP の範囲では） | GroupE の外部連携は SP-004/005 で扱う予定 |

---

### 観点3: スキップ条件の対称性 チェック結果

| SP | スキップ条件 | SP-000 との対応 | 状態 |
|----|-----------|--------------|------|
| SP-001 | スキップなし（常に実施） | GroupA/B/F を参照 | ✓ OK |
| SP-002 | GroupC「DB なし」→ スキップ | SP-000 回答パターン表に記載 ✓ | ✓ OK |
| SP-003 | GroupD「FE なし」→ スキップ | SP-000 回答パターン表に記載 ✓ | ✓ OK |
| SP-004 | 常に実施（GroupE 認証方式は影響なし） | SP-000 引き継ぎメモに記載 ✓ | ✓ OK |
| SP-005 | 外部連携数5以上で分割推奨 | SP-000 回答パターン表に記載あり、引き継ぎメモには記載なし | ⚠️ 引き継ぎメモ不足 |

---

### 観点4: 構造統一性 チェック結果

| 確認項目 | SP-001系 | SP-002系 | SP-003系 | 判定 |
|---------|---------|---------|---------|------|
| 親チケット行数（80行以内） | 80行 | 80行 | 70行 | ✓ OK |
| 末尾3セクション（子チケット） | ✓ | ✓ | ✓ | ✓ OK |
| Gate 6Phase 構成 | ✓ | ✓ | ✓ | ✓ OK |
| #N 命名（親） | ✓ | ✓ | ✓ | ✓ OK |
| Phase N 命名（子） | ✓ | ✓ | ✓ | ✓ OK |
| 位置づけセクション（子） | ✓ | ✓ | ✓ | ✓ OK |
| Gate Phase 3 の形式 | テーブル形式（旧） | チェックボックス＋テーブル（新） | チェックボックス＋テーブル（新） | ⚠️ SP-001-gate が旧形式 |

---

### 観点5: 境界の明確性 チェック結果

| 境界 | 明示状況 | 状態 |
|------|---------|------|
| SP-001-01（DB定量把握）/ SP-002-01（スキーマ取得） | SP-001-01 Phase 2 は「DBの有無・概算のみ」と明記。SP-002-01 が詳細を担当 | ✓ OK |
| SP-003-03（UI層ロジック確認）/ SP-004（仕様化） | SP-003-03 に「在処の確認のみ・仕様化は SP-004」と明記 | ✓ OK |
| SP-004（業務ロジック）/ SP-005（非機能要件）境界 | SP-004 が未作成のため SP-005 側からの確認不可 | ⚠️ SP-004 作成時に両側から明示が必要 |

---

### 発見問題サマリー

| # | 観点 | 問題内容 | 重要度 | 修正対象 |
|---|------|---------|--------|---------|
| 1 | 縦フロー | SP-003.md #1 に SP-002 成果物確認ステップがない | Medium | SP-003.md |
| 2 | スキップ条件 | SP-000 引き継ぎメモの SP-005 行に GroupE 条件（外部連携数5以上→分割推奨）がない | Low | SP-000.md |
| 3 | 構造統一 | SP-001-gate Phase 3 が旧テーブル形式（SP-002/003-gate はチェックボックス＋テーブル） | Low | SP-001-gate.md |

---

## SP-横断チェック 申し送り（DD-005〜007 向け）

> SP-004〜006 を設計する DD-005〜007 では、以下のルールを追加で遵守すること。
> DD-002/003/004 の申し送りに加えて適用する。

### ルール1: 縦フロー — 上流 SP の成果物参照ステップを必ず追加

**背景**: SP-002 → SP-003 の引き継ぎで「SP-002 成果物を SP-003 が参照する指示がない」問題が発生した。

**ルール**: 各 SP の親チケット #1（前提確認）に、直前の SP が作成した成果物ファイルの確認ステップを追加すること。

```markdown
### [ ] #1: 前提確認

- [前の SP] の完了を確認する
- [前の SP] で作成した成果物ファイルが存在することを確認する（実DBアクセス不可等でスキップされた場合はその理由を確認する）
```

**適用例**:
- SP-004 #1 に「SP-003-context で作成した画面仕様書ファイルの確認」を追加
- SP-005 #1 に「SP-004-context で作成した業務ロジック仕様書の確認」を追加

---

### ルール2: スキップ条件 — SP-000 グループ E の引き継ぎ

**背景**: SP-000 GroupE（外部連携・認証）は「SP-004・SP-005 で使用」と記載されているが、
SP-004/005 の親チケット設計時にこれが忘れられやすい。

| SP | GroupE の引き継ぎ内容 |
|----|---------------------|
| SP-004 | 認証方式（Q13）→ OAuth/SAML の場合、認証フロー仕様の確認工数が増える旨を Phase 設計に反映 |
| SP-005 | 外部連携数（Q12）→ 5以上の場合 SP-005 の分割を検討。認証方式（Q13）→ SP-005 の作業範囲に認証フロー仕様を含める |

---

### ルール3: 構造統一 — Gate Phase 3 はチェックボックス＋検証記録テーブルで統一

**背景**: SP-001-gate の Phase 3 は旧テーブル形式（Pass/Fail のみ）。SP-002/003-gate はチェックボックス＋検証記録テーブル形式（新）。

**ルール**: DD-005〜007 で作成する Gate チケットの Phase 3 は以下の形式で統一すること。

```markdown
## Phase 3: LLM 検証

> 先行子チケットのファイルを実際に読んで確認すること。「たぶん書いてあった」禁止。

- [ ] [チケット名]を読み、[確認項目]が記録されていることを確認した
...

### 検証記録

| チェック項目 | 確認結果 | 備考 |
|-----------|---------|------|
| [項目] | OK / NG / 部分的 | - |
```

---

### ルール4: 境界の明確性 — SP-004/005 の境界を両側から明示

**背景**: SP-003/SP-004 の境界は SP-003-03 側から明示済みだが、SP-004 側の受け取り口がまだない。

**ルール**:
- SP-004 作成時: SP-003-03 の「SP-004 への引き継ぎリスト」を受け取るステップを冒頭 Phase に追加する
- SP-005 作成時: SP-004 との責務境界を位置づけセクションに明記する
