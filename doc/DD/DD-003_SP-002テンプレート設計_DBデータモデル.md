# DD-003: SP-002 テンプレート設計（DB・データモデル）

| 作成日 | 更新日 | ステータス |
|--------|--------|------------|
| 2026-02-24 | 2026-02-24 | 進行中 |

## 目的

SP-002（DB・データモデル）の親チケットテンプレートを設計・作成する。

## 背景・課題

既存の `sample_prompts/02_DBデータモデル.md` は環境差異に対応できない。
代表的な失敗例：
- DB が存在しないのに DDL を探そうとする
- DDL がなく DUMP ファイルしかないのに DDL を要求する

SP-002 では SP-000 の環境プロファイル（DB 有無・スキーマ情報の形式）を参照し、
実際の環境に合わせた調査方法を選択してから作業を開始する。

## 検討内容

`sample_prompts/02_DBデータモデル.md` のポイント：
- DDL/ERD 取得、テーブル一覧作成、外部キー関係把握
- テーブル数30以上時に分割推奨（スキーマ取得／テーブル詳細／マスタデータで3〜4 DD）
- マスタデータの具体値把握（識別子の不一致バグ防止）

SP-002 として再設計する際の論点：
- SP-000 の「スキーマ情報の形式」（DDL/DUMP/マイグレーション/なし）によって
  調査手順が大きく変わる → 分岐パターンをどう表現するか
- DB がない場合は SP-002 をスキップできる設計にするか

## 決定事項

（Phase 1 設計後に記載）

## タスク一覧

### Phase 0: 事前精査
- [ ] 📋 **各 Phase のタスク精査・詳細化**
- [ ] `sample_prompts/02_DBデータモデル.md` を読んで SP 形式への転換ポイントを整理する
- [ ] 😈 **Devil's Advocate 調査**
  - DB なし・DUMP のみ・DDL のみ等、各ケースで SP-002 が正しく動くか？
  - スキップ条件（DB なし）は SP スキルに組み込むか、テンプレートに記載するか？

### Phase 1: 設計
- [ ] SP-002 の「環境確認フロー」を設計する（SP-000 のどの項目を確認するか）
- [ ] スキーマ形式別の調査手順分岐を定義する（DDL/DUMP/マイグレーション/なし）
- [ ] 子チケット動的生成の条件・分割パターンを定義する（テーブル数基準等）
- [ ] GUIDE.md Step 2 との対応を確認する
- [ ] 😈 **DA 批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 2: 実装
- [ ] SP-002 テンプレートファイルを作成する（`doc/SP/SP-002.md`）
- [ ] テンプレートで環境分岐・子チケット生成指示が機能するか確認する
- [ ] 😈 **DA 批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

## ログ

### 2026-02-24
- DD 作成（DD-001 Phase 2 の切り出し）

---

## DA 批判レビュー記録

### Phase N DA 批判レビュー

**DA 観点:** （Phase 完了後に記録）

| # | 発見した問題/改善点 | 重要度 | 再現手順 | DA 観点 | 対応 |
|---|-------------------|--------|----------|--------|------|
| 1 | （記録予定） | - | - | - | - |
