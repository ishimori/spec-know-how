# DD-012: SP連番とマニュアルStep番号の対応ずれ調査

| 作成日 | 更新日 | ステータス |
|--------|--------|------------|
| 2026-02-27 | 2026-02-27 | 完了 |

## 目的

SP-000〜006 と `manuals/01_仕様書作成マニュアル.md` の Step/Gate 番号対応関係にずれがないかを確認し、修正が必要な箇所を特定・修正する。

## 背景・課題

会話の中で「マニュアルのStep 2（業務ロジック）はどのSPが対応するか？」を確認したところ、以下のズレが発覚した：

- SP-000 の対応表では「Step 2 → SP-002」と記載されているが、実際に「業務ロジック抽出」というタイトルを持つのは **SP-004**
- 各 SP の gate ファイルが独自の Gate 番号（Gate 2〜6）を持つが、マニュアルの Gate は 0〜4 の 5 つしかない

他にも同種のずれがないかを網羅的に確認する。

## 検討内容

### 現状の対応表（SP-000.md 記載）

| フェーズ | 対応SP | SP-000記載ゴール |
|--------|--------|-------|
| Step 0: 移行判断 | SP-000 | 「作り直すべきか？」の判断と品質保証戦略の確立 |
| Step 1: ドキュメント棚卸し | SP-001 | コードベース・ドキュメントの全量把握と信頼度評価 |
| Step 2: 業務ロジック抽出 | SP-002 | DBスキーマ・コードから仕様書を機械的に抽出 |
| Step 3: 設計 | SP-003〜005 | 画面・API・外部連携の仕様化 |
| Step 4: 横断検証 | SP-006 | 全仕様書の整合性確認とGate通過 |

### 実際のSPタイトルとゲート番号

| SP | 実タイトル | SP内Gate番号 | Gate説明 |
|----|-----------|------------|---------|
| SP-000 | 環境プロファイリング | Gate 0 | 移行判断・品質保証戦略の確立 |
| SP-001 | 初回調査 | Gate 1 | ドキュメント棚卸し完了基準（マニュアル 3.2 Gate 1 対応） |
| SP-002 | DB・データモデル取得 | Gate 2 | 「DB情報取得チェックリスト」 |
| SP-003 | 画面・UI把握 | Gate 3 | 「画面把握チェックリスト」 |
| SP-004 | **業務ロジック抽出** | Gate 4 | 「業務ロジック抽出チェックリスト」 |
| SP-005 | 非機能要件確認 | Gate 5 | 「非機能要件確認チェックリスト」 |
| SP-006 | QA準備完了 | Gate 6 | 「QA準備完了チェックリスト」 |

### 発見したズレ一覧

| # | 場所 | ずれの内容 | 深刻度 |
|---|------|-----------|--------|
| Z-1 | SP-000 対応表 | Step 2 → SP-002 と記載、実際は SP-004 が「業務ロジック抽出」の本体。SP-003 も Step 2 相当 | 高 |
| Z-2 | SP-000 対応表 | Step 3（設計）→ SP-003〜005 と記載、実際は SP-003〜005 は業務ロジック抽出系（≒ Step 2 相当） | 高 |
| Z-3 | SP-000 対応表 | マニュアルの Step 3（DB設計・アーキテクチャ・垂直スライス）に対応する SP が存在しない | 中 |
| Z-4 | 各gate ファイル | SP内 Gate 番号（Gate 2〜6）がマニュアルの Gate 番号（Gate 0〜4）と 1:1 対応していない | 中 |
| Z-5 | SP-002-gate | 「Gate 2」を名乗るが、マニュアルの Gate 2（全仕様書[VERIFIED]）とは異なる定義 | 中 |
| Z-6 | SP-005-gate、SP-006-gate | 「Gate 5」「Gate 6」を名乗るが、マニュアルには Gate 5・6 が存在しない | 中 |

### 実態に即した対応関係（あるべき姿）

| マニュアル Step/Gate | 対応SP | 備考 |
|---------------------|--------|------|
| Step 0 / Gate 0 | SP-000 | 一致 |
| Step 1 / Gate 1 | SP-001 | 一致 |
| Step 2（業務ロジック抽出）/ Gate 2 | SP-002 + SP-003 + SP-004 | SP-000 対応表が「SP-002のみ」と誤記 |
| Step 3（設計）/ Gate 3 | **対応SPなし** | 設計フェーズのSPが未作成 |
| Step 4（横断検証）/ Gate 4 | SP-005 + SP-006 | SP-000 対応表では「SP-006のみ」と記載 |

## 決定事項

- SP-000.md の対応表を実態に合わせて修正する（Z-1・Z-2）
- Gate 番号の独自採番（Z-4〜Z-6）は SP 独自体系として維持する（変更コストに対してメリット小）
- Step 3（設計）の対応SP不在（Z-3）は今後の課題として残置する

## タスク一覧

### Phase 0: 事前精査
- [x] SP-000〜006 の全親チケット・gate ファイルを読み込み、ずれ一覧を作成
- [x] 😈 **Devil's Advocate調査**
  - Gate 独自採番は SP 単体で完結するための意図的設計と判断 → 修正不要
  - SP-000 対応表の Step 3 記載は設計意図でなく単純な誤記と確認 → 修正対象

### Phase 1: 修正方針の確定
- [x] Z-1〜Z-2: SP-000 対応表を修正する
- [x] Z-3: Step 3 対応SP不在は残置（別途SPを追加するかは将来判断）
- [x] Z-4〜Z-6: Gate 独自採番は SP 独自体系として維持
- [x] 😈 **DA批判レビュー**: 対応表修正により「Step 3（設計）に対応SPなし」が明示されることで、ユーザーが設計フェーズのSP不在に気づきやすくなる（むしろポジティブ）

### Phase 2: 修正実施
- [x] SP-000 対応表の修正（Z-1・Z-2）
- [x] 😈 **DA批判レビュー**: GUIDE_SPEC.md など他ドキュメントへの波及は現時点でなし（SP-000 対応表のみの記載だった）

## ログ

### 2026-02-27
- DD作成
- Phase 0 調査完了。ずれ Z-1〜Z-6 を特定
- SP-000.md 対応表を修正（Z-1・Z-2）。完了

---

## DA批判レビュー記録

### Phase 0 DA批判レビュー

**DA観点:** SP の Gate 独自採番が「意図的設計」である可能性を検証したか？

| # | 発見した問題/改善点 | 重要度 | 再現手順 | DA観点 | 対応 |
|---|-------------------|--------|---------|--------|------|
| 1 | (Phase 1 実施後に記入) | - | - | - | - |
