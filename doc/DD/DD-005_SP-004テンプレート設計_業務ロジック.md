# DD-005: SP-004 テンプレート設計（業務ロジック）

| 作成日 | 更新日 | ステータス |
|--------|--------|------------|
| 2026-02-24 | 2026-02-24 | 進行中 |

## 目的

SP-004（業務ロジック）の親チケットテンプレートを設計・作成する。

## 背景・課題

既存の `sample_prompts/04_業務ロジック.md` は環境差異に対応できない。
また、業務ロジックは最も複雑で分割が難しいため、
環境に合わせた切り出し方を事前に決めることが重要。

GUIDE.md の教訓として「UI 層の submit/save 関数に埋まったバリデーション 12 条件が
丸ごと見落とされたケース」があり、SP-003 との連携も重要。

## 検討内容

`sample_prompts/04_業務ロジック.md` のポイント：
- 主要業務フロー、計算ロジック、バリデーションルール
- 状態遷移、外部システム連携の仕様書化
- 主要フロー5以上時に分割推奨（3〜4 DD）

SP-004 として再設計する際の論点：
- SP-003 で把握した UI 層ロジックを SP-004 に引き継ぐ連携方法
- 外部システム連携がある場合の追加タスク定義
- 信頼度ラベル（High/Medium/Low/Conflicting）の付与を明示的に要求するか

## 決定事項

（Phase 1 設計後に記載）

## 成果物

| Phase | ファイル | 説明 |
|-------|---------|------|
| Phase 2 | [doc/SP/SP-004.md](doc/SP/SP-004.md) | SP-004 親チケットテンプレート |

## タスク一覧

### Phase 0: 事前精査
- [ ] 📋 **各 Phase のタスク精査・詳細化**
- [ ] `sample_prompts/04_業務ロジック.md` を読んで SP 形式への転換ポイントを整理する
- [ ] 😈 **Devil's Advocate 調査**
  - UI 層ロジックの引き継ぎが失敗するケースは？
  - 外部システム連携がある場合のタスク爆発リスクは？

### Phase 1: 設計
- [ ] SP-004 の「環境確認フロー」を設計する（外部システム連携有無・主要フロー数）
- [ ] SP-003 からの UI 層ロジック引き継ぎフローを定義する
- [ ] 子チケット動的生成の条件・分割パターンを定義する（フロー数基準等）
- [ ] 信頼度ラベル付与の指示をテンプレートに含めるか決める
- [ ] GUIDE.md Step 4 との対応を確認する
- [ ] 😈 **DA 批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 2: 実装
- [ ] SP-004 テンプレートファイルを作成する（`doc/SP/SP-004.md`）
- [ ] テンプレートで環境確認フロー・子チケット生成指示が機能するか確認する
- [ ] 😈 **DA 批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

## ログ

### 2026-02-24
- DD 作成（DD-001 Phase 2 の切り出し）

---

## DA 批判レビュー記録

### Phase N DA 批判レビュー

**DA 観点:** （Phase 完了後に記録）

| # | 発見した問題/改善点 | 重要度 | 再現手順 | DA 観点 | 対応 |
|---|-------------------|--------|----------|--------|------|
| 1 | （記録予定） | - | - | - | - |
