# DD-001: SP スキル導入 プロジェクト憲章

| 作成日 | 更新日 | ステータス |
|--------|--------|------------|
| 2026-02-24 | 2026-02-24 | 進行中 |

## 目的

spec-know-how に **SP スキル**（仕様抽出専用チケット機能）を導入し、
不安定なサンプルプロンプトを廃止・置き換える。

## 背景・課題

### 何がつらいか

`sample_prompts/` のプロンプトをコピーして Claude に貼り付けると、
意図しない動作が発生することがある。

具体的な失敗パターン：
- DB が存在しないプロジェクトに対して DB 調査を実行しようとする
- DDL を探そうとするが、実際には DUMP ファイルしか存在しない
- 環境差異に関係なく同じ手順を実行しようとする

根本原因：サンプルプロンプトは**環境を問わず同じ指示**を実行しようとするが、
プロジェクトによって環境・構成が大きく異なるため、Claude の解釈がブレる。

### 何を思って今回のアクションを定めたか

以下の洞察から SP スキル導入を決定した：

1. **問題は「形式（DD）」ではなく「内容（環境非対応）」**
   → 新しいスキルを作っても、環境差異への対応がなければ同じ問題が再発する

2. **環境プロファイリング（SP-000）を最初に置く**
   → 「DBがあるか」「スキーマ情報の形式は」を事前に記録しておくことで、
     後続チケットが環境に合わせた作業を行える

3. **確認ステップを設ける**
   → SP-001 開始時に「SP-000 の情報を読んで、こういう理解でよいか？」と
     Claude がユーザーに確認してから作業を始める設計にする
   → 現状の「Claude が解釈を外したまま突き進む」問題を根本解決する

4. **親チケット（固定）＋子チケット（動的）の階層構造**
   → SP-001（親・固定）→ SP-001-01, SP-001-02（子・動的生成）
   → 番号順に進めれば間違いない安心感を提供する

### SP と DD の役割分担

| スキル | 用途 | 誰が使うか |
|--------|------|-----------|
| SP | 仕様抽出フェーズのチケット管理 | インポート先プロジェクト |
| DD | 実装フェーズのチケット管理 | インポート先プロジェクト（別途インポート） |

SP スキルは spec-know-how からインポートされる成果物。
DD スキルは別リポジトリ（dd-know-how）からインポートされる成果物。
両者は独立して共存できる。

## 決定事項

### SP スキルの基本設計

**インポート対象:**
```
（spec-know-how から）
├── .claude/skills/sp.md        ← /sp スキル本体
└── doc/SP/
    ├── SP-000.md               ← 環境プロファイリング（固定テンプレート）
    ├── SP-001.md               ← 初回調査（親チケット・固定テンプレート）
    ├── SP-002.md               ← DB データモデル（親チケット・固定テンプレート）
    ├── SP-003.md               ← 画面 UI（親チケット・固定テンプレート）
    ├── SP-004.md               ← 業務ロジック（親チケット・固定テンプレート）
    ├── SP-005.md               ← 非機能要件（親チケット・固定テンプレート）
    └── SP-006.md               ← QA 準備完了（親チケット・固定テンプレート）
    （インポート先で動的に生成される例）
    ├── SP-001-01.md
    └── SP-001-02.md
```

**SP-000 の役割:**
- 環境プロファイリング専用チケット
- Claude がユーザーに質問し、回答を構造化して記録する
- 後続の全 SP チケットがここを参照する

**SP-001〜006 の起動フロー:**
1. ユーザーが「SP-001 を開始して」と指示
2. Claude が SP-000 を読み込む
3. Claude が「○○という環境ですが、この理解で正しいですか？」と確認
4. ユーザーが Yes → 環境に適した SP-001-01 を動的生成して作業開始

### SP-000 の位置づけ（確定）

SP-000 は SP-001〜006 と同じ「チケット」として扱う。

| 性質 | SP-001〜006 | SP-000 |
|------|------------|--------|
| 消えるか | 完了後アーカイブ | SP-001〜006 全完了後にアーカイブ |
| 誰が書くか | Claude が調査 | ユーザーが回答 |
| 情報源 | コードベース | ユーザーの知識 |

**SP-000 のアーカイブ禁止条件**: SP-001〜006 のいずれかが未完了の間は SP-000 をアーカイブしてはならない。SP スキルはこれをガードする。

### 番号固定化がもたらす「共通語彙」の価値

SP の番号は DD と異なり、**番号に意味が固定されている**。

DD の連番はプロジェクトごとに独立（DD-001 の内容は各プロジェクトで異なる）。
SP の番号は全プロジェクトで共通（SP-002 は常に「DB・データモデル」を指す）。

これにより、複数プロジェクトを経験したメンバー間で以下のような会話が成立する：

- 「SP-002 の精度が低くて SP-004 に響いた」
- 「うちの SP-003 は省略してもよかった（SPA じゃないから）」
- 「SP-002 のテンプレート、この部分直した方がよくない？」

HTTP ステータスコードや Git の規約と同様に、番号の標準化は**コミュニティレベルの資産**になる。
これは spec-know-how を複数プロジェクトに展開していく上での長期的な価値。

## 完了条件（現時点での想定）

- [ ] SP-000 テンプレートが機能する（Claude が質問し、環境情報を構造化記録できる）
- [ ] SP-001〜006 の親チケットテンプレートが揃っている
- [ ] SP スキル（`/sp`）が DD スキルと同等の操作（作成・参照・一覧・アーカイブ）を提供する
- [ ] SP-001 起動時に SP-000 を参照して確認ステップが発動する
- [ ] 既存の `sample_prompts/` を廃止または SP チケットへの誘導に変更する
- [ ] インポート手順が整備されている

## 成果物

| Phase | ファイル | 説明 |
|-------|---------|------|
| Phase 1 | [doc/SP/SP-000.md](doc/SP/SP-000.md) | 環境プロファイリングチケット |
| Phase 3 | [.claude/skills/sp.md](.claude/skills/sp.md) | /sp スキル本体 |

## タスク一覧

### Phase 0: 事前精査
- [x] 📋 **各 Phase のタスク精査・詳細化**
- [x] 😈 **Devil's Advocate 調査**
  - SP-000 の記録形式が曖昧だと後続チケットが読み取れないリスクはないか？
  - 確認ステップが毎回機能するか（Claude の挙動依存にならないか）？
  - DD スキルとの命名・操作の一貫性は保てるか？

### Phase 1: SP-000 設計・実装
- [ ] SP-000 で Claude が聞くべき質問項目を定義する
- [ ] SP-000 の記録形式（構造化 Markdown）を設計する
- [ ] SP-000 テンプレートを作成する
- [ ] 動作確認（Claude が質問→ユーザー回答→記録 のフローが機能するか）
- [ ] 😈 **DA 批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 2: SP-001〜006 テンプレート設計（→ 別 DD に切り出し）

各テンプレートは個別 DD で設計・作成する。

| DD | 対象 | 対応 sample_prompts |
|----|------|---------------------|
| DD-002 | SP-001（初回調査） | 01_初回調査.md |
| DD-003 | SP-002（DB・データモデル） | 02_DBデータモデル.md |
| DD-004 | SP-003（画面・UI） | 03_画面UI.md |
| DD-005 | SP-004（業務ロジック） | 04_業務ロジック.md |
| DD-006 | SP-005（非機能要件） | 05_非機能要件.md |
| DD-007 | SP-006（QA準備完了） | 06_QA準備完了.md |

- [ ] 😈 **DA 批判レビュー（各 DD の設計が互いに矛盾していないか横断確認）**

### Phase 3: SP スキル本体実装
- [ ] `/sp` スキルファイルを作成する（DD スキルをベースに SP 用に調整）
- [ ] 作成・参照・一覧・アーカイブ操作を実装する
- [ ] SP-000 参照・確認ステップを組み込む
- [ ] 😈 **DA 批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 4: 既存資産の整理・インポート手順整備
- [ ] `sample_prompts/` の扱いを決定する（廃止 or 誘導用に残す）
- [ ] GUIDE.md を SP チケットとの対応が分かるよう更新する
- [ ] インポート手順を README または GUIDE.md に記載する
- [ ] 😈 **DA 批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

## ログ

### 2026-02-24
- DD 作成（プロジェクト憲章として）
- 背景: Claude とのチャットで SP スキル導入の方向性が固まった

---

## DA 批判レビュー記録

### Phase 0 DA 批判レビュー

**DA 観点:** SP スキル導入で本当に問題が解決するか？

| # | 発見した問題/改善点 | 重要度 | 再現手順 | DA 観点 | 対応 |
|---|-------------------|--------|----------|--------|------|
| 1 | SP-000 を自由記述形式にすると後続チケットが誤読するリスクがある | 高 | SP-000 に「ReactでDBはPostgresです」と自由文で書く → SP-002 がキーを見つけられず誤動作 | 記録形式の曖昧さ | ✅ Phase 1 でキー固定のテーブル形式を設計する |
| 2 | 確認ステップが Claude の解釈に依存すると毎回機能しない | 高 | SP-001 テンプレートに「SP-000を読んで確認せよ」と曖昧に書く → Claude がスキップして作業開始 | 指示の曖昧さ | ✅ テンプレートに「作業開始前に必ずユーザーに以下を確認する：〜」と命令形で明記する |
| 3 | SP の「新規作成」は DD と内部動作が異なる（親固定・子動的） | 中 | /sp で「新規作成」を呼ぶ → DD と同じ連番生成をしてしまい SP-001 が上書きされる | DD との一貫性 | ✅ Phase 3 でスキル設計時に「親チケット操作」と「子チケット生成」を明確に区別する |
