# DD-007: SP-006 テンプレート設計（QA準備完了）

| 作成日 | 更新日 | ステータス |
|--------|--------|------------|
| 2026-02-24 | 2026-02-27 | 完了 |

## 目的

SP-006（QA準備完了）の親チケットテンプレートを設計・作成する。

## 背景・課題

既存の `sample_prompts/06_QA準備完了.md` は、
QA スキルの作成・動作確認を一括で指示するが、
仕様書の数や種類によって確認すべき内容が変わる。

SP-006 は仕様抽出フェーズの最終チケットであり、
SP-001〜005 で作成した全仕様書が揃っているかを確認してから、
QA スキルを構築する役割を担う。

## 検討内容

`sample_prompts/06_QA準備完了.md` のポイント：
- QA スキル作成・動作確認
- 仕様書参照の確認
- 仕様書10ファイル以上時に分割推奨（2〜3 DD）

SP-006 として再設計する際の論点：
- SP-001〜005 の完了確認を SP-006 起動時に行うか（Gate チェックリストとの統合）
- 「信頼度 Low の項目が放置されていないか」の確認をどう組み込むか
- QA スキル自体の設計は `how-to/qa-skill.md` を参照しているが、
  SP-006 テンプレートからその参照をどう誘導するか

## 決定事項

- **子チケット構成**: SP-006-01（仕様書品質確認）→ SP-006-02（QAスキル作成）→ SP-006-03（継続的更新の仕組み）→ SP-006-gate（context チケットは不要）
- **SP-001〜005 完了確認**: 親チケット起動時に全SP完了を確認。意図的スキップ（DBなし/UIなし等）は「スキップ済み」として許容
- **仕様書登録確認**: 親チケット #2 で CLAUDE.md/document_map.md の登録状態を先行確認（後追い禁止）
- **Low 項目一覧化**: SP-006-01 に専用フェーズを設け、全仕様書を横断読み取りして一覧化（推測禁止）
- **QAスキル作成**: SP-006-02 が how-to/qa-skill.md の 4 ステップに対応
- **動的追加**: 仕様書 10 ファイル以上 → SP-006-02-xx（ドメイン別 QA スキル分割）
- **コンテキスト超過対策**: SP-006-01 Phase 1 に「読了済みファイルリストを記録してからコンテキストクリア」の注記を追加

## 成果物

| Phase | ファイル | 説明 |
|-------|---------|------|
| Phase 2 | [doc/SP/SP-006.md](doc/SP/SP-006.md) | SP-006 親チケットテンプレート |
| Phase 2 | [doc/SP/SP-006-01.md](doc/SP/SP-006-01.md) | 仕様書品質確認（Low/Conflicting一覧・網羅性） |
| Phase 2 | [doc/SP/SP-006-02.md](doc/SP/SP-006-02.md) | QAスキル作成・動作確認 |
| Phase 2 | [doc/SP/SP-006-03.md](doc/SP/SP-006-03.md) | 継続的更新の仕組み決定 |
| Phase 2 | [doc/SP/SP-006-gate.md](doc/SP/SP-006-gate.md) | Gate 6 チェック（仕様抽出フェーズ完了宣言） |

## タスク一覧

### Phase 0: 事前精査
- [x] 📋 **各 Phase のタスク精査・詳細化**
- [x] `sample_prompts/06_QA準備完了.md` を読んで SP 形式への転換ポイントを整理する
- [x] `how-to/qa-skill.md` を読んで QA スキル構築に必要な前提を確認する
- [x] 😈 **Devil's Advocate 調査**
  - SP-001〜005 が全て完了していない状態で SP-006 が開始された場合の対処は？
  - 信頼度 Low 項目の放置を SP-006 で拾えるか？

### Phase 1: 設計
- [x] SP-006 の「環境確認フロー」を設計する（SP-001〜005 完了確認・仕様書ファイル数）
- [x] 子チケット動的生成の条件・分割パターンを定義する（仕様書数基準等）
- [x] GUIDE.md Step 6 との対応を確認する
- [x] 😈 **DA 批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 2: 実装
- [x] SP-006 テンプレートファイルを作成する（`doc/SP/SP-006.md`）
- [x] テンプレートで SP-001〜005 完了確認・子チケット生成指示が機能するか確認する
- [x] 😈 **DA 批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

## ログ

### 2026-02-24
- DD 作成（DD-001 Phase 2 の切り出し）

### 2026-02-27
- Phase 0〜2 完了
  - `sample_prompts/06_QA準備完了.md` と `how-to/qa-skill.md` を読んで転換ポイントを整理
  - DA 調査: SP-001〜005 未完了での開始リスク・Low 項目放置の2件を発見
  - SP-006.md、SP-006-01〜03.md、SP-006-gate.md を作成
  - DA発見を実装に反映: SP-006-01 に「読了済みファイルリスト記録」注記・SP-006-03 に担当者/トリガー明示を追加

---

## DA 批判レビュー記録

### Phase 0 DA 調査 / Phase 1・2 DA 批判レビュー

**DA 観点（Phase 0）:** SP-001〜005 未完了での開始リスク・Low 項目の放置
**DA 観点（Phase 1・2）:** 「このPhaseで何が壊れるか」— 全仕様書横断読み取りの現実的な問題

| # | 発見した問題/改善点 | 重要度 | 再現手順 | DA 観点 | 対応 |
|---|-------------------|--------|----------|--------|------|
| 1 | SP-006-01 で全仕様書を横断読み取りする際、仕様書が 10 ファイル以上あるとコンテキストが超過し、途中で読み取りが中断される | 高 | 仕様書が多いプロジェクトで SP-006-01 Phase 1 を実行する場合 | Low 項目の放置を SP-006 で拾えるか？ | SP-006-01 Phase 1 に「数ファイルずつ分けて読み、読了済みファイルリストを記録してからコンテキストクリア」の注記を追加 |
| 2 | SP-006-03 の「継続的更新フロー」が担当者・トリガーが曖昧なまま「決定した」扱いになり、実際に誰もやらない状態になる | 高 | 「更新フロー: 即時更新」とだけ記録して具体的な担当者・タイミングを決めない場合 | 更新フローが形骸化しないか？ | SP-006-03 の調査記録テーブルに「担当者・責任範囲」「仕様書変更のトリガー」を必須フィールドとして追加 |
