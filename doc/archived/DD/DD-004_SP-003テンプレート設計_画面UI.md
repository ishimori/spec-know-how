# DD-004: SP-003 テンプレート設計（画面・UI 把握）

| 作成日 | 更新日 | ステータス |
|--------|--------|------------|
| 2026-02-24 | 2026-02-27 | 完了 |

## 目的

SP-003（画面・UI 把握）の親チケット・子チケット群テンプレートを設計・作成する。

## 背景・課題

`sample_prompts/03_画面UI.md` は Gate 3 の DD 起票プロンプト形式で記述されている。
DD-002/DD-003 で確立した SP 設計パターン（申し送り）に従い、SP-003 テンプレート群として再設計する。
SP-003 は SP-000 GroupD「フロントエンドあり」の場合のみ実行する条件付きフェーズ。
また「画面の機能（何ができるか）」と「UIの構成（どう見せるか）」を分けて記録する教訓（GUIDE.md 気付き #8）を反映する。

## 検討内容

`sample_prompts/03_画面UI.md` の構成：
- 作業1: 画面一覧・画面遷移の整備（画面一覧・API対応・操作フロー・遷移図）
- 作業2: 権限・ロール制御（認可マトリクス・兼務ユーザー挙動）
- 作業3: ビジネスロジックの在処（submit/save 関数のバリデーション確認）
- 画面数 15 以上で分割推奨（2〜3 DD）

SP-003 子チケット分割案：
- SP-003-01: 画面一覧・画面遷移（作業1）
- SP-003-02: 権限・ロール制御（作業2）
- SP-003-03: ビジネスロジックの在処（作業3）→ SP-004 との境界確認
- SP-003-context: 画面仕様書ファイル構成設計
- SP-003-gate: Gate 3 チェック（6セクション構成）

SP-003 と SP-004 の境界：
- SP-003-03 で「submit/save にビジネスロジックが含まれる」と発覚した場合、その仕様化は SP-004 の責務
- SP-003-03 はあくまで「在処の確認と記録」のみ行う

## 決定事項

### 前提条件

- **SP-001 完了必須**
- **SP-000 GroupD「フロントエンドあり」が前提**（「フロントエンドなし / API のみ」なら SP-003 全体をスキップ）

### 子チケット分割設計

| チケット | 内容 | 実行条件 |
|---------|------|---------|
| SP-003-01 | 画面一覧・画面遷移 | 常に実行 |
| SP-003-02 | 権限・ロール制御 | 常に実行（権限なしなら「なし」と記録して完了） |
| SP-003-03 | ビジネスロジックの在処確認 | 常に実行 |
| SP-003-context | 画面仕様書ファイル構成設計 | 常に実行（SP-003-01〜03完了後） |
| SP-003-gate | Gate 3 チェック | 常に実行（最後に） |

### 動的追加の条件

- **画面数 15 以上**: SP-003-04 以降を動的追加（例: 機能ドメイン別 / ロール別）
- 判定タイミング: SP-003 親チケット #2（画面数概算計測）

### 「機能」と「UI構成」の分離ルール（GUIDE.md 気付き #8 反映）

- SP-003-01 の調査記録は「画面の機能（何ができるか）」を主軸にする
- 「UIの構成（どう見せるか）」はフレームワーク依存のため記録しない（移行時に再設計するため）

### GUIDE.md Step 3 との対応

完全対応（画面一覧・遷移・権限制御・submit/save ロジック確認の全点が SP-003 の作業に対応）

## 成果物

| Phase | ファイル | 説明 |
|-------|---------|------|
| Phase 2 | [doc/SP/SP-003.md](doc/SP/SP-003.md) | SP-003 親チケットテンプレート |
| Phase 2 | [doc/SP/SP-003-01〜03.md, context, gate](doc/SP/) | SP-003 子チケット群 |
| Phase 3 | （本 DD 末尾の申し送りセクション） | SP-004〜007 設計基準 |

## タスク一覧

### Phase 0: 事前精査
- [x] 📋 **各 Phase のタスク精査・詳細化**
- [x] `sample_prompts/03_画面UI.md` を精読し SP 形式転換ポイントを整理した
- [x] DD-002/DD-003 申し送りとの対応を確認した
- [x] 😈 **Devil's Advocate 調査**
  - フロントエンドなしの場合の SP-003 の扱いは？→ SP-000 GroupD「フロントエンドなし」なら全スキップ。SP-002 と同じパターンで対応
  - SP-003 と SP-004 の境界（UI 層ロジック）は明確か？→ SP-003-03 は「在処の確認と記録」のみ。仕様化は SP-004 の責務と明確に分離

### Phase 1: 設計
- [x] SP-003 の前提条件（SP-001 完了 + SP-000 GroupD）を定義した
- [x] 子チケット3種 + context + gate の分割設計を決定した
- [x] 画面数15以上での動的追加条件を定義した
- [x] SP-003/SP-004 の境界（submit/save ロジック）を設計した
- [x] GUIDE.md Step 3 との対応を確認した（完全対応）
- [x] 😈 **DA 批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 2: 実装
- [x] SP-003.md（親チケット）を作成した
- [x] SP-003-01.md を作成した（画面一覧・画面遷移）
- [x] SP-003-02.md を作成した（権限・ロール制御）
- [x] SP-003-03.md を作成した（ビジネスロジックの在処）
- [x] SP-003-context.md を作成した
- [x] SP-003-gate.md を作成した
- [x] 😈 **DA 批判レビュー（「このPhaseで何が壊れるか」を最低1件発見）**

### Phase 3: SP-003 設計パターンの SP-004 以降への申し送り
- [x] SP-003 設計で確立・更新したパターンを整理し、末尾「申し送り」に記録した

## ログ

### 2026-02-24
- DD 作成（DD-001 Phase 2 の切り出し）

### 2026-02-27
- Phase 0 完了: `03_画面UI.md` 精読、申し送り対応確認、DA批判レビュー実施
- Phase 1 完了: 前提条件・子チケット分割・動的追加条件・SP-003/004境界を設計
- Phase 2 完了: SP-003.md + 子チケット5ファイルを作成
- Phase 3 完了: 申し送りセクションを記録

---

## DA 批判レビュー記録

### Phase 0 DA 批判レビュー

**DA 観点:** SP 形式に転換する際に失われる情報・壊れる構造はないか？

| # | 発見した問題/改善点 | 重要度 | DA 観点 | 対応 |
|---|-------------------|--------|--------|------|
| 1 | SP-003-03（submit/save ロジック確認）と SP-004 の境界が暗黙的なまま実装すると、SP-003 が仕様化まで踏み込んでしまうリスク | High | SP-003-03 の「確認と記録」と SP-004 の「仕様化」の分担が明確でないと二重作業または漏れが生じる | SP-003-03 の位置づけセクションと Phase 冒頭に「在処の確認のみ・仕様化は SP-004」を明記 |

### Phase 1 DA 批判レビュー

**DA 観点:** 設計した子チケット構成で調査漏れが生じるケースはないか？

| # | 発見した問題/改善点 | 重要度 | DA 観点 | 対応 |
|---|-------------------|--------|--------|------|
| 1 | 権限なしのシステムで SP-003-02 を実行した場合、「権限なし」と記録するだけで終わる → 形式的な完了になりやすい | Low | 「権限なし」の明示的な記録はむしろ重要（後工程で「確認済み」と分かる） | SP-003-02 の位置づけに「権限なしの場合は『なし』と明記して完了とする」を記載して対応 |

### Phase 2 DA 批判レビュー

**DA 観点:** 作成した SP-003 テンプレート群が実際のプロジェクトで機能するか？

| # | 発見した問題/改善点 | 重要度 | DA 観点 | 対応 |
|---|-------------------|--------|--------|------|
| 1 | SP-003-01 の調査記録テーブルに「UIの構成（見た目）」を記入してしまうケースが想定される | Medium | GUIDE.md 気付き #8 の「機能と UI 構成の分離」ルールが徹底されないと移行判断を誤る | SP-003-01 の Phase 冒頭に「機能のみ記録・UI 構成は記録しない」という注意書きを追加 |

---

## SP-003 設計パターン申し送り（DD-005〜007 向け）

> SP-004〜006 を設計する DD では、DD-002/DD-003 申し送りに加えて以下のパターンを踏襲すること。

### 更新: 「記録しないもの」の明示パターン

SP-003-01 で確立した「記録すること / 記録しないこと」の対記述パターン：

- 調査記録テーブルや位置づけセクションに「記録しないもの」を明示することで、
  後工程での誤解・二重作業・仕様化対象の混乱を防ぐ
- 特にフレームワーク依存の情報（UIの構成・ライブラリ固有の実装詳細等）は
  「記録しない」と明示する

### 更新: 隣接 SP との境界明示パターン

SP-003/SP-004 の境界で確立した「境界明示」パターン：

- 隣接する SP（前後のフェーズ）との責務境界が曖昧になりやすい子チケットには、
  位置づけセクションと Phase 冒頭に「ここまでがこのチケットの責務」を明示する
- 例: 「確認と記録のみ / 仕様化は SP-004」「一覧化のみ / 詳細は SP-003-02」
