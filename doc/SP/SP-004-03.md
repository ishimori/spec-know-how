# SP-004-03: 外部システム連携

## このチケットの位置づけ

**全体目標**: このSPシリーズは [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) の Step 4（業務ロジックを抽出する）完了を目指す — バリデーション・計算ロジック・状態遷移・主要フローを仕様として文書化し、後続の QA スキル構築の根拠とする

**マニュアル対応**: [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) — **Step 4「業務ロジックを抽出する」**

**目的**: 外部システムとの連携仕様（API 呼び出し・ファイル I/O・メッセージキュー等）を記録する

> ⚠️ **実行条件**: SP-004 親チケット #3 で「外部連携あり」と確認した場合のみ実行する。
> 「外部連携なし」の場合はこのチケットをスキップし、SP-004 の子チケット一覧に「スキップ（なし）」と記録する。

> **外部連携が 5 件以上の場合**: SP-004 親チケット #3 の指示に従い、外部システムごとに SP-004-03-xx を動的追加してスコープを分割する。

**実行 Phase の判断**:

| Phase | 実行条件 |
|-------|---------|
| Phase 1 | 常に実行（外部システム一覧の作成） |
| Phase 2 | 常に実行（連携仕様の詳細記録） |

---

## Phase 1: 外部システム一覧の作成

- [ ] コードベースから外部連携を全て洗い出した（API 呼び出し・ファイル I/O・メッセージキュー・外部 DB 等）
- [ ] 連携の種類・方向（呼び出す / 呼ばれる）を把握した
- [ ] 連携先が 5 件以上の場合: システムごとの分割を SP-004 親チケットに報告し、指示に従った

### 外部システム一覧（Phase 1）

| # | 外部システム名 | 連携方式 | 方向 | 用途概要 | 優先度 |
|---|-------------|---------|------|---------|--------|
| 1 | - | REST API / SOAP / ファイル / MQ / 外部DB | 送信 / 受信 / 双方向 | - | 高 / 中 / 低 |

---

## Phase 2: 連携仕様の詳細記録

> 実際のコードを読んで確認すること。推測での記入禁止。

- [ ] 各外部システムについて以下を記録した:
  - エンドポイント / ファイルパス / キュー名
  - 認証方式（API キー・OAuth・証明書等）
  - リクエスト / レスポンス（またはファイル）のデータ形式
  - エラー処理・リトライロジック
  - 呼び出しタイミング（同期 / 非同期 / バッチ）

### 調査記録（Phase 2）

| 外部システム名 | エンドポイント / パス | 認証方式 | データ形式 | タイミング | エラー処理 | 信頼度 |
|-------------|-------------------|---------|----------|----------|----------|--------|
| - | - | - | - | 同期 / 非同期 / バッチ | - | High / Medium / Low |

---

## DA 分析（このチケットのスコープ限定）

> 「外部連携を全て洗い出せたか？エラー処理が未定義の連携はないか？」の観点で批判的に確認する。
> 問題がなければ「なし」と記録すること（無理に問題を作らない）。

| # | 発見した問題・懸念 | 重要度 | 対応方針 |
|---|----------------|--------|---------|
| - | なし | - | - |

---

## コンテキスト回収

> この作業中に会話コンテキストにのみ存在する知見・気づきがあれば、
> 上の作業セクションまたは下の「追加タスク」に追記する。

- [ ] コンテキストにしか残っていない重要な情報がないか確認した

---

## 発覚した追加タスク

| タスク内容 | 対応先 | 優先度 |
|----------|--------|--------|
| - | - | - |

---

## 完了時の確認

- [ ] SP-004 の子チケット一覧の本チケットを「完了」に更新した
