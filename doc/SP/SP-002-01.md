# SP-002-01: スキーマ取得・データ構造詳細

## このチケットの位置づけ

**全体目標**: このSPシリーズは [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) の Step 2（データ層を取得する）完了を目指す — DB構造またはデータファイル構造を把握して後工程の仕様書作成の根拠とする

**マニュアル対応**: [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) — **Step 2「DB・データモデルを取得する」**（GUIDE_SPEC.md Step 2 セクション参照）

**目的**: DB パスではコードベースのスキーマ情報（DDL/ERD/モデル定義）を取得してテーブル一覧・外部キー関係・詳細情報を把握する。ファイルベースパスでは CSV / CDXML / JSON 等のデータファイル構造を調査して各ファイルの役割・カラム構成・ファイル間の関係を把握する。

**最終的な使われ方**: SP-002-context でデータ層仕様書ファイルの構成を設計する際の根拠となる。後続の業務ロジック抽出（SP-004）でデータ参照の根拠として使用される。

**実行 Phase の判断**:

| Phase | 実行条件 |
|-------|---------|
| Phase 1（DB パス） | SP-002 親チケット #1 で「DB あり」と確認した場合のみ |
| Phase 1'（ファイルベースパス） | SP-002 親チケット #1 で「DB なし + データファイルあり」と確認した場合のみ |
| Phase 2 | **DB パスのみ**実行（ファイルベースパスはスキップ） |

> **テーブル数が 30 以上の場合（DB パス）**: SP-002 親チケット #2 の指示に従い、SP-002-01 のスコープを調整（サブシステム別・ドメイン別に分割して SP-002-04 以降へ委譲）すること。
> **データファイル数が多い場合（ファイルベースパス）**: SP-002 親チケット #2' の指示に従い、スコープを調整すること。

---

## Phase 1: スキーマ取得・テーブル一覧（DB パスのみ）

> **実行条件**: SP-002 親チケット #1 で「DB あり」と確認した場合のみ実行。

- [ ] スキーマ情報の形式を確認した（DDL / DUMP / マイグレーション / ER図 / モデル定義 / なし）
- [ ] DDL または ERD を取得した（なければコードのモデル定義から読み取った）
- [ ] 主要テーブルの一覧を作成した（テーブル名と用途）
- [ ] 主要な外部キー関係（テーブル間の関連）を把握した

### 調査記録（Phase 1: DB パス）

| テーブル名 | 用途・概要 | 主な外部キー先 | 信頼度 |
|-----------|---------|-------------|--------|
| - | - | - | High / Medium / Low |

**スキーマ情報の形式:**

| 形式 | 確認結果 | 場所（パス等） |
|------|---------|-------------|
| DDL ファイル | - | - |
| DUMP ファイル | - | - |
| マイグレーション | - | - |
| ER図 | - | - |
| モデル定義（コード） | - | - |

---

## Phase 1': データファイル構造取得（ファイルベースパスのみ）

> **実行条件**: SP-002 親チケット #1 で「DB なし + データファイルあり」と確認した場合のみ実行。

- [ ] データファイルをファイル種別ごとにリストアップした（CSV / CDXML / JSON / その他）
- [ ] 各 CSV ファイルのカラム名・型推測・行数概算を確認した
- [ ] CSV ファイル間のキー関係（共通列・ID 参照）を把握した
- [ ] CDXML ファイルの役割区別（入力マスタ / 出力 / 中間）を把握した
- [ ] CDXML の主要要素・属性の構造を確認した
- [ ] JSON ファイルのフィールド構成・型・用途を確認した
- [ ] 中間データフォルダ（Intermediate/ 等）の内容・役割・生成タイミングを確認した

### 調査記録（Phase 1': ファイルベースパス）

**CSV ファイル一覧:**

| ファイル名 | 役割（入力 / 出力 / 中間 / マスタ） | 主なカラム名 | 行数概算 | 他ファイルとの関係 | 信頼度 |
|----------|--------------------------------|-----------|---------|----------------|--------|
| - | - | - | - | - | High / Medium / Low |

**CDXML ファイル一覧:**

| ファイル名 | 役割（入力マスタ / 出力 / 中間） | 主な要素・属性 | 信頼度 |
|----------|-------------------------------|-------------|--------|
| - | - | - | High / Medium / Low |

**JSON ファイル一覧:**

| ファイル名 | フィールド構成 | 用途 | 信頼度 |
|----------|-------------|------|--------|
| - | - | - | High / Medium / Low |

**中間データ（Intermediate/ 等）:**

| フォルダ / ファイル | 役割 | 生成タイミング | 信頼度 |
|-----------------|------|-------------|--------|
| - | - | - | High / Medium / Low |

---

## Phase 2: テーブル詳細確認（DB パスのみ）

> **実行条件**: SP-002 親チケット #1 で「DB あり」と確認した場合のみ実行。**ファイルベースパスはこの Phase をスキップ。**

- [ ] 論理削除カラム（`deleted_at`、`is_deleted` 等）の有無を確認した
- [ ] ストアドプロシージャ・ビューを確認した（ある場合はリストアップ）
- [ ] マイグレーションファイルを確認した（ある場合は最新スキーマとの差異確認）
- [ ] インデックス定義を確認した（パフォーマンスに影響する可能性があるもの）

### 調査記録（Phase 2: DB パス）

| 項目 | 確認結果 | 信頼度 | 備考 |
|------|---------|--------|------|
| 論理削除カラムの有無・種類 | - | High / Medium / Low | - |
| ストアドプロシージャ有無・数 | - | - | - |
| ビュー有無・数 | - | - | - |
| マイグレーション有無 | - | - | - |
| 主要インデックス | - | - | - |

---

## DA 分析（このチケットのスコープ限定）

> 「このチケットの調査で何を見落としているか？」の観点で批判的に確認する。
> 問題がなければ「なし」と記録すること（無理に問題を作らない）。

| # | 発見した問題・懸念 | 重要度 | 対応方針 |
|---|----------------|--------|---------|
| - | なし | - | - |

---

## コンテキスト回収

> この作業中に会話コンテキストにのみ存在する知見・気づきがあれば、
> 上の作業セクションまたは下の「追加タスク」に追記する。

- [ ] コンテキストにしか残っていない重要な情報がないか確認した

---

## 発覚した追加タスク

| タスク内容 | 対応先 | 優先度 |
|----------|--------|--------|
| - | - | - |

---

## 完了時の確認

- [ ] SP-002 の子チケット一覧の本チケットを「完了」に更新した
