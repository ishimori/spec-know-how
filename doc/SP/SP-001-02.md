# SP-001-02: 機械処理による正確性確認

| 作成日 | 更新日 | ステータス |
|--------|--------|------------|
| 2026-03-02 | 2026-03-02 | 完了 |

> **前提**: SP-001-01.md が完了していること。SP-001.md の管理記録からパスと機械処理言語を確認してから作業を開始すること。

---

## このチケットの位置づけ

**全体目標**: このSPシリーズは [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) の Step 0〜4 完了を目指す — レガシーシステムから [VERIFIED] 仕様書を抽出し、生成AIによるリエンジニアリングを可能にする。

**マニュアル対応**: [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) — **Step 2「業務ロジック抽出」の事前準備**（4.1.1 機械的抽出ツールの準備）

**目的**: SP-001-01 の手動調査を機械処理で検証・補完し、人間の観察バイアスを排除した Ground Truth を確立する。
ファイル数・LOC・依存ライブラリ・テストコード量を機械的に計測する。
SP-001-01 との差異は必ず記録・補正すること。

**最終的な使われ方**: ここで得た機械処理結果は SP-001-context の設計根拠となり、
**SP-002 以降の AI セッションが「数値で裏付けられた事実（信頼度 High）」として参照する**基盤データとなる。
機械処理による計測値は原則 High 信頼度として扱う。

**実行 Phase の判断**:

| Phase | 実行条件 |
|-------|---------|
| Phase 1: 機械処理環境確認 | 常に実行（言語は SP-000 グループF 参照） |
| Phase 2: 機械処理の実行 | 常に実行 |

---

## Phase 1: 機械処理環境確認

> SP-000 グループF「機械処理言語」の回答に応じて、該当するセクションのみ実行する。

**Python の場合:**
- [x] `uv --version` でインストールを確認した（v0.9.28）
- [x] `uv venv .venv` で仮想環境を作成した（CPython 3.10.19, `/c/tmp/260202_app_with_data/.venv`）

**Node.js の場合:**
- [ ] `node --version` でインストールを確認した

---

## Phase 2: 機械処理の実行

> **実行者: ユーザー**。コマンドはターミナルで実行し、出力をそのまま貼り付けてください。
> Claude はその結果を読み取って下の各テーブルに記録します。推測・記憶に頼った記入禁止。
>
> 貼り付けフォーマット（監査用）:
> ```
> # 実行コマンド
> <ここにコマンドを記載>
> # 実行結果
> <ここに出力を貼り付け>
> ```

### ファイル数（拡張子別）

> チェックポイント・`__pycache__`・`.venv` を除く実ファイルのみ計測

| 拡張子 | ファイル数 |
|--------|----------|
| .py | 11（app_core 8モジュール + `__init__`.py + notebook チェックポイント除く） |
| .cdxml | 10（入力マスタ ×5、出力ID付き ×5） |
| .csv | 8（中間 ×3、結果 ×4、ルート結果 ×1） |
| .json | 1（id_registry.json） |
| .ipynb | 1（patent_support.ipynb） |

### LOC（言語別）

> `app_core/` 配下 `.py`（`__init__`.py・`__pycache__` 除く）

| ファイル | 実行行数（LOC） | 合計行数 |
|---------|-------------|--------|
| ui.py | 1,837 | 2,313 |
| cdxml_extract.py | 571 | 760 |
| mol_calculator.py | 193 | 240 |
| ids.py | 189 | 255 |
| properties.py | 146 | 245 |
| render.py | 133 | 168 |
| util.py | 88 | 111 |
| descriptors.py | 54 | 77 |
| **合計** | **3,211** | **4,169** |

### 依存ライブラリ

**Python:**
- [x] requirements.txt / pyproject.toml / setup.py を確認した（**存在しない** — import 文から推定）

| ライブラリ名 | バージョン | 用途（概要） |
|------------|----------|------------|
| ipywidgets | 不明（要確認） | UI ウィジェット（入力・レイアウト） |
| anywidget | 不明（要確認） | カスタムウィジェット（CopyTsvButton） |
| traitlets | 不明（要確認） | ウィジェット状態管理 |
| rdkit | 不明（要確認） | 化学構造計算（SMILES・記述子・分子量） |
| pandas | 不明（要確認） | DataFrame によるデータ処理・CSV 入出力 |
| numpy | 不明（要確認） | 数値計算（外れ値検出等） |
| seaborn | 不明（要確認） | 可視化（用途は限定的とみられる） |
| Pillow | 不明（要確認） | 分子構造画像の生成・描画 |

> ⚠️ requirements.txt 等の依存ファイルが存在しない。バージョンは実行環境のパッケージリストで別途確認が必要。

### テストコード

- [x] テストファイルの有無・場所を確認した
- [x] テストファイル数・概算 LOC を計測した

| 項目 | 結果 |
|------|------|
| テストファイル数 | 0 |
| テストフレームワーク | なし |
| テストカバレッジ（取得できる場合） | 0%（テストコードなし） |

### SP-001-01 との照合

- [x] SP-001-01 の手動調査結果と機械処理結果を照合した
- [x] 差異があれば SP-001-01 の内容を補正した

補正内容: ui.py が 2,313行（LOC 1,837）と突出して大きいことを機械計測で確認。手動調査の「大規模・関数50件以上」と一致。差異なし。

---

## DA 分析（このチケットのスコープ限定）

> 「機械処理の結果で何が不自然か？手動調査との乖離はないか？」の観点で確認する。
> 問題がなければ「なし」と記録すること。

| # | 発見した問題・懸念 | 重要度 | 対応方針 |
|---|----------------|--------|---------|
| - | なし | - | - |

---

## コンテキスト回収

- [x] コンテキストにしか残っていない重要な情報がないか確認した

---

## 発覚した追加タスク

| # | 追加タスク | 起票要否 |
|---|----------|---------|
| - | - | - |

---

## 完了時の確認

- [x] SP-001 の子チケット一覧の本チケットを「完了」に更新した
