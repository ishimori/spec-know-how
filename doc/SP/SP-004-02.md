# SP-004-02: フラグ・ステータスのライフサイクル確認

## このチケットの位置づけ

**全体目標**: このSPシリーズは [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) の Step 4（業務ロジックを抽出する）完了を目指す — バリデーション・計算ロジック・状態遷移・主要フローを仕様として文書化し、後続の QA スキル構築の根拠とする

**マニュアル対応**: [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) — **Step 4「業務ロジックを抽出する」**（GUIDE.md Step 4 セクション参照）

**目的**: 複数の値が存在する、または複数箇所から書き込まれるフラグ・ステータス列について、各値の業務的意味・書き込みパス・遷移条件（設計バグの可能性を含む）を記録する

> ⚠️ **LLM の限界**: LLM のコード読み取りは「想定値」であり、実際の書き込みパスと乖離する場合がある。可能であれば実 DB のデータ分布（`flag_distribution.py` 等）で検証すること。

**最終的な使われ方**: SP-004-context で状態遷移仕様書ファイルを作成する際の根拠となる。「対象フラグ・ステータスがない場合」は「なし」と記録して完了。

**実行 Phase の判断**:

| Phase | 実行条件 |
|-------|---------|
| Phase 1 | 常に実行（対象特定） |
| Phase 2 | 対象が存在する場合のみ実行（詳細確認） |

---

## Phase 1: 対象フラグ・ステータスの特定

- [ ] DB スキーマ（SP-002 の成果物）またはコードのモデル定義から、対象候補列を洗い出した
  - 対象基準: **複数の値が存在する** または **コードの複数箇所から書き込まれる** 列
- [ ] 対象が存在しない場合: 「なし」と記録して本チケットを完了する
- [ ] 対象が存在する場合: Phase 2 へ進む

### 対象候補一覧

| テーブル名 | カラム名 | 値の種類（概算） | 優先度 |
|-----------|---------|----------------|--------|
| - | - | - | 高 / 中 / 低 |

---

## Phase 2: ライフサイクル詳細確認

> 実際のコードを読んで確認すること。推測での記入禁止。

- [ ] 各対象列について以下を確認した:
  - 各値の業務的意味（0=○○、1=○○、2=○○ など）
  - その値になるコードパス（どの関数・メソッドが書き込むか）
  - 遷移条件（遷移しない場合・更新すべきだが更新されない設計バグを含む）
- [ ] 実 DB アクセスが可能な場合: データ分布を確認し、想定外の値がないか確認した

### 調査記録（Phase 2）

| テーブル名 | カラム名 | 値 | 業務的意味 | 書き込む関数（ファイルパス:行番号） | 遷移条件・備考 | 信頼度 |
|-----------|---------|-----|----------|--------------------------------|-------------|--------|
| - | - | - | - | - | - | High / Medium / Low |

**設計バグ候補（「更新すべきだが更新されない」パターン）:**

| # | テーブル.カラム | 問題の概要 | 重要度 |
|---|--------------|---------|--------|
| - | - | - | - |

---

## DA 分析（このチケットのスコープ限定）

> 「対象フラグ・ステータスを全て特定できたか？設計バグを見落としていないか？」の観点で批判的に確認する。
> 問題がなければ「なし」と記録すること（無理に問題を作らない）。

| # | 発見した問題・懸念 | 重要度 | 対応方針 |
|---|----------------|--------|---------|
| - | なし | - | - |

---

## コンテキスト回収

> この作業中に会話コンテキストにのみ存在する知見・気づきがあれば、
> 上の作業セクションまたは下の「追加タスク」に追記する。

- [ ] コンテキストにしか残っていない重要な情報がないか確認した

---

## 発覚した追加タスク

| タスク内容 | 対応先 | 優先度 |
|----------|--------|--------|
| - | - | - |

---

## 完了時の確認

- [ ] SP-004 の子チケット一覧の本チケットを「完了」に更新した
