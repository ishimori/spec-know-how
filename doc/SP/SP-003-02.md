# SP-003-02: 権限・ロール制御

## このチケットの位置づけ

**全体目標**: このSPシリーズは [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) の Step 3（画面・UI を把握する）完了を目指す — 画面構成・遷移・操作フローを把握して後工程の仕様書作成の根拠とする

**マニュアル対応**: [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) — **Step 3「画面・UI を把握する」**（GUIDE_SPEC.md Step 3 セクション参照）

**目的**: 権限・ロールによる画面の表示制御・操作制御を把握し、認可マトリクスを作成する。兼務・ゲスト等の複合ロールの挙動も確認する

**最終的な使われ方**: 認可マトリクスは SP-004（業務ロジック抽出）での仕様書作成と、後工程の横断検証（SP-005 相当）での整合性確認に使用される

**実行 Phase の判断**:

| Phase | 実行条件 |
|-------|---------|
| Phase 1 | 常に実行（権限・ロール有無の確認から開始。**権限なしなら「なし」と記録して完了とする**） |
| Phase 2 | 権限・ロール制御が存在する場合のみ（Phase 1 の結果による） |

---

## Phase 1: 権限・ロール有無の確認

- [x] 権限・ロールによる表示制御の有無を確認した
  - **権限なしの場合**: 下の記録欄に「権限制御なし」と明記してこのチケットを完了とする
  - 権限ありの場合: Phase 2 へ進む
- [x] ロールの種別一覧を把握した（ある場合）→ ロールなし

### 確認記録（Phase 1）

| 項目 | 確認結果 | 信頼度 |
|------|---------|--------|
| 権限・ロール制御の有無 | **なし**（権限制御なし） | High |
| ロール種別一覧 | 該当なし | - |

**根拠**:
- SP-000 GroupE で「認証なし（JupyterLab 側で認証済み）」確認済み
- `app_core/ui.py` 全 2312 行にロール分岐・権限チェックのコードが存在しない
- `App.__init__()` の画面構築ロジックに条件分岐なし（すべての画面が無条件に構築される）
- JupyterLab のノートブック起動権限 = アプリへのアクセス権限、という設計

---

## Phase 2: 認可マトリクス作成（権限あり時のみ）

- [ ] 認可マトリクスを作成した（旧システムの事実記録として・新システム設計ではない）
  - 行: ロール種別（全種別を列挙）/ 列: 画面またはアクション / セル: ○/×/条件付き
- [ ] 同じ画面でも権限によって操作できる内容が変わる場合、その条件を把握した
- [ ] 複数ロールを持つユーザー（兼務・ゲスト等）が存在する場合、その挙動を確認した

### 認可マトリクス

| 画面 / アクション | ロールA | ロールB | ロールC | 備考 |
|---------------|--------|--------|--------|------|
| - | ○/×/条件 | - | - | - |

### 複合ロール（兼務・ゲスト等）の挙動

| ユーザー種別 | アクセス可能な画面・操作 | ロール判定の優先順位 | 備考 |
|-----------|---------------------|-----------------|------|
| - | - | - | - |

---

## DA 分析（このチケットのスコープ限定）

> 「権限制御の確認で何を見落としているか？認可マトリクスに抜けはないか？」の観点で批判的に確認する。
> 問題がなければ「なし」と記録すること（無理に問題を作らない）。

| # | 発見した問題・懸念 | 重要度 | 対応方針 |
|---|----------------|--------|---------|
| - | なし | - | - |

---

## コンテキスト回収

> この作業中に会話コンテキストにのみ存在する知見・気づきがあれば、
> 上の作業セクションまたは下の「追加タスク」に追記する。

- [x] コンテキストにしか残っていない重要な情報がないか確認した

---

## 発覚した追加タスク

| タスク内容 | 対応先 | 優先度 |
|----------|--------|--------|
| - | - | - |

---

## 完了時の確認

- [x] SP-003 の子チケット一覧の本チケットを「完了」に更新した
