# SP-002-context: データ層仕様書ファイル構成設計

## このチケットの位置づけ

**全体目標**: このSPシリーズは [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) の Step 2（データ層を取得する）完了を目指す — DB構造またはデータファイル構造を把握して後工程の仕様書作成の根拠とする

**マニュアル対応**: 特定の Step に非対応（全工程を横断）— SP-002-01〜03（および動的追加分）の成果物を集約し、永続的なデータ層仕様書ファイルの構成を設計する

**目的**: SP-002-01〜03（および動的追加チケットを含む全子チケット）の調査結果を統合し、後続の SP が参照するデータ層仕様書ファイルの構成・ファイル名・記述内容を設計する。DB パスでは `doc/spec/db/` 配下に DB 仕様書を作成する。ファイルベースパスでは `doc/context/data_schema.md` を作成する。

**最終的な使われ方**: ここで設計したファイル構成に従って仕様書を作成する（実際のファイル作成はこのチケット内で行う）。作成したファイルは `CLAUDE.md` の仕様書マップおよび `document_map.md` に追記し、SP-003 以降から参照可能にする

**実行 Phase の判断**:

| Phase | 実行条件 |
|-------|---------|
| Phase 1（DB パス） | SP-002 親チケット #1 で「DB あり」と確認した場合のみ |
| Phase 1'（ファイルベースパス） | SP-002 親チケット #1 で「DB なし + データファイルあり」と確認した場合のみ |

---

## Phase 1: DB仕様書ファイル構成設計・作成（DB パスのみ）

> **実行条件**: SP-002 親チケット #1 で「DB あり」と確認した場合のみ実行。

- [ ] SP-002-01〜03（および動的追加チケット）の調査記録をすべて読んだ
- [ ] DB仕様書として作成すべきファイルの構成を設計した
- [ ] 設計したファイルを作成した
- [ ] 作成したファイルを `CLAUDE.md` の仕様書マップおよび `document_map.md` に追記した

### 設計記録（Phase 1: DB パス）

| ファイル名（案） | 役割（何を書くか） | 書かないもの | 対応する調査元 |
|--------------|---------------|------------|-------------|
| `doc/spec/db/schema.md` | テーブル一覧・外部キー関係・スキーマ形式 | 実DBの件数・値分布 | SP-002-01 Phase 1 |
| `doc/spec/db/tables.md` | テーブル詳細（論理削除・SP/View・インデックス） | マスタデータ具体値 | SP-002-01 Phase 2 |
| `doc/spec/db/master_data.md` | マスタテーブル一覧・具体値・コード対応表 | テーブル構造詳細 | SP-002-02 |

> 上記は推奨最小構成。プロジェクトの規模・テーブル数に応じて調整すること。
> 動的追加チケット（SP-002-04〜）がある場合、そのチケットの成果物を適切なファイルに統合する。

---

## Phase 1': データスキーマ仕様書ファイル構成設計・作成（ファイルベースパスのみ）

> **実行条件**: SP-002 親チケット #1 で「DB なし + データファイルあり」と確認した場合のみ実行。

- [ ] SP-002-01〜03（および動的追加チケット）の調査記録をすべて読んだ
- [ ] データスキーマ仕様書として作成すべきファイルの構成を設計した
- [ ] 設計したファイルを作成した
- [ ] 作成したファイルを `CLAUDE.md` の仕様書マップに追記した（既存の仕様書マップ行を更新または追加）

### 設計記録（Phase 1': ファイルベースパス）

> **推奨構成**: ファイルベースパスでは、DB の代替として機能する CSV / CDXML / JSON のデータ構造を 1 ファイルに集約する。

| ファイル名 | 役割（何を書くか） | 書かないもの | 対応する調査元 |
|----------|---------------|------------|-------------|
| `doc/context/data_schema.md` | CSVファイル群の列構成・CDXML役割（入力マスタ/出力）・中間データ形式・JSON構造・ファイル間のキー関係 | 新システムのDB設計・将来の技術選定 | SP-002-01 Phase 1' / SP-002-02 Phase 1' / SP-002-03 Phase 2' |

> 動的追加チケット（SP-002-04〜）がある場合は、そのチケットの成果物を `data_schema.md` に統合する。
> ファイル数が非常に多い場合は `doc/context/data_schema_csv.md`（CSV専用）/ `doc/context/data_schema_cdxml.md`（CDXML専用）に分割することを検討する。

### 作成した仕様書ファイルの記録

| ファイルパス | 作成日 | CLAUDE.md 登録確認 |
|-----------|-------|-----------------|
| - | - | 済 / 未 |

---

## DA 分析（このチケットのスコープ限定）

> 「提案したデータ層仕様書ファイル構成で、重要な情報が漏れるケースはないか？後続の SP が必要な情報を参照できるか？」の観点で批判的に確認する。
> 問題がなければ「なし」と記録すること（無理に問題を作らない）。

| # | 発見した問題・懸念 | 重要度 | 対応方針 |
|---|----------------|--------|---------|
| - | なし | - | - |

---

## コンテキスト回収

> この作業中に会話コンテキストにのみ存在する知見・気づきがあれば、
> 上の作業セクションまたは下の「追加タスク」に追記する。

- [ ] コンテキストにしか残っていない重要な情報がないか確認した

---

## 発覚した追加タスク

| タスク内容 | 対応先 | 優先度 |
|----------|--------|--------|
| - | - | - |

---

## 完了時の確認

- [ ] SP-002 の子チケット一覧の本チケットを「完了」に更新した
