# SP-002: DB・データモデル取得

> ⚠️ **前提確認（必読）**
> SP-000 GroupC の回答を確認すること。
> **「DB なし」の場合、この SP 全体をスキップして SP-003 へ進む。**
> SP-001（初回調査）が完了していることを確認すること。

---

## Claude への指示

以下の手順を順番に実行してください。

### [ ] #1: 前提確認

SP-001 の完了状態と SP-000 GroupC の回答を確認する。

- SP-001 の子チケット一覧を開き、全チケットが「完了」であることを確認する
- SP-000 を開き、GroupC「DB 有無」の回答を確認する
  - **「DB なし」→ この SP をスキップし SP-003 へ進む旨をユーザーに伝える**
  - 「DB あり」→ #2 へ進む
- 確認した情報を下の管理記録テーブルに転記する

### [ ] #2: テーブル数概算計測

コードベースのモデル定義・マイグレーションファイル・DDL から主要テーブル数を概算する。

- テーブル数を計測し、ユーザーに提示する
- **テーブル数 30 以上の場合**: ドメイン別 / サブシステム別への分割を提案し、ユーザーが判断する
  - 分割する場合: SP-002-04 以降を動的追加し、SP-002-01 のスコープを調整する
- 計測結果を下の管理記録テーブルに記録する

### [ ] #3: 実DBアクセス可否の確認

実DBへのアクセス可否をユーザーに確認する。

- 「実DBにアクセスできますか？（本番 / ステージング / ローカルのいずれか）」とユーザーに確認する
- 回答を下の管理記録テーブルに記録する
  - **「可能」→ SP-002-03 を実行する**
  - **「不可」→ SP-002-03 の Phase 1 で理由を記録し、確認が必要な項目をリストアップして完了とする**

### [ ] #4: 子チケット順次実行

以下の順番で子チケットを実行する。

| # | チケット | 内容 | 実行条件 |
|---|---------|------|---------|
| 1 | [SP-002-01.md](SP-002-01.md) | スキーマ取得・テーブル詳細 | 常に実行 |
| 2 | [SP-002-02.md](SP-002-02.md) | マスタデータ確認 | 常に実行 |
| 3 | [SP-002-03.md](SP-002-03.md) | 実DB照合 | #3 で「可能」の場合のみ |
| 4 | [SP-002-context.md](SP-002-context.md) | DB仕様書ファイル構成設計 | 上記完了後 |
| 5 | [SP-002-gate.md](SP-002-gate.md) | Gate 2 チェック | 最後に実行 |

### [ ] #5: Gate 2 宣言

SP-002-gate の Gate 判定サマリーをユーザーに提示し、Go/No-Go 宣言の DD を起票する。

---

## 管理記録

| 項目 | 値 |
|------|-----|
| SP-001 完了確認 | - |
| SP-000 GroupC（DB 有無） | - |
| テーブル数概算 | - |
| 実DBアクセス可否 | - |
| 動的追加チケット | - |

---

## 子チケット一覧

| チケット | ステータス |
|---------|----------|
| [SP-002-01.md](SP-002-01.md) スキーマ取得・テーブル詳細 | 未着手 |
| [SP-002-02.md](SP-002-02.md) マスタデータ確認 | 未着手 |
| [SP-002-03.md](SP-002-03.md) 実DB照合 | 未着手 |
| [SP-002-context.md](SP-002-context.md) DB仕様書ファイル構成設計 | 未着手 |
| [SP-002-gate.md](SP-002-gate.md) Gate 2 チェック | 未着手 |
