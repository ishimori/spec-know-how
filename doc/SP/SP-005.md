# SP-005: 非機能要件確認

> ⚠️ **前提確認（必読）**
> SP-004（業務ロジック抽出）が完了していることを確認すること。
> SP-000 GroupE（Q11〜Q13: 外部連携・認証方式）の回答を確認してから #1 へ進む。

---

## Claude への指示

以下の手順を順番に実行してください。

### [ ] #1: 前提確認

SP-000 と先行 SP の完了状態を確認する。

- SP-004 の完了状態を確認する（完了していない場合はその旨をユーザーに伝える）
- SP-000 GroupE（外部連携・認証）の回答を読み、管理記録テーブルに転記する
  - Q11: 外部システム連携の有無
  - Q12: 連携システム数
  - Q13: 認証方式
- SP-004-context で作成した業務ロジック仕様書ファイルが存在することを確認し、ファイルパスを管理記録に記録する
  - ファイルが存在しない場合: SP-004-context が未完了の可能性あり。ユーザーに確認する
- SP-003 を実施した場合: SP-003-02 の認可マトリクスが存在するか確認し、管理記録に記録する
  - **存在する → SP-005-01 はデータレベル認可の追加確認から始める**
  - **存在しない / SP-003 スキップ → SP-005-01 は認証・認可の全項目を確認する**

### [ ] #2: 環境確認フロー（動的追加判断）

SP-000 の回答を基に、子チケットの分割要否を判断する。

- **認証方式が複数混在する場合**（例: セッション + OAuth が共存）:
  SP-005-01 を認証方式別に分割することを提案し、ユーザーが判断する
  - 分割する場合: SP-005-01-xx を動的追加し、SP-005-01 のスコープを調整する
- **外部システム連携が 5 件以上の場合**:
  SP-004-03（外部連携仕様）で連携先は把握済み。SP-005-01・02 でその連携に伴う認証・セキュリティ観点を追加確認する（チケット分割は不要）
- 判断結果を下の管理記録テーブルに記録する

### [ ] #3: 子チケット順次実行

以下の順番で子チケットを実行する。

| # | チケット | 内容 | 実行条件 |
|---|---------|------|---------|
| 1 | [SP-005-01.md](SP-005-01.md) | 認証・認可（3層確認） | 常に実行 |
| 2 | [SP-005-02.md](SP-005-02.md) | セキュリティ（SQLi/XSS/CSRF・機密情報） | 常に実行 |
| 3 | [SP-005-03.md](SP-005-03.md) | ログ・監査・パフォーマンス | 常に実行 |
| 4 | [SP-005-04.md](SP-005-04.md) | 運用・保守 | 常に実行 |
| 5 | [SP-005-context.md](SP-005-context.md) | NFR 仕様書ファイル構成設計 | 上記完了後 |
| 6 | [SP-005-gate.md](SP-005-gate.md) | Gate 5 チェック | 最後に実行 |

> 動的追加チケット（SP-005-01-xx 等）がある場合は上記の間に適宜挿入する。

### [ ] #4: Gate 5 宣言

SP-005-gate の Gate 判定サマリーをユーザーに提示し、Go/No-Go 宣言の DD を起票する。

---

## 管理記録

| 項目 | 値 |
|------|-----|
| SP-004 完了確認 | - |
| SP-000 Q11: 外部システム連携 | - |
| SP-000 Q12: 連携システム数 | - |
| SP-000 Q13: 認証方式 | - |
| SP-004-context 業務ロジック仕様書ファイルパス | - |
| SP-003-02 認可マトリクスの有無 | - |
| 動的追加チケット（認証方式分割） | - |

---

## 子チケット一覧

| チケット | ステータス |
|---------|----------|
| [SP-005-01.md](SP-005-01.md) 認証・認可 | 未着手 |
| [SP-005-02.md](SP-005-02.md) セキュリティ | 未着手 |
| [SP-005-03.md](SP-005-03.md) ログ・監査・パフォーマンス | 未着手 |
| [SP-005-04.md](SP-005-04.md) 運用・保守 | 未着手 |
| [SP-005-context.md](SP-005-context.md) NFR 仕様書ファイル構成設計 | 未着手 |
| [SP-005-gate.md](SP-005-gate.md) Gate 5 チェック | 未着手 |
