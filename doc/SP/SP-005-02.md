# SP-005-02: セキュリティ

## このチケットの位置づけ

**全体目標**: このSPシリーズは [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) の Step 5（非機能要件を確認する）完了を目指す — 認証・認可・セキュリティ・ログ・運用を仕様として文書化し、後続の QA スキル構築の根拠とする

**マニュアル対応**: [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) — **Step 5「非機能要件を確認する」**

**目的**: SQLインジェクション・XSS・CSRF・機密情報の扱いについて、**実際のコードを確認した根拠付きで**記録する

> ⚠️ **「対策があるはず」「フレームワークが処理しているはず」という推測での記入禁止。**
> 各確認項目で必ずコード根拠（ファイルパス:行番号）を記録すること。
> コードで確認できない場合は信頼度 Low を付与し、その旨を明記すること。

**実行 Phase の判断**:

| Phase | 実行条件 |
|-------|---------|
| Phase 1 | 常に実行（SQLi / XSS / CSRF の確認） |
| Phase 2 | 常に実行（機密情報の扱い確認） |

---

## Phase 1: 主要セキュリティ対策の確認

> 各項目でコード根拠を必ず記録すること。「ORM を使用しているから安全」ではなく、
> 実際の ORM 呼び出しコードか生 SQL の有無を確認する。

- [ ] **SQL インジェクション対策**を確認した
  - ORM / プレースホルダーを使用しているか、または生 SQL が含まれているか
- [ ] **XSS 対策**を確認した
  - 出力エスケープ（テンプレートエンジン設定、手動エスケープ等）の実装を確認
- [ ] **CSRF 対策**を確認した
  - CSRF トークン / SameSite Cookie 等の実装を確認
  - API のみ（フロントエンドなし）の場合: 「CSRF 対象外（API のみ）」と記録して完了

### 調査記録（Phase 1）

| 対策 | 実装状況 | コード根拠（ファイルパス:行番号） | 信頼度 | 備考 |
|------|---------|-------------------------------|--------|------|
| SQL インジェクション | 対策あり / 生SQL混在 / 未確認 | - | High / Medium / Low | - |
| XSS | 対策あり / 未設定 / 未確認 | - | High / Medium / Low | - |
| CSRF | 対策あり / 対象外（API のみ）/ 未確認 | - | High / Medium / Low | - |

**生 SQL が発見された場合の記録:**

| ファイルパス:行番号 | 内容概要 | リスクレベル | 対応方針 |
|-----------------|---------|-----------|---------|
| - | - | 高 / 中 / 低 | - |

---

## Phase 2: 機密情報の扱い確認

- [ ] パスワードのハッシュ化方式を確認した（bcrypt / Argon2 / SHA 等）
- [ ] 個人情報・秘匿情報の保存方法を確認した（暗号化有無・保存先）
- [ ] 環境変数・シークレットの管理方法を確認した（ハードコードがないか）
- [ ] ログに機密情報が出力されていないか確認した

### 調査記録（Phase 2）

| 項目 | 確認結果 | コード根拠（ファイルパス:行番号） | 信頼度 |
|------|---------|-------------------------------|--------|
| パスワードハッシュ化方式 | - | - | High / Medium / Low |
| 個人情報の保存・暗号化 | - | - | High / Medium / Low |
| シークレット管理（ハードコードなし） | - | - | High / Medium / Low |
| ログへの機密情報出力 | あり（要対応）/ なし / 未確認 | - | High / Medium / Low |

---

## DA 分析（このチケットのスコープ限定）

> 「コードを実際に確認せず「フレームワークが処理しているはず」で済ませていないか？生 SQL が混在していないか？」の観点で批判的に確認する。
> 問題がなければ「なし」と記録すること（無理に問題を作らない）。

| # | 発見した問題・懸念 | 重要度 | 対応方針 |
|---|----------------|--------|---------|
| - | なし | - | - |

---

## コンテキスト回収

> この作業中に会話コンテキストにのみ存在する知見・気づきがあれば、
> 上の作業セクションまたは下の「追加タスク」に追記する。

- [ ] コンテキストにしか残っていない重要な情報がないか確認した

---

## 発覚した追加タスク

| タスク内容 | 対応先 | 優先度 |
|----------|--------|--------|
| - | - | - |

---

## 完了時の確認

- [ ] SP-005 の子チケット一覧の本チケットを「完了」に更新した
