# SP-004-gate: Gate 4 チェック

## このチケットの位置づけ

**全体目標**: このSPシリーズは [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) の Step 4（業務ロジックを抽出する）完了を目指す — バリデーション・計算ロジック・状態遷移・主要フローを仕様として文書化し、後続の QA スキル構築の根拠とする

**マニュアル対応**: [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) — **Gate 4「業務ロジック抽出チェックリスト」**

**目的**: SP-004 の全子チケット（および動的追加分）が完了したことを機械検証・LLM 検証・DA 分析の 3 段階で確認し、Gate 4 通過可否のサマリーを生成する

**最終的な使われ方**: Claude が Gate 判定サマリーを提示し、人間が Go/No-Go 宣言の DD を起票する

**実行 Phase の判断**:

| Phase | 実行条件 |
|-------|---------|
| Phase 1〜6 | 常に実行（SP-004-context 完了後） |

---

## Phase 1: 前提確認（LLM）

SP-004 の全子チケットのステータスを確認する。

- [ ] SP-004-01 が「完了」であることを確認した
- [ ] SP-004-02 が「完了」であることを確認した
- [ ] SP-004-03 が「完了」または「スキップ（外部連携なし）」であることを確認した
- [ ] SP-004-context が「完了」であることを確認した
- [ ] 動的追加チケット（SP-004-04〜、SP-004-03-xx）がある場合、すべて「完了」であることを確認した

---

## Phase 2: 機械検証

> 実コマンドを実行して結果を記録すること。推測・記憶に頼った記入禁止。

- [ ] SP-004-context で設計した業務ロジック仕様書ファイルが実際に存在することを確認した
- [ ] `CLAUDE.md` または `document_map.md` に業務ロジック仕様書ファイルが追記されていることを確認した

### 機械検証記録

> 貼り付けフォーマット（監査用）:
> ```
> # 実行コマンド
> <ここにコマンドを記載>
> # 実行結果
> <ここに出力を貼り付け>
> ```

---

## Phase 3: LLM 検証

> 先行子チケットのファイルを実際に読んで確認すること。「たぶん書いてあった」禁止。

- [ ] SP-004-01 を読み、業務ロジック（バリデーション・計算・状態遷移・フロー）が BR-ID 付きで記録されていることを確認した
- [ ] SP-004-01 を読み、SP-003-03 引き継ぎリストの全項目が仕様化されていることを確認した（SP-003 を実施した場合）
- [ ] SP-004-01 を読み、暗黙ルール候補の一覧が記録されていることを確認した
- [ ] SP-004-02 を読み、フラグ・ステータスの調査結果（または「対象なし」の記録）があることを確認した
- [ ] SP-004-03 を読み、外部連携の仕様（または「スキップ・なし」の記録）があることを確認した
- [ ] SP-004-context を読み、業務ロジック仕様書ファイルの構成・作成記録があることを確認した

### 検証記録

| チェック項目 | 確認結果 | 備考 |
|-----------|---------|------|
| 業務ロジック（BR-ID付き記録） | OK / NG / 部分的 | - |
| SP-003-03 引き継ぎリスト全項目仕様化 | OK / NG / 該当なし | - |
| 暗黙ルール候補の記録 | OK / NG / 部分的 | - |
| フラグ・ステータス調査（または「なし」） | OK / NG / 部分的 | - |
| 外部連携仕様（または「なし」） | OK / NG / 部分的 | - |
| 業務ロジック仕様書ファイル構成・作成 | OK / NG / 部分的 | - |

---

## Phase 4: DA 分析（全体横断）

> 各子チケットのスコープを超えた横断的な確認を行う。
> 「個別調査では見えなかったパターン・矛盾・見落とし」を発見する。
> **特に注意**: UI 層ロジックの見落とし・Conflicting 信頼度の放置・暗黙ルールのコード未確認。
> 問題がなければ「なし」と記録すること（無理に問題を作らない）。

| # | 発見した問題・懸念 | 重要度 | 対応方針 |
|---|----------------|--------|---------|
| - | なし | - | - |

---

## Phase 5: コンテキスト最終回収

> SP-004 全子チケットの作業を通じて会話コンテキストにのみ残っている情報を最後にすべて回収する。

- [ ] 全子チケット・全調査を通じてコンテキストにしか残っていない情報がないか確認し、
      あれば該当チケットまたは業務ロジック仕様書ファイルに追記した

---

## Phase 6: Gate 判定サマリー（Claude が生成）

> Claude が Phase 1〜5 の結果を基にサマリーを生成し、ユーザーに提示する。

### Gate 4 判定サマリー

| 検証項目 | 結果 | 備考 |
|---------|------|------|
| 全子チケット完了確認（Phase 1） | - | - |
| 業務ロジック仕様書ファイル存在確認（Phase 2） | - | - |
| 業務ロジック BR-ID 付き記録（Phase 3） | - | - |
| SP-003-03 引き継ぎ全項目仕様化（Phase 3） | - | - |
| フラグ・ステータス調査（Phase 3） | - | - |
| 外部連携仕様（Phase 3） | - | - |
| 横断 DA 分析（Phase 4） | - | - |

**推奨判定**: 通過 / 条件付き通過 / 保留

**懸念事項**（ある場合）:
- （なし）

> ⚠️ **暗黙ルール確認の促し**: SP-004-01 に記録された「暗黙ルール候補」についてドメインエキスパートへの確認がまだの場合、Gate 通過後のアクションとして確認を促すこと。

---

## 完了時の確認

- [ ] SP-004 の子チケット一覧の本チケットを「完了」に更新した
- [ ] 上の Gate 判定サマリーをユーザーに提示した

---

## Gate 宣言 DD 起票プロンプト

> Gate 判定サマリーを確認後、コピーして Claude に貼り付けてください。
> `<確認結果の要約>` と `<未解決事項>` を実際の内容に置き換えてください。

```
以下の内容のDDを作ってください。

Gate 4（業務ロジック抽出）の通過を宣言します。

## 確認結果
- [ ] SP-004-gate の Gate チェックを完了した
- [ ] 全チェック項目の確認結果を記録した
- [ ] 作成した業務ロジック仕様書ファイルを CLAUDE.md または document_map.md に追記した
- [ ] Conflicting 信頼度の項目が 0 件、または解消計画がある

## 判断
- 通過判定: 通過 / 条件付き通過 / 保留（いずれかを選択）
- 確認結果の要約: <確認結果の要約>
- 未解決事項（ある場合）: <未解決事項と解消計画>
- 暗黙ルール確認状況: <確認済み / 確認予定あり（担当者・期日） / 対象なし>

## 次のステップ
- [ ] SP-005（非機能要件の確認）に進む
```
