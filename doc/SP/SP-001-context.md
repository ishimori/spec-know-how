# SP-001-context: コンテキストファイルの設計

| 作成日 | 更新日 | ステータス |
|--------|--------|------------|
| 2026-03-02 | 2026-03-02 | 完了 |

> **前提**: SP-001-01〜03（および動的追加チケット）がすべて完了していること。全調査結果を踏まえて設計する。

---

## このチケットの位置づけ

**全体目標**: このSPシリーズは [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) の Step 0〜4 完了を目指す — レガシーシステムから [VERIFIED] 仕様書を抽出し、生成AIによるリエンジニアリングを可能にする。

**マニュアル対応**: [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) の特定 Step には直接対応しないが、**SP-002 以降の全工程の品質を左右する設計工程**。

**目的**: SP-001-01〜03 の全調査結果を集約し、SP-002 以降の AI セッションが参照する
`doc/context/` のファイル構成を設計する。
原則として「旧システムの事実記録」と「新システムの設計判断」は必ず別ファイルに分離すること。

**最終的な使われ方**: ここで設計したコンテキストファイルが、**以降の全 AI セッションの「システム理解の基盤」**となる。ファイル構成の設計ミスは SP-002 以降の調査精度に直接影響する。

**実行 Phase の判断**: 全 Phase 必須・スキップ不可

---

## Phase 1: コンテキストファイル構成の設計

> チェックを入れるだけでなく、設計記録テーブルにファイル一覧を記録すること。

- [x] このプロジェクトに必要なコンテキストファイルの一覧を提案した
  - ファイル名・各ファイルの役割（何を書くか / 何を書かないか）を定義した
  - 原則: 「旧システムの事実記録」と「新システムの設計判断」は必ず別ファイルにする
- [x] 提案したファイル構成と書き分けルールを CLAUDE.md に記載した
- [x] CLAUDE.md の仕様書マップにコンテキストファイル一覧を登録した

### 推奨最小構成（プロジェクトに合わせて追加・削除可）

> 以下は「どのプロジェクトでもほぼ必要になる」最小セット。
> 不要なファイルは削除し、必要なファイルは追加して設計記録テーブルに反映してください。

| ファイル名（`doc/context/` 配下） | 何を書くか | 何を書かないか |
|--------------------------------|----------|------------|
| `system_overview.md` | システム全体の目的・主要機能・ユーザー種別（旧システムの事実） | 新システムの設計判断、将来の機能 |
| `tech_stack.md` | 言語・FW・バージョン・主要ライブラリ（SP-001-02 の結果） | 新システムの技術選定候補 |
| `db_overview.md` | テーブル数・主要テーブルの役割・DB種別（DB有りの場合のみ） | 新システムのDB設計 |
| `external_integrations.md` | 外部連携システム一覧・API種別・認証方式（SP-000 グループE の結果） | 連携先の内部仕様 |
| `known_gaps.md` | コードとドキュメントの食い違い・信頼度 Low の項目（SP-001-03 の結果） | 推測・未確認の情報 |
| `new_system_decisions.md` | 新システムの設計判断・技術選定（リエンジニアリング目的の場合のみ） | 旧システムの事実記録 |

> **スキップ可能なファイル**:
> - `db_overview.md` → SP-000「DB なし」の場合はスキップ
> - `new_system_decisions.md` → 「ドキュメント化のみ」の場合はスキップ

### 設計記録

> 上の推奨最小構成をベースに、このプロジェクト用に調整した最終構成を記録する。

| ファイル名 | 役割（何を書くか） | 書かないもの | 対応する調査元 |
|----------|----------------|------------|-------------|
| `system_overview.md` | システム全体の目的（レジスト材料組成・物性計算アプリ）・主要機能・ユーザー種別・CDXML入力からCSV出力までのデータフロー | 新システムの設計判断・将来機能 | SP-001-01 |
| `tech_stack.md` | Python 3.10 / JupyterLab / ipywidgets / anywidget / RDKit / pandas / numpy / Pillow / seaborn / traitlets の各バージョン・用途 | 新システムの技術選定候補 | SP-001-02 |
| `data_schema.md` | CSVファイル群の構造（resist_table / performance_table / polymer_table / fpolymer_table / id_registry）・CDXMLの役割・Intermediate/の中間データ形式 | 新システムのDB設計（`db_overview.md` に代わるファイル、DB なしのためCSV中心） | SP-001-01 / 02 |
| `module_map.md` | app_core 各モジュールの責務・クラス・主要関数一覧・モジュール間依存関係 | 新システムのアーキテクチャ設計 | SP-001-01 / 02 |
| `known_gaps.md` | テストコードなし・requirements.txt なし・コード所有者不明・ライブラリバージョン未確定など既知の不確実性 | 推測・未確認の情報 | SP-001-02 / 03 |
| `new_system_decisions.md` | 新システムの技術選定（Vue 3 + Vite / Python / SQLite）・移行方針・リエンジニアリング設計判断 | 旧システムの事実記録 | SP-000 Gate 0 |

> **スキップ**: `db_overview.md`（DB なし → `data_schema.md` で代替）、`external_integrations.md`（外部連携なし）

---

## DA 分析（このチケットのスコープ限定）

> 「提案したコンテキストファイル構成で、重要な情報が漏れるケースはないか？」の観点で確認する。
> 問題がなければ「なし」と記録すること。

| # | 発見した問題・懸念 | 重要度 | 対応方針 |
|---|----------------|--------|---------|
| 1 | `tech_stack.md` にライブラリバージョンが未確定（requirements.txt なし） | 中 | SP-002 開始前に実行環境で `pip list` を取得しバージョンを補完する |
| 2 | ui.py が 2,300行超と巨大で1ファイルに全UI責務が集中。module_map.md の記述量が多くなる可能性 | 低 | module_map.md では主要クラス・関数のみ記載し、詳細は SP-004 の業務ロジック調査に委ねる |

---

## コンテキスト回収

- [x] この設計作業中にコンテキストにしか残っていない重要な情報がないか確認した

---

## 発覚した追加タスク

| # | 追加タスク | 起票要否 |
|---|----------|---------|
| - | - | - |

---

## 完了時の確認

- [x] SP-001 の子チケット一覧の本チケットを「完了」に更新した
