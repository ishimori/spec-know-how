# SP-002-02: マスタデータ確認

## このチケットの位置づけ

**全体目標**: このSPシリーズは [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) の Step 2（データ層を取得する）完了を目指す — DB構造またはデータファイル構造を把握して後工程の仕様書作成の根拠とする

**マニュアル対応**: [manuals/01_仕様書作成マニュアル.md](../../manuals/01_仕様書作成マニュアル.md) — **Step 2「DB・データモデルを取得する」**（GUIDE_SPEC.md Step 2 セクション参照）

**目的**: DB パスではマスタテーブル（コード値・区分値）を特定・確認する。ファイルベースパスでは CDXML マスタファイルや CSV のコード値・固定値を確認する。識別子の不一致を早期発見し後続フェーズでの横断バグを防ぐ。

**最終的な使われ方**: SP-002-context のデータ層仕様書設計に反映される。マスタデータ・コード値の仕様書は Step 4（横断検証）での整合性確認に使用される

**実行 Phase の判断**:

| Phase | 実行条件 |
|-------|---------|
| Phase 1（DB パス） | SP-002 親チケット #1 で「DB あり」と確認した場合のみ |
| Phase 1'（ファイルベースパス） | SP-002 親チケット #1 で「DB なし + データファイルあり」と確認した場合のみ |
| Phase 2 | 両パス共通。具体値が確認可能な場合に実行 |

---

## Phase 1: マスタテーブルの特定（DB パスのみ）

> **実行条件**: SP-002 親チケット #1 で「DB あり」と確認した場合のみ実行。

- [ ] マスタテーブル（コード値・区分値を持つテーブル）をリストアップした
- [ ] 各マスタテーブルの用途を把握した（何を「区分」しているか）
- [ ] コードの定数定義（enum, const 等）と DB のマスタテーブルの対応を確認した

### 調査記録（Phase 1: DB パス）

| テーブル名 | 用途・区分の種類 | コード側の対応定数 | 信頼度 |
|----------|-------------|----------------|--------|
| - | - | - | High / Medium / Low |

---

## Phase 1': ファイルベースマスタ・コード値の確認（ファイルベースパスのみ）

> **実行条件**: SP-002 親チケット #1 で「DB なし + データファイルあり」と確認した場合のみ実行。

- [x] マスタとして機能するデータファイル（CDXML 材料マスタ、CSV マスタ等）をリストアップした
- [x] 各マスタファイルの役割・内容を把握した（何の「マスタ」か）
- [x] CSV のコード値・固定値・区分列を確認した（例: 状態列・種別列の取り得る値）
- [x] コード側の定数定義（Python の定数・enum 等）との対応を確認した
- [x] CDXML マスタファイルの実内容（材料名・構造要素・主な属性値）を確認した

### 調査記録（Phase 1': ファイルベースパス）

**マスタファイル一覧:**

| ファイル名 | マスタの種類 | 主な内容 | コード側の対応定数 | 信頼度 |
|----------|-----------|---------|----------------|--------|
| `Solvent.cdxml` | 溶剤マスタ | S-1（PGME）, S-2（PGMEA）の化学構造＋ラベル | `ID_PREFIX_MAP["Solvent"] = "S"` (ids.py L20) | High |
| `Additive.cdxml` | 添加剤マスタ | D-1（Acetic acid）の化学構造＋ラベル | `ID_PREFIX_MAP["Additive"] = "D"` (ids.py L21) | High |
| `Monomer.cdxml` | モノマーマスタ | M-1（HydroxyStyrene）, M-2（Styrene） | `ID_PREFIX_MAP["Monomer"] = "M"` (ids.py L16) | High |
| `PAG.cdxml` | PAGマスタ（光酸発生剤） | A-1, A-2, A-3（スルホニウム塩系3種） | `ID_PREFIX_MAP["PAG"] = "A"` (ids.py L18) | High |
| `PDB.cdxml` | PDBマスタ（塩基性化合物） | B-1（スルホニウム塩系1種） | `ID_PREFIX_MAP["PDB"] = "B"` (ids.py L19) | High |
| `Intermediate/id_registry.json` | 全材料カテゴリのID台帳 | {カテゴリ: {SMILES/シグネチャ: ID}} 形式 | `ID_PREFIX_MAP` 全カテゴリと1対1対応 (ids.py L13-22) | High |
| `Intermediate/polymer_definitions.csv` | Polymer/FPolymerの定義マスタ | Category, ID, Signature, Mw, Mw_Mn | `PolymerDefinitionStore` クラス (ids.py L132) | High |

**CSV コード値・区分値一覧:**

| ファイル名 | 列名 | 取り得る値 | コード側の対応定数 | 信頼度 |
|----------|------|----------|----------------|--------|
| `Intermediate/mixture_*_components.csv` | `Type` | `"Meta"`, `"Component"`, `"Property"` | コード内文字列リテラル（定数定義なし） | High |
| `Intermediate/mixture_*_components.csv` | `Category` | `"Polymer"`, `"PAG"`, `"PDB"`, `"Solvent"`, `"FPolymer"`, `"Additive"`, `"Label"`, `"Memo"`, `"Solvent_Ratios"`, `"Calculated"`, `"Custom"` | `ID_PREFIX_MAP` キー（材料系）+ メタ用リテラル | High |
| `Intermediate/polymer_definitions.csv` | `Category` | `"Polymer"`, `"FPolymer"` | `ID_PREFIX_MAP` の部分集合 | High |

---

## Phase 2: 具体値の確認（両パス共通）

> **実行条件**: 具体値が確認可能な場合に実行。DB パスでは実DB / シードファイル、ファイルベースパスでは実ファイルを直接参照する。

- [x] マスタデータ / コード値の具体値を確認した
- [x] 日本語ラベルと英語コードの対応関係に不一致がないか確認した
- [x] コードの定数と実データの値が一致しているか確認した
- [x] 確認できない場合: その理由を記録し、後続フェーズで確認が必要な項目をリストアップした

### 調査記録（Phase 2）

| データ名（テーブル / ファイル） | 確認した値（一覧または代表値） | 確認方法 | 不一致・懸念点 | 信頼度 |
|--------------------------|------------------------|---------|-------------|--------|
| `id_registry.json` — Polymer | P-1: HydroxyStyrene=70;Styrene=30 | ファイル直接参照 | なし | High |
| `id_registry.json` — Monomer | M-1: C=Cc1ccc(O)cc1（HydroxyStyrene）, M-2: C=Cc1ccccc1（Styrene） | ファイル直接参照 | なし | High |
| `id_registry.json` — FPolymer | F-1: Styrene=100 | ファイル直接参照 | なし | High |
| `id_registry.json` — PAG | A-1, A-2, A-3（スルホニウム塩系SMILES 3種） | ファイル直接参照 | なし | High |
| `id_registry.json` — PDB | B-1（スルホニウム塩系SMILES 1種） | ファイル直接参照 | なし | High |
| `id_registry.json` — Solvent | S-1: COCC(C)O（PGME）, S-2: COCC(C)OC(C)=O（PGMEA） | ファイル直接参照 | なし | High |
| `id_registry.json` — Additive | D-1: CC(=O)O（Acetic acid） | ファイル直接参照 | なし | High |
| `ids.py` `ID_PREFIX_MAP` ↔ `id_registry.json` カテゴリ名 | 完全一致（Polymer/Monomer/FPolymer/PAG/PDB/Solvent/Additive） | コード照合 | なし | High |
| `mixture_*.csv` の `Category` 値 ↔ `ID_PREFIX_MAP` キー | 材料カテゴリ（Polymer等）は一致。メタ用（Label/Memo等）はコード外リテラル | コード照合 | Type/Categoryに列挙型定数が存在しないため、スペルミスが検知不可能 | Medium |

---

## DA 分析（このチケットのスコープ限定）

> 「マスタデータ / コード値の不明が後で横断バグとして現れる可能性はないか？」の観点で批判的に確認する。
> 問題がなければ「なし」と記録すること（無理に問題を作らない）。

| # | 発見した問題・懸念 | 重要度 | 対応方針 |
|---|----------------|--------|---------|
| 1 | `mixture_*.csv` の `Type` / `Category` 列のコード値が文字列リテラルのみで管理されており、Enum定数が存在しない。スペルミスが実行時エラーではなくデータ欠落として現れるリスク | Medium | SP-004（業務ロジック抽出）でコード側のリテラル使用箇所を確認し、仕様書に明記する |

---

## コンテキスト回収

> この作業中に会話コンテキストにのみ存在する知見・気づきがあれば、
> 上の作業セクションまたは下の「追加タスク」に追記する。

- [x] コンテキストにしか残っていない重要な情報がないか確認した

---

## 発覚した追加タスク

| タスク内容 | 対応先 | 優先度 |
|----------|--------|--------|
| - | - | - |

---

## 完了時の確認

- [x] SP-002 の子チケット一覧の本チケットを「完了」に更新した
