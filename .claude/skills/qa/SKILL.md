---
name: qa
description: 仕様書からの回答検索＋移行元コード突合検証
---

# QA スキル — 仕様質問＆コード突合

ユーザーの質問に対して、仕様書から回答を抽出し、コードベースと突合検証するスキルです。

## 使い方

```
/qa <質問>
```

### 例
- `/qa Mermaid ダイアグラムは何種類対応していますか？`
- `/qa Git ステータスの自動ポーリング間隔は？`
- `/qa アウトライン機能とは何ですか？`
- `/qa ズーム操作のキーボードショートカットは？`
- `/qa レンダリングキャッシュとは何ですか？`

## 処理フロー

### Step 1: 質問の分析

ユーザーの質問からキーワードを抽出し、関連する仕様書を特定する。

**検索対象の仕様書マップ**:

| キーワード | 参照先 | 信頼度 |
|-----------|--------|--------|
| Mermaid, 図表, ダイアグラム | `doc/spec/business-logic/FR.md` (Section 2.1) | High |
| Markdown, レンダリング, GFM | `doc/spec/business-logic/FR.md` (Section 2.1) | High |
| ファイル, フォルダ, ツリー | `doc/spec/business-logic/FR.md` (Section 2.2) | High |
| タブ, 管理 | `doc/spec/business-logic/FR.md` (Section 2.2) | High |
| 検索, 全文検索, スコープ | `doc/spec/business-logic/FR.md` (Section 2.3) | High |
| アウトライン, 目次, 見出し | `doc/spec/business-logic/FR.md` (Section 2.3) | High |
| ブックマーク | `doc/spec/business-logic/FR.md` (Section 2.3) | High |
| JSON, CSV, XML, Python, HTML, CDXML | `doc/spec/business-logic/FR.md` (Section 2.4) | High |
| Git, ステータス, ポーリング | `doc/spec/business-logic/FR.md` (Section 2.5) | High |
| ズーム, UI, 外部変更, セッション | `doc/spec/business-logic/FR.md` (Section 2.6) | High |
| キーボード, ショートカット | `doc/spec/uxm/UXM.md` (Section 1) | High |
| マウス, クリック, ドラッグ | `doc/spec/uxm/UXM.md` (Section 2) | High |
| キャッシング, パフォーマンス | `doc/spec/nfr/NFR.md` (Section 1) | High |
| ポーリング間隔, 3秒 | `doc/spec/nfr/NFR.md` (Section 2.1) | High |
| セッション, 自動復元 | `doc/spec/nfr/NFR.md` (Section 4.1) | High |

### Step 2: 仕様書からの回答抽出

1. 特定した仕様書を Read ツールで読み込む
2. 該当するセクションを特定する
3. 関連する機能・要件を抽出する
4. 回答を簡潔にまとめる

**信頼度判定ルール**:
- `[High]` — 仕様書に明記、かつ README.md/HELP.md 根拠あり
- `[Medium]` — 複数情報源から推論、または一部コード推論
- `[Low]` — コード推論のみ
- `[Conflicting]` — 複数根拠が矛盾（使用禁止）

### Step 3: コードベースでの検証

コードベース `C:\repo\markdown-viewer` を検索して、仕様書の記述をコードで裏付ける。

1. Grep ツールで対象プロジェクトからキーワードを検索
2. 該当する関数・クラス・メソッドを特定
3. コードの該当部分を Read ツールで読み込み
4. 仕様書の記述とコードを比較

**コード構成**（参考）:
- `src/main.py` — メインアプリケーション、UI レイアウト
- `src/utils.py` — ファイルタイプ判定、ユーティリティ
- `src/services/` — ビジネスロジック（検索、Git 連携、etc）

### Step 4: 突合レポート出力

以下のフォーマットで結果を出力する:

```markdown
## QA 回答

### 質問
> {ユーザーの質問をそのまま引用}

### 仕様書からの回答
- **参照先**: {仕様書ファイルパス}
- **該当セクション**: {Section 番号・見出し}
- **回答**:
  {仕様書に基づく回答。具体的な数値・計算式・条件を含める}

### コード検証
- **参照先**: {ファイルパス:行番号}
- **該当コード**:
  {コードの要約または該当箇所の引用}

### 突合結果
{以下のいずれか}
- **一致**: 仕様書の記述とコードが一致している
- **部分一致**: 仕様書に記載はあるが、コードの実装が不完全な可能性
- **差異あり**: {具体的な差異の説明}
- **仕様書に記載なし**: コードには存在するが仕様書に未記載
- **コードで未確認**: 仕様書に記載はあるが該当コードを特定できなかった

### 信頼度
- 仕様書: High / Medium / Low
- コード検証: 直接確認済み / 推定 / 未確認
```

## qa-index の活用

既存の `doc/spec/qa-index.md` に High 信頼度の Q&A が 28 項目収録されています。

以下の質問はこちらを優先参照してください：
- `/qa Mermaid ダイアグラムは何種類対応していますか？` → qa-index.md に掲載
- `/qa ブックマーク機能の基本操作は？` → qa-index.md に掲載
- `/qa ズーム操作のキーボードショートカットは？` → qa-index.md に掲載

## 複数の仕様書にまたがる場合

質問が複数の仕様書に関連する場合は、それぞれから情報を集約して回答する。

例: `/qa タブ管理の操作は？`
- FR.md: タブ管理の機能仕様
- UXM.md: キーボード・マウス操作
- 両方を組み合わせて回答

## 機械抽出結果の活用

`doc/spec/machine-facts/summary.json` には以下の機械抽出結果が保存されています：

- **code_structure**: Python AST 解析による構造
  - クラス 17、メソッド 197（高精度）
- **features**: 機能・操作一覧
- **shortcuts**: キーボードショートカット 12 件
- **formats**: ファイルフォーマット対応

これらを「コード検証」ステップで参照し、信頼度を High に昇格させます。

## 回答できない場合

仕様書にもコードにも該当する情報が見つからない場合:

```markdown
## QA 回答

### 質問
> {質問}

### 結果
この質問に対応する情報は、現在の仕様書・コードベースから見つかりませんでした。

### 考えられる理由
- 仕様抽出の対象外の機能である可能性
- 画面固有の UI 仕様で、主仕様書の対象外
- 未実装機能

### 次のアクション
{必要に応じて追加調査の提案}
```

## 回答フォーマット（簡潔版）

qa-index.md に既に掲載されている High 信頼度項目については、簡潔に回答：

```
{回答本文}

---
信頼度: High | 根拠: doc/spec/qa-index.md | 生成: {日時} @ {コミットSHA}
```

## stale フラグ管理

このスキルが生成する QA 回答は以下のトリガーで `stale` にマークされます：

| トリガー | アクション |
|---------|-----------|
| 根拠参照先コードの変更 | 該当 QA エントリを `[stale]` にマーク |
| 仕様書の更新 | 関連 QA エントリを `[stale]` にマーク |
| 機械抽出器の更新 | 全 QA エントリを `[potentially_stale]` にマーク |

