# 高信頼リエンジニアリング基本方針書

## 1. 目的
本ドキュメントは、Housing E-KintaiシステムをStreamlitからReact/FastAPIアーキテクチャへ移行するにあたり、現行システムの機能と品質を100%維持し、かつ将来の保守性を劇的に向上させるための基本方針を定めるものである。

## 2. 基本哲学：AIネイティブ・リエンジニアリング
単なるコードの「翻訳」ではなく、AIの特性を最大限に活かしつつ、その弱点（ハルシネーション）を構造的にカバーする**「高信頼プロセス」**を採用する。

### コア・プリンシプル
1.  **ドキュメント・ファースト**: コードを書く前に、AIが解釈可能な「完全な仕様書」を確定させる。
2.  **検証駆動 (Verify First)**: 実装の前に「どうなれば正解か」というテスト仕様を確定させる。
3.  **クリーン・スレート**: 既存コードのコピペを禁止し、新しいアーキテクチャ（FastAPI/Pydantic）に合わせてロジックを再構築する。

## 3. 実施プロセス（3ステップ・アプローチ）

本プロジェクトでは、**ドキュメント駆動 (Document-Driven)** のアプローチを徹底する。
全てのタスクにおいて、実装前に設計ドキュメントを作成し、以下のプロセスを経てからコーディングを行う。

### 共通基盤: ドキュメント駆動開発
*   **設計書の作成**: 作業単位ごとに設計書（Markdown）を作成し、文脈を永続化する。
*   **DA批判レビュー (Devil's Advocate)**:
    *   作業の各フェーズで「何が壊れるか？」をAIに問うレビュープロセスを実施し、楽観バイアスを排除する。

### Step 1: Code to Spec（仕様の逆生成）
現行のソースコード（Python）を正とし、そこから「本来あるべき業務仕様」を抽出する。
*   **Mechanical Extraction（機械的抽出）**:
    *   計算式、定数、分岐条件などの「事実」を、スクリプトを用いて機械的に抽出する（AIの解釈を挟まない）。
*   **Cross-Verification（多重的検証）**:
    *   抽出された仕様に対し、異なるコンテキストを持つ複数のAIエージェントがレビュー・再生成を行い、結果を突合する。不一致があれば人間が判断する。

### Step 2: Spec to Test Spec（テスト設計）
確定した仕様書をもとに、新システムがパスすべき「テスト仕様書」を作成する。
*   **DDによるレビュー記録**:
    *   テスト仕様の漏れをDA批判レビューで指摘させ、その指摘と対応履歴をDDに残す。
*   **パラレルラン・テスト基準**:
    *   新旧システムに同一入力を与え、出力がビットレベル（または1円単位）で一致することを検証条件とする。

### Step 3: Implementation & Verification（実装と検証）
テスト仕様書を正解データとして、新アーキテクチャでの実装を行う。
*   **FastAPI & Pydantic**:
    *   全ての入出力に厳格な型定義を適用する。
    *   UI層（Streamlit）に混入していたロジックを、純粋なPython関数（Service層）として分離する。
*   **DDアーカイブ**:
    *   実装完了後、DDをコミットし、将来の保守担当者が「なぜこの設計になったか」を追える状態にする。

## 4. アーキテクチャ方針

| 領域 | 現行 (As-Is) | 将来 (To-Be) | 目的 |
| :--- | :--- | :--- | :--- |
| **Frontend** | Streamlit (Python) | **React + TypeScript** | UI表現力の向上、操作性改善 |
| **Backend** | Streamlit Server | **FastAPI (Python)** | ロジックのAPI化、高速化 |
| **State** | Session State, Global | **Stateless API** | スケーラビリティ、バグ排除 |
| **Type** | Dynamic (some hints) | **Strict Static Typing** | 安全性向上、AI保守性向上 |

## 5. 用語定義
*   **ハルシネーション対策**: AIが事実に基づかない情報を生成することを防ぐための、多重チェックおよび機械的抽出の仕組み。
*   **パラレルラン**: 移行過渡期において、新旧システムを並行稼働させ、結果を比較する検証手法。

## 6. 改版履歴
*   2026/02/12: 初版作成
