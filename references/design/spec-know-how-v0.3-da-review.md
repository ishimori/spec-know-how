# spec-know-how v0.3 改良案の DA（悪魔の代弁者）批判レビュー

日付: 2026-02-17
レビュアー: Claude Code

---

## 概要

v0.3 改良案（DD 番号、日本語ファイル名、タスク追加ガイドライン、配置ルール）について、批判的観点から潜在的な問題点と「このフェーズで何が壊れるか」を分析します。

---

## 🚨 発見した問題（重要度順）

### 【High】 問題 1: DD 番号変更による既存コードベースの破壊

**問題**: DD-05, DD-10, ... → DD-001, DD-002 への変更は、既に実装済みの DD ファイルと参照が全て無効化される。

**影響範囲**:
1. **既存 DD ファイルの参照**
   - 他ファイルから `DD-40_*.md` へのリンク
   - ドキュメント内の `DD-15 完了後に...` などのテキスト参照
   - ポートフォリオインデックスの全テーブル行

2. **ユーザーメンタルモデルの破壊**
   - 既に実装を進めたユーザーが「なぜ番号が変わるの？」と混乱
   - Git コミットメッセージに `DD-40` が残る → 履歴との齟齬

3. **導入済みプロジェクトの互換性破壊**
   - 既に spec-know-how を導入したプロジェクトでは、マイグレーション作業が必須
   - マイグレーション手順が複雑（全ファイル rename + 参照更新）

**根本原因**: テンプレート番号をユーザー番号として使う設計上の瑕疵。v0.2 時点で決まったまま。

**提案の甘い点**:
- 「テンプレート番号の影響を廃止する」という理由だけで、導入済みプロジェクトへの影響を見落としている
- マイグレーション戦略（古い番号 → 新しい番号の対応表、スクリプト化など）が提案されていない

**対策案**:
- **案 A**: 番号変更を断行し、マイグレーション手順を詳細に提供
  - コスト: 中（ユーザー側の手作業が必要）
  - ベネフィット: 大（長期的には整合性が取れる）

- **案 B**: v0.3 では「推奨」として新規プロジェクトのみ 001 から、既存は DD-05 互換を保つ
  - コスト: 小（新規のみ対応）
  - デメリット: 二系統の番号体系が存在、複雑化

---

### 【High】 問題 2: 日本語ファイル名による国際化対応の喪失

**問題**: ファイル名を日本語化することで、以下の環境で問題が発生する。

**潜在的な障害**:

1. **パス処理スクリプトの破壊**
   - `extract_python_structure.py` など既存ツールはハードコードされたパスで読み込む
   - ファイル名が変わると自動検出ロジック が破壊される

   ```python
   # 現在のコード（仮）
   source_files = [
       r'C:\repo\markdown-viewer\src\main.py',
       ...
   ]
   # DD-40 の integrate_extracts.py も同様
   ```

2. **非日本語環境での混乱**
   - 国際的なプロジェクトで日本語ファイル名は大きな障壁
   - Git では日本語ファイル名が encoding 問題を起こす可能性
   - CI/CD パイプライン（GitHub Actions, Jenkins など）で文字化け

3. **ファイルシステム依存性**
   - Windows: NTFS は日本語 OK
   - Linux: 設定によってはファイル名エンコーディング問題
   - macOS: HFS+ の正規化問題（Compose vs Decompose）

**根本原因**: 「日本語プロジェクトだから日本語ファイル名」という単純な発想が、汎用スキルの本質に反している。

**提案の甘い点**:
- 「見やすさ」と「互換性」のバランスを検討していない
- テンプレートには日本語説明があるが、ファイル名までを日本語化する必要があるかが曖昧

**対策案**:
- **案 A**: ファイル名は英数のまま、内容（セクションヘッダ、説明）のみ日本語化
  - コスト: 小
  - ベネフィット: 安全（互換性を保つ）
  - デメリット: ファイル一覧の「見やすさ」は改善されない

- **案 B**: `DD-040_機械ツール設計.md` 形式だけ日本語（ファイル番号+日本語タイトル）
  - 試してみる価値があるが、互換性テスト必須

---

### 【Medium】 問題 3: タスク追加ガイドラインの実効性が不明確

**問題**: 「タスク追加ガイドライン」を標準化しても、実際に運用ユーザーが従うかは未知数。

**潜在的な問題**:

1. **ガイドラインが守られない可能性**
   - テンプレートに「追加ガイドライン」が書いてあっても、急いでるユーザーはスキップする
   - `[ ] 新しいタスク` と簡潔に書いて終わり → 背景・理由が記録されない
   - ログセクションに「2026-02-17 15:00 新タスク発見」と一行だけ → ガイドラインの意図が果たされない

2. **「優先度」の主観性**
   - High/Medium/Low の定義が曖昧
   - あるユーザーが「Medium」と判断するのを、別のユーザーは「High」と判断
   - 優先度の一貫性が保たれない

3. **タスク追加 vs タスク発見の境界が曖昧**
   - 「新たに発見された」タスク vs 「実行中に明らかになった」サブタスク
   - 両者を区別すべきか、同じ扱いか不明確
   - 例: DD-40 でも「既存 extractor.py の活用」という発見が、段階的に浮き彫りになった

4. **検証メカニズムがない**
   - ガイドラインを守ったかどうかを検証するすべがない
   - テンプレートレビューで「ログ記録不足」が指摘される → 修正手間増加

**根本原因**: 「ガイドラインを作る」≠「従う」。人間の行動を前提とした仕組みは機能保証がない。

**提案の甘い点**:
- ガイドラインを「推奨」や「要件」として定義しているが、実装レベルでどう強制するか未定
- テンプレートに記載するだけでは不十分

**対策案**:
- **案 A**: ガイドラインを「推奨」に留める（負担を軽くする）
  - 欠点: 効果が薄い

- **案 B**: テンプレート内に「タスク追加チェックリスト」を埋め込む
  - ユーザーが必須項目を埋めないと先に進めない形にする
  - 欠点: テンプレートが複雑化

- **案 C**: DD レビュー時に「タスク追加ログの品質」を明示的にチェック
  - ユーザー教育と一緒に実施

---

### 【Medium】 問題 4: 配置ルール用語定義が機械的に強制されない

**問題**: SKILL.md で「spec-know-how プロジェクト vs 対象プロジェクト」を定義しても、実際にスキルが実行される際に強制されない。

**潜在的な問題**:

1. **スキルの起動方法が曖昧**
   - `spec-know-how` スキルを起動する時、どのプロジェクトから起動するか？
   - 「対象プロジェクト側から起動」「spec-know-how プロジェクト側から起動」どちらでも可能なのか？
   - 起動位置によって配置先が変わる可能性

2. **パス解決の曖昧性**
   - `--source-dir C:/repo/markdown-viewer` を指定した時、出力はどこに行く？
   - 「現在のプロジェクト」が spec-know-how なのか markdown-viewer なのか

3. **用語定義は参考情報に過ぎない**
   - SKILL.md で定義しても、スキルの実装側（Python コード）で強制されなければ意味がない
   - 例: integrate_extracts.py が「対象プロジェクト側に出力」してしまったのは、スキル定義がなかったから

**根本原因**: 「定義する」と「実装で強制する」は別物。ドキュメントだけでは不十分。

**提案の甘い点**:
- 「用語を定義すれば問題が解決する」という楽観的な想定
- スキルの実装側で出力先をチェックするロジックがない

**対策案**:
- **案 A**: SKILL.md の定義に加えて、スキル実装側で出力先チェックを追加
  ```python
  # spec-know-how スキル起動時
  if current_project != spec_know_how_project:
      print("警告: 対象プロジェクト側から起動されています。")
      print("spec-know-how プロジェクト側から起動してください。")
  ```

- **案 B**: セットアップスクリプト（setup.sh など）で配置ルールをチェック

- **案 C**: README / IMPORT.md で「起動方法」と「配置ルール」を視覚的に説明

---

### 【Low】 問題 5: v0.3 への移行戦略が不在

**問題**: v0.2 → v0.3 への移行（番号変更、ファイル名変更）のスクリプトやマイグレーション手順がない。

**潜在的な問題**:

1. **既存プロジェクトでの手作業**
   - すべての DD ファイルを手動で rename
   - ポートフォリオインデックス、ログ、参照先を全て更新
   - エラーが発生しやすい

2. **バージョン混在による混乱**
   - 古いプロジェクト（v0.2）と新しいプロジェクト（v0.3）が混在
   - チーム内での混乱（「DD-40」と「DD-009」が同じもの？）

**対策案**:
- **案 A**: マイグレーションスクリプト（Python）を提供
  ```
  migrate-v0.2-to-v0.3.py
  - DD ファイル rename
  - ポートフォリオインデックス更新
  - テンプレート参照更新
  ```

- **案 B**: マイグレーション手順書を詳細に提供（手動対応用）

---

## 📊 まとめ表

| 問題 | 重要度 | 影響範囲 | 対策の容易性 | 優先対応 |
|------|--------|---------|-----------|---------|
| DD 番号変更 | **High** | 既存プロジェクト全体 | 困難（破壊的） | 番号は維持するか、マイグレーション手順を提供 |
| 日本語ファイル名 | **High** | 互換性、国際化 | 中（テスト必要） | 段階的に導入、互換性テスト必須 |
| タスク追加ガイドライン | Medium | 運用ユーザー | 中（教育必要） | テンプレート + ユーザー教育 |
| 配置ルール用語定義 | Medium | スキル実装 | 中（実装側変更） | SKILL.md + スキル実装側でチェック追加 |
| 移行戦略不在 | Low | v0.2 → v0.3 |中（スクリプト化） | マイグレーション手順/スクリプト提供 |

---

## 🎯 推奨アクション

### 即時対応（v0.3 リリース前）

1. **DD 番号**:
   - 現在の DD-05, DD-10, ... を維持する（破壊的変更を避ける）
   - OR 新規プロジェクトのみ 001 から開始し、マイグレーション手順を提供

2. **日本語ファイル名**:
   - ファイル名は英数のまま（`dd-040-machine-tools.md`）
   - テンプレート内のセクションヘッダ・説明は日本語（既実装）
   - 互換性テストを実施

3. **タスク追加ガイドライン**:
   - テンプレートに「推奨」として記載
   - ユーザー教育ドキュメントを別途準備

4. **配置ルール用語定義**:
   - SKILL.md に定義を追加（既実装）
   - スキル実装側で出力先チェックロジックを追加

### 今後の検討事項

- マイグレーションスクリプトの開発
- 国際化対応（英語のドキュメントも並行提供）
- ユーザーフィードバック収集後の改良

---

## 付録: 質問

提案の実装前に、以下を確認すべき：

1. **既存プロジェクトへの影響**:
   - 既に spec-know-how を導入しているプロジェクトはあるか？
   - あれば、番号変更のコストは許容可能か？

2. **国際化の必要性**:
   - 日本語プロジェクトのみの対応か、グローバル対応も視野か？
   - 英語版ドキュメントの必要性は？

3. **ユーザーベース**:
   - ユーザーは社内開発チーム主体か、外部ユーザーも対象か？
   - サポート体制の強化は可能か？

