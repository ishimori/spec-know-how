# spec-know-how v0.3 改良提案書

日付: 2026-02-17

## 概要

spec-know-how v0.2 の実装経験から、以下 4 点の改良が必要です。

---

## 改良案 1: DD 番号を 001 から始める

### 現在の問題

- DD-05, DD-10, DD-15, ... という番号付けは「テンプレート先行」の設計の痕跡
- テンプレート番号がそのまま DD 番号になってしまい、ユーザーの自由度が低い
- 「なぜ 05 から始まるのか？」という違和感

### 改良内容

**案 A: 完全にリセット（推奨）**
- DD 番号を 001 から始める
- テンプレート名と DD 番号を切り離す
- ポートフォリオインデックスを DD-001 にする

| 現在 | 新案 | テンプレート |
|------|------|------------|
| DD-05 | DD-001 | `template-portfolio-index.md` |
| DD-10 | DD-002 | `template-stage1-quantitative-inventory.md` |
| DD-15 | DD-003 | `template-stage2-analysis-scope.md` |
| DD-20 | DD-004 | `template-stage3-fr-extraction.md` |
| ... | ... | ... |

**メリット:**
- DD 番号がユーザー起動時に自然に採番される
- テンプレート番号との混同がなくなる
- 新規仕様抽出プロジェクトごとに番号がリセットされる（シンプル）

### 実装手順

1. SKILL.md の「作成する DD」テーブルを更新（DD 番号を 001 ～ 012 に変更）
2. テンプレートファイル名を変更（`05_` → `template-` プレフィックスに）
3. ポートフォリオインデックスを DD-001 に変更
4. IMPORT.md, CHANGELOG.md を更新

---

## 改良案 2: DD ファイル名を日本語にする

### 現在の問題

- ファイル名が英語（`40_stage4_machine_tools.md`）
- テンプレートも英語
- 日本語プロジェクトでは違和感が大きい

### 改良内容

**ファイル名形式:**
```
DD-{番号}_{日本語タイトル}.md
```

**例:**
```
現在:   DD-40_stage4_machine_tools.md
新案:   DD-040_機械ツール設計.md

現在:   DD-05_portfolio_index.md
新案:   DD-001_ポートフォリオインデックス.md
```

**テンプレートファイル名:**
```
template-{番号}-{日本語タイトル}.md

例:
  template-001-ポートフォリオインデックス.md
  template-002-定量棚卸し.md
  template-004-FR仕様抽出.md
```

**テンプレート内の日本語化:**
- セクションヘッダ：既に日本語 ✅
- 説明文：既に日本語 ✅
- 変数プレースホルダ：`{番号}`, `{タイトル}`, `{日本語}` に統一

### メリット

- ファイル一覧が見やすい
- ユーザーがテンプレートの内容を直感的に理解できる
- プロジェクト内で DD を検索しやすい

### 実装手順

1. テンプレートファイルを rename
   ```
   05_portfolio_index.md → template-001-ポートフォリオインデックス.md
   10_stage1_quantitative_inventory.md → template-002-定量棚卸し.md
   ...
   ```

2. テンプレート置換ロジックを更新
   - 変数：`{番号}`, `{タイトル}`, `{日付}`

3. 既存 DD ファイル（実装例）を rename
   ```
   DD-40_stage4_machine_tools.md → DD-040_機械ツール設計.md
   DD-05_portfolio_index.md → DD-001_ポートフォリオインデックス.md
   ```

---

## 改良案 3: DD 実行中のタスク追加に対応

### 現在の問題

- DD テンプレートに「タスク一覧」が初期化されている
- 実行中に新たなタスクが発見された場合、手動で DD に追加している
- 自動化メカニズムがない

### 改良内容

**タスク管理セクションの拡張:**

#### 3.1 タスク追跡フォーマットの標準化

```markdown
## タスク一覧

### Phase 0: 事前精査
- [x] タスク 1 — 2026-02-17 10:30 完了
- [x] タスク 2 — 2026-02-17 10:45 完了
- [ ] タスク 3 — ⏳ 進行中

### Phase 1: 実装
- [ ] 新タスク（2026-02-17 15:00 発見） ← 動的追加
  - 背景: [理由]
  - 優先度: High/Medium/Low
  - 予定工数: [推定時間]
```

#### 3.2 「タスク追加ポイント」セクションの追加

```markdown
## タスク追加ガイドライン

実行中に新たなタスクが発見された場合:

1. **即座に追加する** — Phase セクション内に [ ] で追加
2. **発見日時・背景・理由を記録** — 判断の痕跡を残す
3. **優先度を明記** — High（ブロッキング）/ Medium（並列可）/ Low（オプション）
4. **ログに記録** — 「何が発見されたか」「なぜ追加したか」を書く

### ログフォーマット例

```
### 2026-02-17 15:00 タスク追加発見

**タスク**: [新規タスク名]
**背景**: [発見経緯]
**判断**: [なぜ追加が必要か]
**優先度**: High/Medium/Low
**予定工数**: [推定]
```
```

#### 3.3 テンプレートへの組み込み

- すべての DD テンプレートに「タスク追加ガイドライン」セクションを追加
- ログセクションにテンプレート例を記載

### メリット

- タスク追加の手続きが明確
- 追加理由の痕跡が残る
- ユーザーが「何が変わったか」を把握しやすい
- DA 批判レビューのネタになる（「ここで何が壊れたか」を記録）

### 実装手順

1. テンプレート全体に「タスク追加ガイドライン」セクションを追加
2. ログセクションに「タスク追加時のテンプレート例」を記載
3. SKILL.md に「タスク管理ポリシー」を追加
4. 実装例（DD-40）でこの手法を実践

---

## 改良案 4: 呼び出したプロジェクト側に DD を作成する（確認）

### 現在の実装

✅ 成果物配置ポリシーで既に明記されている

```
成果物配置ポリシー（重要）

すべての DD 成果物は、spec-know-how が起動されたプロジェクト内に配置される。
```

### ただし、改良が必要な点

**現在の曖昧性:**
- SKILL.md では「spec-know-how プロジェクト」と「呼び出したプロジェクト」の区別が不明確

**改良内容:**

```markdown
## 用語定義

- **spec-know-how プロジェクト**: `/spec-know-how` スキルが起動されたプロジェクト
- **対象プロジェクト**: 仕様抽出の対象となるレガシーコードベース

## 配置ルール（重要）

| 成果物 | 配置先 |
|--------|--------|
| DD ポートフォリオ（全 12 DD） | **spec-know-how プロジェクト側** |
| 仕様書（FR/NFR/UI） | **spec-know-how プロジェクト側** |
| 抽出ツール（本体） | **spec-know-how プロジェクト側** |
| 機械抽出結果（JSON） | **spec-know-how プロジェクト側** |
| 対象プロジェクト側 | 参照実装のみ（不要なら空） |
```

**実装済みか確認:**
- ✅ SKILL.md の「成果物配置ポリシー」で既に明記
- ✅ テンプレートの「成果物」セクションで明記

**追加が必要な点:**
- [ ] SKILL.md に「用語定義」セクションを追加（spec-know-how vs 対象プロジェクト）
- [ ] 初期化スクリプト（setup/setup.sh など）で配置ルールをチェック

---

## 実装優先度

| 改良案 | 優先度 | 工数 | 効果 |
|--------|--------|------|------|
| 1. DD 番号 001 から始める | **High** | 中 | 大（ユーザー体験向上） |
| 2. ファイル名を日本語に | **High** | 小 | 大（可視性向上） |
| 3. タスク追加ガイドライン | **High** | 小 | 中（管理性向上） |
| 4. 配置ルール用語定義 | **Medium** | 小 | 中（明確化） |

---

## 実装チェックリスト（v0.3 リリース時）

### 改良案 1: DD 番号
- [ ] SKILL.md: DD テーブル更新（05 → 001）
- [ ] テンプレートファイル rename
- [ ] ポートフォリオインデックスを DD-001 に変更
- [ ] テンプレート内の番号参照を更新
- [ ] 実装例（実装済み DD）をファイル rename
- [ ] IMPORT.md, CHANGELOG.md を更新

### 改良案 2: 日本語ファイル名
- [ ] テンプレートファイルを日本語 rename
- [ ] テンプレート内の日本語化確認
- [ ] 実装例を日本語ファイル名に rename

### 改良案 3: タスク追加ガイドライン
- [ ] すべてのテンプレートに「タスク追加ガイドライン」セクション追加
- [ ] ログセクションにテンプレート例を記載
- [ ] SKILL.md に「タスク管理ポリシー」を追加

### 改良案 4: 配置ルール用語定義
- [ ] SKILL.md に「用語定義」セクション追加
- [ ] 初期化スクリプトで配置ルールをチェック（可視化）

---

## 背景・根拠

1. **DD 番号 001 から**: ユーザーが「なぜ 05 から?」と疑問に思う。テンプレート番号とユーザー番号を分離するべき。

2. **日本語ファイル名**: ファイル一覧での視認性が大幅向上。テンプレートも日本語であれば一貫性がある。

3. **タスク追加ガイドライン**: 実装経験から「タスクが動的に増える」のは避けられない。ガイドラインを明記することで記録の質が上がる。

4. **配置ルール用語定義**: 現在は曖昧性がある（「どちらのプロジェクト?」）。用語を定義することで混同を防ぐ。

