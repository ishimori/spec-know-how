---
name: qa
description: 仕様書からの回答検索＋移行元コード突合検証
---

# QA スキル — 仕様質問＆コード突合

ユーザーの質問に対して、仕様書から回答を抽出し、移行元コードベースと突合検証するスキルです。

## 使い方

```
/qa <質問>
```

### 例
- `/qa 残業計算の60時間境界はどう処理される？`
- `/qa 歩合パターンBの売上手数料率は？`
- `/qa 有休の付与日数のルールは？`
- `/qa 承認ワークフローのステータス遷移は？`
- `/qa 大規模修繕の利益計算の丸めルールは？`

## 処理フロー

### Step 1: 質問の分析

ユーザーの質問からキーワードを抽出し、関連する仕様書を特定する。

**検索対象の仕様書マップ**（CLAUDE.md のドキュメントマップも参照）:

| キーワード | 参照先 |
|-----------|--------|
| 残業、給与、時間外、深夜 | `doc/spec/business-logic/01_overtime_payroll.md` |
| 売上、賃貸、取引、仲介 | `doc/spec/business-logic/02_sales_transaction.md` |
| 歩合、ポイント給、管理手当 | `doc/spec/business-logic/03_commission_A_to_F.md` |
| 歩合、職種別、営業 | `doc/spec/business-logic/04_commission_G_to_J.md` |
| 歩合、調整金、支給額 | `doc/spec/business-logic/05_commission_K_to_L.md` |
| 歩合、全体フロー、パターン | `doc/spec/business-logic/06_commission_orchestration.md` |
| 承認、ワークフロー、申請 | `doc/spec/business-logic/07_approval_workflow.md` |
| 有休、有給、休暇 | `doc/spec/business-logic/08_paid_leave.md` |
| 定数、レート、閾値 | `doc/spec/business-logic/00_constants.md` |
| パターン、給与パターン | `doc/spec/business-logic/00_patterns.md` |
| 依存、横断 | `doc/spec/business-logic/09_dependency_map.md` |
| 画面、UI | `doc/catalog/screens/index.md` |
| テーブル、カラム、DB | `doc/catalog/database/tables.md`, `doc/spec/database/` |
| セキュリティ、認証 | `doc/catalog/security.md` |

### Step 2: 仕様書からの回答抽出

1. 特定した仕様書を Read ツールで読み込む
2. 該当するビジネスルール（BR-xxx）を特定する
3. 関連する定数は `00_constants.md` から引用する
4. 回答を簡潔にまとめる

**注意**:
- `[VERIFIED]` の仕様書は信頼度が高い（ソースコードと突合済み）
- `[DRAFT]` の仕様書は参考程度（実装前に必ず検証が必要）
- 仕様書に記載がない場合はその旨を明記する

### Step 3: 移行元コードでの検証

移行元コードベース `C:\repo\housing-e-kintai` を検索して、仕様書の記述を実際のコードで裏付ける。

1. Grep ツールで移行元コードベースからキーワードを検索
2. 該当する関数・定数・ロジックを特定
3. コードの該当部分を Read ツールで読み込み
4. 仕様書の記述とコードを比較

**移行元の主なコード構成**（参考）:
- `src/services/` — ビジネスロジック
- `src/repositories/` — データアクセス
- `src/views/` — 画面（Streamlit）
- `src/models/` — データモデル
- `src/common/` — 共通ユーティリティ

### Step 4: 突合レポート出力

以下のフォーマットで結果を出力する:

```markdown
## QA回答

### 質問
> {ユーザーの質問をそのまま引用}

### 仕様書からの回答
- **参照先**: {仕様書ファイルパス}
- **該当ルール**: {BR-xxx（あれば）}
- **回答**:
  {仕様書に基づく回答。具体的な数値・計算式・条件を含める}

### コード検証
- **参照先**: {移行元ファイルパス:行番号}
- **該当コード**:
  {コードの要約または該当箇所の引用}

### 突合結果
{以下のいずれか}
- **一致**: 仕様書の記述とコードが一致している
- **差異あり**: {具体的な差異の説明}
- **仕様書に記載なし**: コードには存在するが仕様書に未記載
- **コードで未確認**: 仕様書に記載はあるが該当コードを特定できなかった

### 信頼度
- 仕様書: {[VERIFIED] または [DRAFT]}
- コード検証: {直接確認済み / 推定 / 未確認}
```

## 複数の仕様書にまたがる場合

質問が複数の仕様書に関連する場合は、それぞれの仕様書から情報を集約し、
依存関係マップ（`09_dependency_map.md`）も参照して横断的に回答する。

## 回答できない場合

仕様書にもコードにも該当する情報が見つからない場合:

```markdown
## QA回答

### 質問
> {質問}

### 結果
この質問に対応する情報は、現在の仕様書・移行元コードから見つかりませんでした。

### 考えられる理由
- 仕様抽出の対象外の機能である可能性
- 画面固有のUI仕様で、業務ロジック仕様書の対象外
- etc.

### 次のアクション
- {必要に応じて追加調査の提案}
```
