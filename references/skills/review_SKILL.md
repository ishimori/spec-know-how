---
name: review
description: コードレビュー・規約チェックコマンド
---

# コードレビュー・規約チェックコマンド

コーディング規約・アーキテクチャ違反を検出するコマンドです。

## 使い方

```
/review [範囲] [対象]
```

### 範囲（省略時: changed）
- `changed` - 今回変更した箇所のみ（git diff）
- `all` - プロジェクト全体

### 対象（省略時: code）
- `code` - ソースコードのみ
- `doc` - ドキュメントのみ
- `both` - コードとドキュメント両方

### 例
- `/review` → 変更箇所のコードをレビュー
- `/review all code` → 全コードをレビュー
- `/review changed both` → 変更箇所のコードとドキュメントをレビュー
- `/review all doc` → 全ドキュメントをレビュー

## レビュー手順

### 1. 対象ファイルの特定

#### changed の場合
```bash
git diff --name-only HEAD
git diff --name-only --cached
```
で変更ファイルを取得。

#### all の場合
- code: `src/**/*.py` 等を対象
- doc: `doc/**/*.md`, `.claude/**/*.md` を対象

### 2. コードレビュー（code）

プロジェクトの規約ファイルを参照し、違反をチェックする。

#### チェック項目（例）

##### レイヤー違反
- [ ] views/ から repositories/ を直接importしていないか
- [ ] services/ から views/ をimportしていないか

##### Session State（Streamlitの場合）
- [ ] `st.session_state` を直接読み書きしていないか

##### データベース
- [ ] SQLがrepositories/以外に書かれていないか
- [ ] プレースホルダを使っているか（SQLインジェクション対策）

##### エラーハンドリング
- [ ] 例外を握りつぶしていないか（except: pass）
- [ ] 適切なエラーメッセージを返しているか

##### import順序
- [ ] 標準ライブラリ → サードパーティ → ローカルの順か

### 3. ドキュメントレビュー（doc）

#### チェック項目

##### DD設計書
- [ ] タスク一覧のステータスが最新か
- [ ] ログセクションに最新の作業が記録されているか
- [ ] 決定事項が明確に記載されているか

##### 仕様書
- [ ] コードと仕様書の内容に乖離がないか

### 4. 結果出力

#### 出力フォーマット

```markdown
## レビュー結果

### 対象
- 範囲: {changed/all}
- 対象: {code/doc/both}
- ファイル数: {N}件

### 違反一覧

| ファイル | 行 | 規約 | 内容 |
|----------|-----|------|------|
| src/services/foo.py | 15 | レイヤー違反 | repositoriesを経由せずDBにアクセス |

### 推奨事項

（違反ではないが改善を推奨する点）

### OK

（問題なしの項目）
```

## 定期実行の推奨

以下のタイミングでレビューを実行することを推奨：

1. **機能実装完了時**: `/review changed code`
2. **コミット前**: `/review changed both`
3. **フェーズ完了時**: `/review all code`
4. **DD完了時**: `/review all doc`

## カスタマイズ

チェック項目はプロジェクトの規約に合わせて調整してください。

- アーキテクチャ規約がある場合 → レイヤー違反チェックを追加
- コーディング規約がある場合 → スタイルチェックを追加
- セキュリティ規約がある場合 → 脆弱性チェックを追加
